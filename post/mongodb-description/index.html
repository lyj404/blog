<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>MongoDB的基本操作 | LYJ's Blog</title>
<meta name=keywords content="MongoDB,Database"><meta name=description content="MongoDB 是一个基于分布式文件存储的数据库。由 C++ 语言编写。旨在为 WEB 应用提供可扩展的高性能数据存储解决方案。"><meta name=author content="LYJ"><link rel=canonical href=https://lyj.cloudns.ch/post/mongodb-description/><link crossorigin=anonymous href=/assets/css/stylesheet.458679ba676f2417ec4aa5319bc5c5bd7ecb799bb2b3a3cf48ddf082127d3d4c.css integrity="sha256-RYZ5umdvJBfsSqUxm8XFvX7LeZuys6PPSN3wghJ9PUw=" rel="preload stylesheet" as=style><link rel=icon href=https://lyj.cloudns.ch/favicon.png><link rel=icon type=image/png sizes=16x16 href=https://lyj.cloudns.ch/favicon.png><link rel=icon type=image/png sizes=32x32 href=https://lyj.cloudns.ch/favicon.png><link rel=apple-touch-icon href=https://lyj.cloudns.ch/favicon.png><link rel=mask-icon href=https://lyj.cloudns.ch/favicon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://lyj.cloudns.ch/post/mongodb-description/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://lyj.cloudns.ch/post/mongodb-description/"><meta property="og:site_name" content="LYJ's Blog"><meta property="og:title" content="MongoDB的基本操作"><meta property="og:description" content="MongoDB 是一个基于分布式文件存储的数据库。由 C++ 语言编写。旨在为 WEB 应用提供可扩展的高性能数据存储解决方案。"><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2024-01-09T19:39:59+00:00"><meta property="article:modified_time" content="2024-01-09T19:39:59+00:00"><meta property="article:tag" content="MongoDB"><meta property="og:image" content="https://lyj.cloudns.ch/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://lyj.cloudns.ch/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="MongoDB的基本操作"><meta name=twitter:description content="MongoDB 是一个基于分布式文件存储的数据库。由 C++ 语言编写。旨在为 WEB 应用提供可扩展的高性能数据存储解决方案。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://lyj.cloudns.ch/post/"},{"@type":"ListItem","position":2,"name":"MongoDB的基本操作","item":"https://lyj.cloudns.ch/post/mongodb-description/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"MongoDB的基本操作","name":"MongoDB的基本操作","description":"MongoDB 是一个基于分布式文件存储的数据库。由 C++ 语言编写。旨在为 WEB 应用提供可扩展的高性能数据存储解决方案。","keywords":["MongoDB","Database"],"articleBody":"MongoDB简介 MongoDB是一个基于分布式文件存储的数据库。由C++语言编写。旨在为WEB应用提供一个可扩展的高性能数据存储解决方案。MongoDB是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的。 MongoDB官网地址： MongoDB官网\nMongoDB概念 SQL术语 MongoDB术语 说明 database database 数据库 table collection 数据库表/集合 row document 数据记录行/文档 column field 数据字段/域 index index 索引 table joins 表连接，MongoDB不支持表连接 primary key primary key 主键/MongoDB自动将_id字段设置为主键 数据库 MongoDB中可以建立多个数据库，默认的数据库为db ，该数据库存储在data目录中，每一个数据库都有自己集合和权限，不同的数据库放置在不同的文件中。\n1 2 3 4 5 6 7 8 9 10 # 显示MongoDB服务器上的所有数据库 show dbs # 示例输出 # admin 0.000GB # local 0.000GB # test 0.001GB # 显示当前所使用的数据库 db # 指定使用某个数据库 use local MongoDB默认自带三个数据库：admin、local、config\nadmin 数据库：MongoDB中主要的管理数据库，包含了MongoDB实例的所有用户和角色信息。通过该数据库可以进行用户管理、权限分配以及控制MongoDB实例的运行状态等操作。 local 数据库：这是一个存储临时数据的地方，例如复制同步过程中的操作日志。在这个数据库中，可以找到一些关键的集合(collection)，例如startup_log和oplog.rws ，它们记录了MongoDB实例的启动日志和操作日志。 config 数据库：包含了MongoDB的分片信息，用于支持分片集群。在一个分片集群中，每个节点都有一个config 数据库，用于存储集群的各种配置和元数据。 数据库的名字应是满足以下条件的任意UTF-8字符串： 不能是空字符串 不得含有’ ‘（空格)、.、$、/、\\和\\0 (空字符) 应全部小写 最多64字节 文档(Document) 文档是一组键值(key-value)对(即BSON)。MongoDB的文档不需要设置相同的字段，并且相同的字段不需要相同的数据类型，这与关系型数据库有很大的区别，也是MongoDB的特点。\n1 {\"site\":\"www.runoob.com\", \"name\":\"菜鸟教程\"} RDBMS 与 MongoDB 对应的术语：\nRDBMS MongoDB 数据库 数据库 表格 集合 行 文档 列 字段 表联合 嵌入文档 主键 主键（MongoDB提供了key为_id） 注意：\n文档中的键/值对是有序的。 文档中的值不仅可以是在双引号里面的字符串，还可以是其他几种数据类型（甚至可以是整个嵌入的文档)。 MongoDB区分类型和大小写。 MongoDB的文档不能有重复的键。 文档的键是字符串。除了少数例外情况，键可以使用任意UTF-8字符。 文档键的命名规范：\n键不能含有\\0 (空字符)。 .和$有特别的意义，只有在特定环境下才能使用。 以下划线\"_“开头的键是保留的(不是严格要求的)。 集合 集合就是MongoDB文档组，类似于RDBMS（关系型数据库管理系统：Retational Database Management System）中的表格。集合存在于数据库中，没有固定的结构；集合可以插入不同格式和类型的数据，但通常情况下插入集合的数据都会有一定的关联性。\n1 2 3 {\"site\":\"www.baidu.com\"} {\"site\":\"www.google.com\",\"name\":\"Google\"} {\"site\":\"www.runoob.com\",\"name\":\"菜鸟教程\",\"num\":5} 当第一个文档插入时，集合就会被创建。\n合法的集合名 集合名不能是空字符串”\"。 集合名不能含有\\0字符（空字符)。 集合名不能以\"system.“开头，这是为系统集合保留的前缀。 用户创建的集合名字不能含有保留字符。有些驱动程序的确支持在集合名里面包含，这是因为某些系统生成的集合中包含该字符。除非你要访问这种系统创建的集合，否则千万不要在名字里出现$。 capped collections capped collections是固定大小的collecting有很高的性能以及队列过期的特性（过期按照插入的顺序），有点类似于“RRD”。capped collections 是高性能自动的维护对象的插入顺序。非常适合类似于记录日志的功能，和标准的collection不同，必须要显示的创建一个capped collections，指定一个 collection 的大小，单位是字节。collection 的数据存储空间值提前分配的。\n1 db.createCollection(\"mycoll\", {capped:true, size:100000}) 在 capped collection 中，你能添加新的对象。 能进行更新，然而，对象不会增加存储空间。如果增加，更新就会失败 。 使用 Capped Collection 不能删除一个文档，可以使用 drop() 方法删除 collection 所有的行。 删除之后，你必须显式的重新创建这个 collection。 在32bit机器中，capped collection 最大存储为 1e9( 1X109)个字节。 元数据 数据库的信息是存储在集合中。它们使用系统的命名空间：\n1 dbname.system.* 在MongoDB数据库中名字空间 .system.*是包含多种系统信息的特殊集合(Collection):\n集合命名空间 描述 dbname.system.namespaces 列出所有名字空间。 dbname.system.indexes 列出所有索引。 dbname.system.profile 包含数据库概要(profile)信息。 dbname.system.users 列出所有可访问数据库的用户。 dbname.local.sources 包含复制对端（slave）的服务器信息和状态。 对于修改系统集合中的对象有如下限制：\n在{{system.indexes}}插入数据，可以创建索引。但除此之外该表信息是不可变的(特殊的drop index命令将自动更新相关信息)。 {{system.users}}是可修改的。 {{system.profile}}是可删除的。 MongoDB 数据类型 MongoDB中常用的几种数据类型。\n数据类型 描述 String 字符串。存储数据常用的数据类型。在 MongoDB 中，UTF-8 编码的字符串才是合法的。 Integer 整型数值。用于存储数值。根据你所采用的服务器，可分为 32 位或 64 位。 Boolean 布尔值。用于存储布尔值（真/假）。 Double 双精度浮点值。用于存储浮点值。 Min/Max keys 将一个值与 BSON（二进制的 JSON）元素的最低值和最高值相对比。 Array 用于将数组或列表或多个值存储为一个键。 Timestamp 时间戳。记录文档修改或添加的具体时间。 Object 用于内嵌文档。 Null 用于创建空值。 Symbol 符号。该数据类型基本上等同于字符串类型，但不同的是，它一般用于采用特殊符号类型的语言。 Date 日期时间。用 UNIX 时间格式来存储当前日期或时间。你可以指定自己的日期时间：创建 Date 对象，传入年月日信息。 Object ID 对象 ID。用于创建文档的 ID。 Binary Data 二进制数据。用于存储二进制数据。 Code 代码类型。用于在文档中存储 JavaScript 代码。 Regular expression 正则表达式类型。用于存储正则表达式。 重要的数据类型 ObjectId ObjectId 类似唯一主键，可以很快的去生成和排序，包含 12 bytes，含义是：\n前 4 个字节表示创建 unix 时间戳,格林尼治时间 UTC 时间，比北京时间晚了 8 个小时 接下来的 3 个字节是机器标识码 紧接的两个字节由进程 id 组成 PID 最后三个字节是随机数 MongoDB 中存储的文档必须有一个 _id 键。这个键的值可以是任何类型的，默认是个 ObjectId 对象 由于 ObjectId 中保存了创建的时间戳，所以你不需要为你的文档保存时间戳字段，你可以通过 getTimestamp 函数来获取文档的创建时间:\n1 2 3 \u003e var newObject = ObjectId() \u003e newObject.getTimestamp() ISODate(\"2017-11-25T07:21:10Z\") ObjectId 转为字符串\n1 2 \u003e newObject.str 5a1919e63df83ce79df8b38f 字符串 BSON 字符串都是 UTF-8 编码。\n时间戳 BSON 有一个特殊的时间戳类型用于 MongoDB 内部使用，与普通的 日期 类型不相关。 时间戳值是一个 64 位的值。其中：\n前32位是一个 time_t 值（与Unix新纪元相差的秒数） 后32位是在某秒中操作的一个递增的序数 在单个 mongod 实例中，时间戳值通常是唯一的。在复制集中， oplog 有一个 ts 字段。这个字段中的值使用BSON时间戳表示了操作时间。 BSON 时间戳类型主要用于 MongoDB 内部使用。在大多数情况下的应用开发中，你可以使用 BSON 日期类型。\n日期 表示当前距离 Unix新纪元（1970年1月1日）的毫秒数。日期类型是有符号的, 负数表示 1970 年之前的日期。\n1 2 3 4 5 6 7 8 9 10 \u003e var mydate1 = new Date() //格林尼治时间 \u003e mydate1 ISODate(\"2018-03-04T14:58:51.233Z\") \u003e typeof mydate1 object \u003e var mydate2 = ISODate() //格林尼治时间 \u003e mydate2 ISODate(\"2018-03-04T15:00:45.479Z\") \u003e typeof mydate2 object 这样创建的时间是日期类型，可以使用 JS 中的 Date 类型的方法。返回一个时间类型的字符串：\n1 2 3 4 5 6 7 \u003e var mydate1str = mydate1.toString() \u003e mydate1str Sun Mar 04 2018 14:58:51 GMT+0000 (UTC) \u003e typeof mydate1str string \u003e Date() Sun Mar 04 2018 15:02:59 GMT+0000 (UTC) MongoDB连接 连接MongoDB的URL语法 mongodb://[username:password@]host1[:port1][,host2[:port2],...[,hostN[:portN]]][/[database][?options]]\nmongodb:// 这是固定的格式，必须要指定。 username:password@ 可选项，如果设置，在连接数据库服务器之后，驱动都会尝试登录这个数据库 host1 必须的指定至少一个host, host1 是这个URI唯一要填写的。它指定了要连接服务器的地址。如果要连接复制集，请指定多个主机地址。 portX 可选的指定端口，如果不填，默认为27017 /database 如果指定username:password@，连接并验证登录指定数据库。若不指定，默认打开 test 数据库。 ?options 是连接选项。如果不使用/database，则前面需要加上/。所有连接选项都是键值对name=value，键值对之间通过\u0026或;（分号）隔开 连接URL案例： mongodb://admin:123456@localhost/test options选项： 选项 描述 replicaSet=name 验证replica set的名称。 Impliesconnect=replicaSet. slaveOk=true|false - true:在connect=direct模式下，驱动会连接第一台机器，即使这台服务器不是主。在connect=replicaSet模式下，驱动会发送所有的写请求到主并且把读取操作分布在其他从服务器。- false: 在 connect=direct模式下，驱动会自动找寻主服务器. 在connect=replicaSet 模式下，驱动仅仅连接主服务器，并且所有的读写命令都连接到主服务器。 safe=true|false - true: 在执行更新操作之后，驱动都会发送getLastError命令来确保更新成功。(还要参考 wtimeoutMS).false: 在每次更新之后，驱动不会发送getLastError来确保更新成功。 w=n 驱动添加 { w : n } 到getLastError命令. 应用于safe=true。 wtimeoutMS=ms 驱动添加 { wtimeout : ms } 到 getlasterror 命令. 应用于 safe=true. fsync=true|false - true: 驱动添加 { fsync : true } 到 getlasterror 命令.应用于 safe=true.- false: 驱动不会添加到getLastError命令中。 journal=true|false 如果设置为 true, 同步到 journal (在提交到数据库前写入到实体中). 应用于 safe=true connectTimeoutMS=ms 可以打开连接的时间。 socketTimeoutMS=ms 发送和接受sockets的时间。 MongoDB创建数据库 MongoDB创建数据库的语法格式：\n1 use DATABASE_NAME 创建一个数据库\n1 2 3 4 5 6 7 8 9 10 11 12 use runoob # 查看数据库 db runoob # 插入一条数据 db.runoob.insertOne({\"name\":\"lyj\"}) # 查看所有数据库，发现新建的数据库已存在 show dbs admin 0.000GB config 0.000GB local 0.000GB lyj 0.000GB 如果现在查看所有数据库，会发现当前新建的数据库并不存在，只有往数据库中插入数据之后，才能查看到\nMongoDB删除数据库 MongoDB删除数据库的语法格式：\n1 db.dropDatabase() 删除数据库具体操作\n1 2 3 4 5 6 7 8 9 # 选中需要删除的数据库 use lyj # 执行删除数据库的命令 db.dropDatabase() # 查看所有数据库，发现新建的数据库已删除 show dbs admin 0.000GB config 0.000GB local 0.000GB MongoDB创建集合 MongoDB创建集合的语法格式：\n1 db.createCollection(name, options) options具体参数\n字段 类型 描述 capped 布尔 （可选）如果为 true，则创建固定集合。固定集合是指有着固定大小的集合，当达到最大值时，它会自动覆盖最早的文档。 当该值为 true 时，必须指定 size 参数。 autoIndexId 布尔 3.2 之后不再支持该参数。（可选）如为 true，自动在 _id 字段创建索引。默认为 false。 size 数值 （可选）为固定集合指定一个最大值，即字节数。 如果 capped 为 true，也需要指定该字段。 max 数值 （可选）指定固定集合中包 创建集合\n1 2 3 4 5 6 7 # 创建数据库 use test # 创建集合 db.createCollection(\"lyj\") # 查看已有集合show collections/show tables两个命令都是查询已有集合 show collections lyj MongoDB删除集合 MongoDB删除集合的语法格式：\n1 db.collection.drop() 删除集合\n1 2 3 4 # 删除名叫lyj的集合 db.lyj.drop() # 查看是否删除成功 show tables MongoDB插入文档 MongoDB插入文档的语法格式：\n1 2 3 db.COLLECTION_NAME.insert(document) 或 db.COLLECTION_NAME.save(document) save()：如果 _id 主键存在则更新数据，如果不存在就插入数据。该方法新版本中已废弃，可以使用 db.collection.insertOne() 或 db.collection.replaceOne() 来代替。 insert(): 若插入的数据主键已经存在，则会抛 org.springframework.dao.DuplicateKeyException 异常，提示主键重复，不保存当前数据。 3.2 版本之后新增了 db.collection.insertOne() 和 db.collection.insertMany()。 db.collection.insertOne() 语法格式： 1 2 3 4 5 6 db.collection.insertOne( , { writeConcern: } ) db.collection.insertMany() 语法格式：\n1 2 3 4 5 6 7 db.collection.insertMany( [ , , ... ], { writeConcern: , ordered: } ) 参数说明：\ndocument：要写入的文档。 writeConcern：写入策略，默认为 1，即要求确认写操作，0 是不要求。 ordered：指定是否按顺序写入，默认 true，按顺序写入 insertOne() 表示插入一条数据，insertMany() 表示插入多条数据\n插入文档\n1 2 3 4 5 6 7 8 9 10 # 该命令会往test数据的lyj集合中插入文档 db.lyj.insert({title: 'MongoDB 教程', description: 'MongoDB 是一个 Nosql 数据库', by: '菜鸟教程', url: 'http://www.runoob.com', tags: ['mongodb', 'database', 'NoSQL'], likes: 100 }) # 查看已插入的文档 db.lyj.find() MongoDB更新文档 MongoDB更新文档的语法格式：\n1 2 3 4 5 6 7 8 9 db.collection.update( , , { upsert: , multi: , writeConcern: } ) 参数说明：\nquery : update的查询条件，类似sql update查询内where后面的。 update : update的对象和一些更新的操作符（如$,$inc…）等，也可以理解为sql update查询内set后面的 upsert : 可选，这个参数的意思是，如果不存在update的记录，是否插入objNew,true为插入，默认是false，不插入。 multi : 可选，mongodb 默认是false,只更新找到的第一条记录，如果这个参数为true,就把按条件查出来多条记录全部更新。 writeConcern :可选，抛出异常的级别。 更新文档\n1 db.lyj.update({'title':'MongoDB 教程'},{$set:{'title':'MongoDB'}}) MongoDB删除文档 MongoDB删除数据库的语法格式：\n1 2 3 4 5 6 7 db.collection.remove( , { justOne: , writeConcern: } ) 参数说明：\nquery :（可选）删除的文档的条件。 justOne : （可选）如果设为 true 或 1，则只删除一个文档，如果不设置该参数，或使用默认值 false，则删除所有匹配条件的文档。 writeConcern :（可选）抛出异常的级别。 删除文档\n1 db.lyj.remove({'title':'MongoDB 教程'}) MongoDB查询文档 MongoDB查询文档的语法格式：\n1 db.collection.find(query, projection) query ：可选，使用查询操作符指定查询条件 projection ：可选，使用投影操作符指定返回的键。查询时返回文档中所有键值， 只需省略该参数即可（默认省略）。 pretty() 方法以格式化的方式来显示所有文档db.lyj.find().pretty()\nMongoDB 与 RDBMS Where 语句比较 操作 格式 范例 RDBMS中的类似语句 等于 {:} db.col.find({\"by\":\"菜鸟教程\"}).pretty() where by = '菜鸟教程' 小于 {:{$lt:}} db.col.find({\"likes\":{$lt:50}}).pretty() where likes \u003c 50 小于或等于 {:{$lte:}} db.col.find({\"likes\":{$lte:50}}).pretty() where likes \u003c= 50 大于 {:{$gt:}} db.col.find({\"likes\":{$gt:50}}).pretty() where likes \u003e 50 大于或等于 {:{$gte:}} db.col.find({\"likes\":{$gte:50}}).pretty() where likes \u003e= 50 不等于 {:{$ne:}} db.col.find({\"likes\":{$ne:50}}).pretty() where likes != 50 MongoDB的逻辑运算符 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 # and运算符 db.lyj.find({key1:value1, key2:value2}).pretty() # 案例 db.lyj.find({\"by\":\"菜鸟教程\", \"title\":\"MongoDB 教程\"}).pretty() { \"_id\" : ObjectId(\"56063f17ade2f21f36b03133\"), \"title\" : \"MongoDB 教程\", \"description\" : \"MongoDB 是一个 Nosql 数据库\", \"by\" : \"菜鸟教程\", \"url\" : \"http://www.runoob.com\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 100 } # or运算符 \u003edb.col.find( { $or: [ {key1: value1}, {key2:value2} ] } ).pretty() # 案例 db.lyj.find({$or:[{\"by\":\"菜鸟教程\"},{\"title\": \"MongoDB 教程\"}]}).pretty() { \"_id\" : ObjectId(\"56063f17ade2f21f36b03133\"), \"title\" : \"MongoDB 教程\", \"description\" : \"MongoDB 是一个 Nosql 数据库\", \"by\" : \"菜鸟教程\", \"url\" : \"http://www.runoob.com\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 100 } # and和or一起使用 db.lyj.find({\"likes\": {$gt:50}, $or: [{\"by\": \"菜鸟教程\"},{\"title\": \"MongoDB 教程\"}]}).pretty() { \"_id\" : ObjectId(\"56063f17ade2f21f36b03133\"), \"title\" : \"MongoDB 教程\", \"description\" : \"MongoDB 是一个 Nosql 数据库\", \"by\" : \"菜鸟教程\", \"url\" : \"http://www.runoob.com\", \"tags\" : [ \"mongodb\", \"database\", \"NoSQL\" ], \"likes\" : 100 } MongoDB $type操作符 $type操作符是基于BSON类型来检索集合中匹配的数据类型，并返回结果。 MongoDB 中可以使用的类型如下表所示：\n类型 数字 备注 Double 1 String 2 Object 3 Array 4 Binary data 5 Undefined 6 已废弃。 Object id 7 Boolean 8 Date 9 Null 10 Regular Expression 11 JavaScript 13 Symbol 14 JavaScript (with scope) 15 32-bit integer 16 Timestamp 17 64-bit integer 18 Min key 255 Query with -1. Max key 127 案列 1 2 3 # 想获取 \"col\" 集合中 title 为 String 的数据，这两个的含义都是一样的 db.col.find({\"title\" : {$type : 2}}) db.col.find({\"title\" : {$type : 'string'}}) MongoDB Limit和Skip方法 MongoDB的Limit()方法的语法格式：\n1 db.COLLECTION_NAME.find().limit(NUMBER) Limit()方法\n1 db.lyj.find({},{\"title\":lyj,_id:0}).limit(2) MongoDB的Skip()方法的语法格式：\n1 db.COLLECTION_NAME.find().limit(NUMBER).skip(NUMBER) Skip()方法\n1 db.lyj.find({},{\"title\":1,_id:0}).limit(1).skip(1) MongoDB sort方法 在 MongoDB 中使用 sort() 方法对数据进行排序，sort() 方法可以通过参数指定排序的字段，并使用 1 和 -1 来指定排序的方式，其中 1 为升序排列，而 -1 是用于降序排列。 sort()方法的语法格式：\n1 db.COLLECTION_NAME.find().sort({KEY:1}) sort()方法\n1 db.lyj.find({},{\"title\":1,_id:0}).sort({\"likes\":-1}) MongoDB 索引 索引通常能够极大的提高查询的效率，如果没有索引，MongoDB在读取数据时必须扫描集合中的每个文件并选取那些符合查询条件的记录。 这种扫描全集合的查询效率是非常低的，特别在处理大量的数据时，查询可能要花费几十秒甚至几分钟，这对网站的性能是非常致命的。 索引是特殊的数据结构，索引存储在一个易于遍历读取的数据集合中，索引是对数据库表中一列或多列的值进行排序的一种结构\nMongoDB使用 createIndex() 方法来创建索引。\ncreateIndex()方法基本语法格式：\n1 2 3 db.collection.createIndex(keys, options) # 实例 db.lyj.createIndex({\"title\":1}) createIndex() 接收可选参数，可选参数列表：\nParameter Type Description background Boolean 建索引过程会阻塞其它数据库操作，background可指定以后台方式创建索引，即增加 “background” 可选参数。 “background” 默认值为false。 unique Boolean 建立的索引是否唯一。指定为true创建唯一索引。默认值为false. name string 索引的名称。如果未指定，MongoDB的通过连接索引的字段名和排序顺序生成一个索引名称。 dropDups Boolean 3.0+版本已废弃。在建立唯一索引时是否删除重复记录,指定 true 创建唯一索引。默认值为 false. sparse Boolean 对文档中不存在的字段数据不启用索引；这个参数需要特别注意，如果设置为true的话，在索引字段中不会查询出不包含对应字段的文档.。默认值为 false. expireAfterSeconds integer 指定一个以秒为单位的数值，完成 TTL设定，设定集合的生存时间。 v index version 索引的版本号。默认的索引版本取决于mongod创建索引时运行的版本。 weights document 索引权重值，数值在 1 到 99,999 之间，表示该索引相对于其他索引字段的得分权重。 default_language string 对于文本索引，该参数决定了停用词及词干和词器的规则的列表。 默认为英语 language_override string 对于文本索引，该参数指定了包含在文档中的字段名，语言覆盖默认的language，默认值为 language. MongoDB aggregate() 方法 aggregate() 方法在MongoDB中的作用是聚合 aggregate() 方法的基本语法格式：\n1 db.COLLECTION_NAME.aggregate(AGGREGATE_OPERATION) 聚合的表达式:\n表达式 描述 实例 $sum 计算总和。 db.mycol.aggregate([{$group : {_id : “$by_user”, num_tutorial : {$sum : “$likes”}}}]) $avg 计算平均值 db.mycol.aggregate([{$group : {_id : “$by_user”, num_tutorial : {$avg : “$likes”}}}]) $min 获取集合中所有文档对应值得最小值。 db.mycol.aggregate([{$group : {_id : “$by_user”, num_tutorial : {$min : “$likes”}}}]) $max 获取集合中所有文档对应值得最大值。 db.mycol.aggregate([{$group : {_id : “$by_user”, num_tutorial : {$max : “$likes”}}}]) $push 将值加入一个数组中，不会判断是否有重复的值。 db.mycol.aggregate([{$group : {_id : “$by_user”, url : {$push: “$url”}}}]) $addToSet 将值加入一个数组中，会判断是否有重复的值，若相同的值在数组中已经存在了，则不加入。 db.mycol.aggregate([{$group : {_id : “$by_user”, url : {$addToSet : “$url”}}}]) $first 根据资源文档的排序获取第一个文档数据。 db.mycol.aggregate([{$group : {_id : “$by_user”, first_url : {$first : “$url”}}}]) $last 根据资源文档的排序获取最后一个文档数据 db.mycol.aggregate([{$group : {_id : “$by_user”, last_url : {$last : “$url”}}}]) 管道 管道在Unix和Linux中一般用于将当前命令的输出结果作为下一个命令的参数。 MongoDB的聚合管道将MongoDB文档在一个管道处理完毕后将结果传递给下一个管道处理。管道操作是可以重复的。 表达式：处理输入文档并输出。表达式是无状态的，只能用于计算当前聚合管道的文档，不能处理其它的文档。 聚合框架中常用的操作：\n$project：修改输入文档的结构。可以用来重命名、增加或删除域，也可以用于创建计算结果以及嵌套文档。 $match：用于过滤数据，只输出符合条件的文档。$match使用MongoDB的标准查询操作。 $limit：用来限制MongoDB聚合管道返回的文档数。 $skip：在聚合管道中跳过指定数量的文档，并返回余下的文档。 $unwind：将文档中的某一个数组类型字段拆分成多条，每条包含数组中的一个值。 $group：将集合中的文档分组，可用于统计结果。 $sort：将输入文档排序后输出。 $geoNear：输出接近某一地理位置的有序文档。 管道操作符实例 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # $project实例 db.article.aggregate( { $project : { title : 1 , author : 1 , }} ); # $match实例 db.articles.aggregate( [ { $match : { score : { $gt : 70, $lte : 90 } } }, { $group: { _id: null, count: { $sum: 1 } } } ] ); # $skip实例 db.article.aggregate( { $skip : 5 }); ","wordCount":"8152","inLanguage":"zh","image":"https://lyj.cloudns.ch/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-01-09T19:39:59Z","dateModified":"2024-01-09T19:39:59Z","author":{"@type":"Person","name":"LYJ"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://lyj.cloudns.ch/post/mongodb-description/"},"publisher":{"@type":"Organization","name":"LYJ's Blog","logo":{"@type":"ImageObject","url":"https://lyj.cloudns.ch/favicon.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://lyj.cloudns.ch/ accesskey=h title="Home (Alt + H)"><img src=https://lyj.cloudns.ch/home.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://lyj.cloudns.ch/ title="LYJ's Blog"><span>首页</span></a></li><li><a href=https://lyj.cloudns.ch/archives/ title=归档><span>归档</span></a></li><li><a href=https://lyj.cloudns.ch/categories/ title=Categories><span>分类</span></a></li><li><a href=https://lyj.cloudns.ch/tags/ title=Tags><span>标签</span></a></li><li><a href=https://lyj.cloudns.ch/search/ title=搜索><span>搜索</span></a></li><li><a href=https://lyj.cloudns.ch/about/ title=关于><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://lyj.cloudns.ch/>主页</a>&nbsp;»&nbsp;<a href=https://lyj.cloudns.ch/post/>Posts</a></div><h1 class="post-title entry-hint-parent">MongoDB的基本操作</h1><div class=post-description>MongoDB 是一个基于分布式文件存储的数据库。由 C++ 语言编写。旨在为 WEB 应用提供可扩展的高性能数据存储解决方案。</div><div class=post-meta><span title='2024-01-09 19:39:59 +0000 UTC'>2024-01-09</span>&nbsp;·&nbsp;17 分钟&nbsp;·&nbsp;8152 字&nbsp;·&nbsp;LYJ</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#mongodb简介>MongoDB简介</a></li><li><a href=#mongodb概念>MongoDB概念</a><ul><li><a href=#数据库>数据库</a></li><li><a href=#文档document>文档(Document)</a></li><li><a href=#集合>集合</a><ul><li><a href=#合法的集合名>合法的集合名</a></li><li><a href=#capped-collections>capped collections</a></li></ul></li><li><a href=#元数据>元数据</a></li><li><a href=#mongodb-数据类型>MongoDB 数据类型</a><ul><li><a href=#重要的数据类型>重要的数据类型</a><ul><li><a href=#objectid>ObjectId</a></li><li><a href=#字符串>字符串</a></li><li><a href=#时间戳>时间戳</a></li><li><a href=#日期>日期</a></li></ul></li></ul></li></ul></li><li><a href=#mongodb连接>MongoDB连接</a></li><li><a href=#mongodb创建数据库>MongoDB创建数据库</a></li><li><a href=#mongodb删除数据库>MongoDB删除数据库</a></li><li><a href=#mongodb创建集合>MongoDB创建集合</a></li><li><a href=#mongodb删除集合>MongoDB删除集合</a></li><li><a href=#mongodb插入文档>MongoDB插入文档</a></li><li><a href=#mongodb更新文档>MongoDB更新文档</a></li><li><a href=#mongodb删除文档>MongoDB删除文档</a></li><li><a href=#mongodb查询文档>MongoDB查询文档</a><ul><li><a href=#mongodb-与-rdbms-where-语句比较>MongoDB 与 RDBMS Where 语句比较</a></li><li><a href=#mongodb的逻辑运算符>MongoDB的逻辑运算符</a></li></ul></li><li><a href=#mongodb-type操作符>MongoDB $type操作符</a></li><li><a href=#mongodb-limit和skip方法>MongoDB Limit和Skip方法</a></li><li><a href=#mongodb-sort方法>MongoDB sort方法</a></li><li><a href=#mongodb-索引>MongoDB 索引</a></li><li><a href=#mongodb-aggregate-方法>MongoDB aggregate() 方法</a><ul><li><a href=#管道>管道</a><ul><li><a href=#管道操作符实例>管道操作符实例</a></li></ul></li></ul></li></ul></nav></div></details></div><div class=post-content><h1 id=mongodb简介>MongoDB简介<a hidden class=anchor aria-hidden=true href=#mongodb简介>#</a></h1><p>MongoDB是一个基于分布式文件存储的数据库。由C++语言编写。旨在为WEB应用提供一个可扩展的高性能数据存储解决方案。MongoDB是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的。
<strong>MongoDB官网地址：</strong> <a href=https://www.mongodb.com>MongoDB官网</a></p><h1 id=mongodb概念>MongoDB概念<a hidden class=anchor aria-hidden=true href=#mongodb概念>#</a></h1><table><thead><tr><th>SQL术语</th><th>MongoDB术语</th><th>说明</th></tr></thead><tbody><tr><td>database</td><td>database</td><td>数据库</td></tr><tr><td>table</td><td>collection</td><td>数据库表/集合</td></tr><tr><td>row</td><td>document</td><td>数据记录行/文档</td></tr><tr><td>column</td><td>field</td><td>数据字段/域</td></tr><tr><td>index</td><td>index</td><td>索引</td></tr><tr><td>table joins</td><td></td><td>表连接，MongoDB不支持表连接</td></tr><tr><td>primary key</td><td>primary key</td><td>主键/MongoDB自动将_id字段设置为主键</td></tr></tbody></table><h2 id=数据库>数据库<a hidden class=anchor aria-hidden=true href=#数据库>#</a></h2><p>MongoDB中可以建立多个数据库，默认的数据库为<code>db</code> ，该数据库存储在data目录中，每一个数据库都有自己集合和权限，不同的数据库放置在不同的文件中。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 显示MongoDB服务器上的所有数据库</span>
</span></span><span class=line><span class=cl>show dbs
</span></span><span class=line><span class=cl><span class=c1># 示例输出</span>
</span></span><span class=line><span class=cl><span class=c1># admin 0.000GB </span>
</span></span><span class=line><span class=cl><span class=c1># local 0.000GB</span>
</span></span><span class=line><span class=cl><span class=c1># test 0.001GB</span>
</span></span><span class=line><span class=cl><span class=c1># 显示当前所使用的数据库</span>
</span></span><span class=line><span class=cl>db
</span></span><span class=line><span class=cl><span class=c1># 指定使用某个数据库</span>
</span></span><span class=line><span class=cl>use <span class=nb>local</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>MongoDB默认自带三个数据库：<code>admin</code>、<code>local</code>、<code>config</code></p></blockquote><ul><li><code>admin</code> 数据库：MongoDB中主要的管理数据库，包含了MongoDB实例的所有用户和角色信息。通过该数据库可以进行用户管理、权限分配以及控制MongoDB实例的运行状态等操作。</li><li><code>local</code> 数据库：这是一个存储临时数据的地方，例如复制同步过程中的操作日志。在这个数据库中，可以找到一些关键的集合(collection)，例如<code>startup_log</code>和<code>oplog.rws</code> ，它们记录了MongoDB实例的启动日志和操作日志。</li><li><code>config</code> 数据库：包含了MongoDB的分片信息，用于支持分片集群。在一个分片集群中，每个节点都有一个<code>config</code> 数据库，用于存储集群的各种配置和元数据。
<strong>数据库的名字应是满足以下条件的任意UTF-8字符串：</strong></li></ul><ol><li>不能是空字符串</li><li>不得含有&rsquo; &lsquo;（空格)、.、$、/、\和\0 (空字符)</li><li>应全部小写</li><li>最多64字节</li></ol><h2 id=文档document>文档(Document)<a hidden class=anchor aria-hidden=true href=#文档document>#</a></h2><p>文档是一组键值(key-value)对(即BSON)。MongoDB的文档不需要设置相同的字段，并且相同的字段不需要相同的数据类型，这与关系型数据库有很大的区别，也是MongoDB的特点。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;site&#34;</span><span class=p>:</span><span class=s2>&#34;www.runoob.com&#34;</span><span class=p>,</span> <span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;菜鸟教程&#34;</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>RDBMS 与 MongoDB 对应的术语：</strong></p><table><thead><tr><th>RDBMS</th><th>MongoDB</th></tr></thead><tbody><tr><td>数据库</td><td>数据库</td></tr><tr><td>表格</td><td>集合</td></tr><tr><td>行</td><td>文档</td></tr><tr><td>列</td><td>字段</td></tr><tr><td>表联合</td><td>嵌入文档</td></tr><tr><td>主键</td><td>主键（MongoDB提供了key为_id）</td></tr></tbody></table><blockquote><p>注意：</p></blockquote><ol><li>文档中的键/值对是<strong>有序</strong>的。</li><li>文档中的值不仅可以是在双引号里面的字符串，还可以是其他几种数据类型（甚至可以是整个嵌入的文档)。</li><li>MongoDB<strong>区分类型</strong>和<strong>大小写</strong>。</li><li>MongoDB的文档<strong>不能有重复的键</strong>。</li><li>文档的<strong>键是字符串</strong>。除了少数例外情况，键可以使用任意UTF-8字符。</li></ol><p><strong>文档键的命名规范：</strong></p><ul><li>键不能含有\0 (空字符)。</li><li>.和$有特别的意义，只有在特定环境下才能使用。</li><li>以下划线"_&ldquo;开头的键是保留的(不是严格要求的)。</li></ul><h2 id=集合>集合<a hidden class=anchor aria-hidden=true href=#集合>#</a></h2><p>集合就是MongoDB文档组，类似于RDBMS（关系型数据库管理系统：Retational Database Management System）中的表格。集合存在于数据库中，没有固定的结构；集合可以插入不同格式和类型的数据，但通常情况下插入集合的数据都会有一定的关联性。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;site&#34;</span><span class=p>:</span><span class=s2>&#34;www.baidu.com&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;site&#34;</span><span class=p>:</span><span class=s2>&#34;www.google.com&#34;</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;Google&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;site&#34;</span><span class=p>:</span><span class=s2>&#34;www.runoob.com&#34;</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;菜鸟教程&#34;</span><span class=p>,</span><span class=nt>&#34;num&#34;</span><span class=p>:</span><span class=mi>5</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>当第一个文档插入时，集合就会被创建。</p></blockquote><h3 id=合法的集合名>合法的集合名<a hidden class=anchor aria-hidden=true href=#合法的集合名>#</a></h3><ul><li>集合名不能是空字符串&rdquo;"。</li><li>集合名不能含有\0字符（空字符)。</li><li>集合名不能以"system.&ldquo;开头，这是为系统集合保留的前缀。</li><li>用户创建的集合名字不能含有保留字符。有些驱动程序的确支持在集合名里面包含，这是因为某些系统生成的集合中包含该字符。除非你要访问这种系统创建的集合，否则千万不要在名字里出现$。</li></ul><h3 id=capped-collections>capped collections<a hidden class=anchor aria-hidden=true href=#capped-collections>#</a></h3><p><strong>capped collections</strong>是固定大小的collecting有很高的性能以及队列过期的特性（过期按照插入的顺序），有点类似于“RRD”。<strong>capped collections</strong> 是高性能自动的维护对象的插入顺序。非常适合类似于记录日志的功能，和标准的collection不同，必须要显示的创建一个capped collections，指定一个 collection 的大小，单位是字节。collection 的数据存储空间值提前分配的。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.createCollection<span class=o>(</span><span class=s2>&#34;mycoll&#34;</span>, <span class=o>{</span>capped:true, size:100000<span class=o>})</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>在 capped collection 中，你能添加新的对象。</li><li>能进行更新，然而，对象不会增加存储空间。如果增加，更新就会失败 。</li><li>使用 Capped Collection 不能删除一个文档，可以使用 drop() 方法删除 collection 所有的行。</li><li>删除之后，你必须显式的重新创建这个 collection。</li><li>在32bit机器中，capped collection 最大存储为 1e9( 1X109)个字节。</li></ul><h2 id=元数据>元数据<a hidden class=anchor aria-hidden=true href=#元数据>#</a></h2><p>数据库的信息是存储在集合中。它们使用系统的命名空间：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>dbname.system.*
</span></span></code></pre></td></tr></table></div></div><p>在MongoDB数据库中名字空间 <code>&lt;dbname>.system.*</code>是包含多种系统信息的特殊集合(Collection):</p><table><thead><tr><th>集合命名空间</th><th>描述</th></tr></thead><tbody><tr><td>dbname.system.namespaces</td><td>列出所有名字空间。</td></tr><tr><td>dbname.system.indexes</td><td>列出所有索引。</td></tr><tr><td>dbname.system.profile</td><td>包含数据库概要(profile)信息。</td></tr><tr><td>dbname.system.users</td><td>列出所有可访问数据库的用户。</td></tr><tr><td>dbname.local.sources</td><td>包含复制对端（slave）的服务器信息和状态。</td></tr></tbody></table><p><strong>对于修改系统集合中的对象有如下限制：</strong></p><ol><li>在{{system.indexes}}插入数据，可以创建索引。但除此之外该表信息是不可变的(特殊的drop index命令将自动更新相关信息)。</li><li>{{system.users}}是可修改的。 {{system.profile}}是可删除的。</li></ol><h2 id=mongodb-数据类型>MongoDB 数据类型<a hidden class=anchor aria-hidden=true href=#mongodb-数据类型>#</a></h2><p><strong>MongoDB中常用的几种数据类型。</strong></p><table><thead><tr><th>数据类型</th><th>描述</th></tr></thead><tbody><tr><td>String</td><td>字符串。存储数据常用的数据类型。在 MongoDB 中，UTF-8 编码的字符串才是合法的。</td></tr><tr><td>Integer</td><td>整型数值。用于存储数值。根据你所采用的服务器，可分为 32 位或 64 位。</td></tr><tr><td>Boolean</td><td>布尔值。用于存储布尔值（真/假）。</td></tr><tr><td>Double</td><td>双精度浮点值。用于存储浮点值。</td></tr><tr><td>Min/Max keys</td><td>将一个值与 BSON（二进制的 JSON）元素的最低值和最高值相对比。</td></tr><tr><td>Array</td><td>用于将数组或列表或多个值存储为一个键。</td></tr><tr><td>Timestamp</td><td>时间戳。记录文档修改或添加的具体时间。</td></tr><tr><td>Object</td><td>用于内嵌文档。</td></tr><tr><td>Null</td><td>用于创建空值。</td></tr><tr><td>Symbol</td><td>符号。该数据类型基本上等同于字符串类型，但不同的是，它一般用于采用特殊符号类型的语言。</td></tr><tr><td>Date</td><td>日期时间。用 UNIX 时间格式来存储当前日期或时间。你可以指定自己的日期时间：创建 Date 对象，传入年月日信息。</td></tr><tr><td>Object ID</td><td>对象 ID。用于创建文档的 ID。</td></tr><tr><td>Binary Data</td><td>二进制数据。用于存储二进制数据。</td></tr><tr><td>Code</td><td>代码类型。用于在文档中存储 JavaScript 代码。</td></tr><tr><td>Regular expression</td><td>正则表达式类型。用于存储正则表达式。</td></tr></tbody></table><h3 id=重要的数据类型>重要的数据类型<a hidden class=anchor aria-hidden=true href=#重要的数据类型>#</a></h3><h4 id=objectid>ObjectId<a hidden class=anchor aria-hidden=true href=#objectid>#</a></h4><p>ObjectId 类似唯一主键，可以很快的去生成和排序，包含 12 bytes，含义是：</p><ul><li>前 4 个字节表示创建 <strong>unix</strong> 时间戳,格林尼治时间 <strong>UTC</strong> 时间，比北京时间晚了 8 个小时</li><li>接下来的 3 个字节是机器标识码</li><li>紧接的两个字节由进程 id 组成 PID</li><li>最后三个字节是随机数
<img loading=lazy src=https://www.runoob.com/wp-content/uploads/2013/10/2875754375-5a19268f0fd9b_articlex.jpeg>
MongoDB 中存储的文档必须有一个 _id 键。这个键的值可以是任何类型的，默认是个 ObjectId 对象</li></ul><p>由于 ObjectId 中保存了创建的时间戳，所以你不需要为你的文档保存时间戳字段，你可以通过 getTimestamp 函数来获取文档的创建时间:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; var <span class=nv>newObject</span> <span class=o>=</span> ObjectId<span class=o>()</span>
</span></span><span class=line><span class=cl>&gt; newObject.getTimestamp<span class=o>()</span>
</span></span><span class=line><span class=cl>ISODate<span class=o>(</span><span class=s2>&#34;2017-11-25T07:21:10Z&#34;</span><span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><p>ObjectId 转为字符串</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; newObject.str
</span></span><span class=line><span class=cl>5a1919e63df83ce79df8b38f
</span></span></code></pre></td></tr></table></div></div><h4 id=字符串>字符串<a hidden class=anchor aria-hidden=true href=#字符串>#</a></h4><p><strong>BSON 字符串都是 UTF-8 编码。</strong></p><h4 id=时间戳>时间戳<a hidden class=anchor aria-hidden=true href=#时间戳>#</a></h4><p>BSON 有一个特殊的时间戳类型用于 MongoDB 内部使用，与普通的 日期 类型不相关。 时间戳值是一个 64 位的值。其中：</p><ul><li>前32位是一个 time_t 值（与Unix新纪元相差的秒数）</li><li>后32位是在某秒中操作的一个递增的<code>序数</code>
在单个 mongod 实例中，时间戳值通常是唯一的。在复制集中， oplog 有一个 ts 字段。这个字段中的值使用BSON时间戳表示了操作时间。</li></ul><blockquote><p>BSON 时间戳类型主要用于 MongoDB 内部使用。在大多数情况下的应用开发中，你可以使用 BSON 日期类型。</p></blockquote><h4 id=日期>日期<a hidden class=anchor aria-hidden=true href=#日期>#</a></h4><p>表示当前距离 Unix新纪元（1970年1月1日）的毫秒数。日期类型是有符号的, 负数表示 1970 年之前的日期。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; var <span class=nv>mydate1</span> <span class=o>=</span> new Date<span class=o>()</span>     //格林尼治时间
</span></span><span class=line><span class=cl>&gt; mydate1
</span></span><span class=line><span class=cl>ISODate<span class=o>(</span><span class=s2>&#34;2018-03-04T14:58:51.233Z&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>&gt; typeof mydate1
</span></span><span class=line><span class=cl>object
</span></span><span class=line><span class=cl>&gt; var <span class=nv>mydate2</span> <span class=o>=</span> ISODate<span class=o>()</span> //格林尼治时间
</span></span><span class=line><span class=cl>&gt; mydate2
</span></span><span class=line><span class=cl>ISODate<span class=o>(</span><span class=s2>&#34;2018-03-04T15:00:45.479Z&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>&gt; typeof mydate2
</span></span><span class=line><span class=cl>object
</span></span></code></pre></td></tr></table></div></div><p>这样创建的时间是日期类型，可以使用 JS 中的 Date 类型的方法。返回一个时间类型的字符串：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; var <span class=nv>mydate1str</span> <span class=o>=</span> mydate1.toString<span class=o>()</span>
</span></span><span class=line><span class=cl>&gt; mydate1str
</span></span><span class=line><span class=cl>Sun Mar <span class=m>04</span> <span class=m>2018</span> 14:58:51 GMT+0000 <span class=o>(</span>UTC<span class=o>)</span> 
</span></span><span class=line><span class=cl>&gt; typeof mydate1str
</span></span><span class=line><span class=cl>string
</span></span><span class=line><span class=cl>&gt; Date<span class=o>()</span>
</span></span><span class=line><span class=cl>Sun Mar <span class=m>04</span> <span class=m>2018</span> 15:02:59 GMT+0000 <span class=o>(</span>UTC<span class=o>)</span>   
</span></span></code></pre></td></tr></table></div></div><h1 id=mongodb连接>MongoDB连接<a hidden class=anchor aria-hidden=true href=#mongodb连接>#</a></h1><p><strong>连接MongoDB的URL语法</strong>
<code>mongodb://[username:password@]host1[:port1][,host2[:port2],...[,hostN[:portN]]][/[database][?options]]</code></p><ul><li><strong>mongodb://</strong> 这是固定的格式，必须要指定。</li><li><strong>username:password@</strong> 可选项，如果设置，在连接数据库服务器之后，驱动都会尝试登录这个数据库</li><li><strong>host1</strong> 必须的指定至少一个host, host1 是这个URI唯一要填写的。它指定了要连接服务器的地址。如果要连接复制集，请指定多个主机地址。</li><li><strong>portX</strong> 可选的指定端口，如果不填，默认为27017</li><li><strong>/database</strong> 如果指定username:password@，连接并验证登录指定数据库。若不指定，默认打开 test 数据库。</li><li><strong>?options</strong> 是连接选项。如果不使用/database，则前面需要加上/。所有连接选项都是键值对name=value，键值对之间通过&或;（分号）隔开
<strong>连接URL案例：</strong> <code>mongodb://admin:123456@localhost/test</code>
<strong>options选项：</strong></li></ul><table><thead><tr><th>选项</th><th>描述</th></tr></thead><tbody><tr><td>replicaSet=name</td><td>验证replica set的名称。 Impliesconnect=replicaSet.</td></tr><tr><td>slaveOk=true|false</td><td>- true:在connect=direct模式下，驱动会连接第一台机器，即使这台服务器不是主。在connect=replicaSet模式下，驱动会发送所有的写请求到主并且把读取操作分布在其他从服务器。- false: 在 connect=direct模式下，驱动会自动找寻主服务器. 在connect=replicaSet 模式下，驱动仅仅连接主服务器，并且所有的读写命令都连接到主服务器。</td></tr><tr><td>safe=true|false</td><td>- true: 在执行更新操作之后，驱动都会发送getLastError命令来确保更新成功。(还要参考 wtimeoutMS).false: 在每次更新之后，驱动不会发送getLastError来确保更新成功。</td></tr><tr><td>w=n</td><td>驱动添加 { w : n } 到getLastError命令. 应用于safe=true。</td></tr><tr><td>wtimeoutMS=ms</td><td>驱动添加 { wtimeout : ms } 到 getlasterror 命令. 应用于 safe=true.</td></tr><tr><td>fsync=true|false</td><td>- true: 驱动添加 { fsync : true } 到 getlasterror 命令.应用于 safe=true.- false: 驱动不会添加到getLastError命令中。</td></tr><tr><td>journal=true|false</td><td>如果设置为 true, 同步到 journal (在提交到数据库前写入到实体中). 应用于 safe=true</td></tr><tr><td>connectTimeoutMS=ms</td><td>可以打开连接的时间。</td></tr><tr><td>socketTimeoutMS=ms</td><td>发送和接受sockets的时间。</td></tr></tbody></table><h1 id=mongodb创建数据库>MongoDB创建数据库<a hidden class=anchor aria-hidden=true href=#mongodb创建数据库>#</a></h1><p>MongoDB创建数据库的语法格式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>use DATABASE_NAME
</span></span></code></pre></td></tr></table></div></div><blockquote><p>创建一个数据库</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>use runoob
</span></span><span class=line><span class=cl><span class=c1># 查看数据库</span>
</span></span><span class=line><span class=cl>db
</span></span><span class=line><span class=cl>runoob
</span></span><span class=line><span class=cl><span class=c1># 插入一条数据</span>
</span></span><span class=line><span class=cl>db.runoob.insertOne<span class=o>({</span><span class=s2>&#34;name&#34;</span>:<span class=s2>&#34;lyj&#34;</span><span class=o>})</span>
</span></span><span class=line><span class=cl><span class=c1># 查看所有数据库，发现新建的数据库已存在</span>
</span></span><span class=line><span class=cl>show dbs
</span></span><span class=line><span class=cl>admin   0.000GB
</span></span><span class=line><span class=cl>config  0.000GB
</span></span><span class=line><span class=cl><span class=nb>local</span>   0.000GB
</span></span><span class=line><span class=cl>lyj     0.000GB
</span></span></code></pre></td></tr></table></div></div><blockquote><p>如果现在查看所有数据库，会发现当前新建的数据库并不存在，只有往数据库中插入数据之后，才能查看到</p></blockquote><h1 id=mongodb删除数据库>MongoDB删除数据库<a hidden class=anchor aria-hidden=true href=#mongodb删除数据库>#</a></h1><p>MongoDB删除数据库的语法格式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.dropDatabase<span class=o>()</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>删除数据库具体操作</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 选中需要删除的数据库</span>
</span></span><span class=line><span class=cl>use lyj
</span></span><span class=line><span class=cl><span class=c1># 执行删除数据库的命令</span>
</span></span><span class=line><span class=cl>db.dropDatabase<span class=o>()</span>
</span></span><span class=line><span class=cl><span class=c1># 查看所有数据库，发现新建的数据库已删除</span>
</span></span><span class=line><span class=cl>show dbs
</span></span><span class=line><span class=cl>admin   0.000GB
</span></span><span class=line><span class=cl>config  0.000GB
</span></span><span class=line><span class=cl><span class=nb>local</span>   0.000GB
</span></span></code></pre></td></tr></table></div></div><h1 id=mongodb创建集合>MongoDB创建集合<a hidden class=anchor aria-hidden=true href=#mongodb创建集合>#</a></h1><p>MongoDB创建集合的语法格式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.createCollection<span class=o>(</span>name, options<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>options具体参数</strong></p><table><thead><tr><th>字段</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>capped</td><td>布尔</td><td>（可选）如果为 true，则创建固定集合。固定集合是指有着固定大小的集合，当达到最大值时，它会自动覆盖最早的文档。 <strong>当该值为 true 时，必须指定 size 参数。</strong></td></tr><tr><td>autoIndexId</td><td>布尔</td><td>3.2 之后不再支持该参数。（可选）如为 true，自动在 _id 字段创建索引。默认为 false。</td></tr><tr><td>size</td><td>数值</td><td>（可选）为固定集合指定一个最大值，即字节数。 <strong>如果 capped 为 true，也需要指定该字段。</strong></td></tr><tr><td>max</td><td>数值</td><td>（可选）指定固定集合中包</td></tr></tbody></table><blockquote><p>创建集合</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 创建数据库</span>
</span></span><span class=line><span class=cl>use <span class=nb>test</span>
</span></span><span class=line><span class=cl><span class=c1># 创建集合</span>
</span></span><span class=line><span class=cl>db.createCollection<span class=o>(</span><span class=s2>&#34;lyj&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=c1># 查看已有集合show collections/show tables两个命令都是查询已有集合</span>
</span></span><span class=line><span class=cl>show collections
</span></span><span class=line><span class=cl>lyj
</span></span></code></pre></td></tr></table></div></div><h1 id=mongodb删除集合>MongoDB删除集合<a hidden class=anchor aria-hidden=true href=#mongodb删除集合>#</a></h1><p>MongoDB删除集合的语法格式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.collection.drop<span class=o>()</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>删除集合</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 删除名叫lyj的集合</span>
</span></span><span class=line><span class=cl>db.lyj.drop<span class=o>()</span>
</span></span><span class=line><span class=cl><span class=c1># 查看是否删除成功</span>
</span></span><span class=line><span class=cl>show tables
</span></span></code></pre></td></tr></table></div></div><h1 id=mongodb插入文档>MongoDB插入文档<a hidden class=anchor aria-hidden=true href=#mongodb插入文档>#</a></h1><p>MongoDB插入文档的语法格式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.COLLECTION_NAME.insert<span class=o>(</span>document<span class=o>)</span>
</span></span><span class=line><span class=cl>或
</span></span><span class=line><span class=cl>db.COLLECTION_NAME.save<span class=o>(</span>document<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>save()：如果 _id 主键存在则更新数据，如果不存在就插入数据。该方法新版本中已废弃，可以使用 <strong>db.collection.insertOne()</strong> 或 <strong>db.collection.replaceOne()</strong> 来代替。</li><li>insert(): 若插入的数据主键已经存在，则会抛 <strong>org.springframework.dao.DuplicateKeyException</strong> 异常，提示主键重复，不保存当前数据。
<strong>3.2 版本之后新增了 db.collection.insertOne() 和 db.collection.insertMany()。</strong>
<code>db.collection.insertOne()</code> 语法格式：</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.collection.insertOne<span class=o>(</span>
</span></span><span class=line><span class=cl>   &lt;document&gt;,
</span></span><span class=line><span class=cl>   <span class=o>{</span>
</span></span><span class=line><span class=cl>      writeConcern: &lt;document&gt;
</span></span><span class=line><span class=cl>   <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><p><code>db.collection.insertMany()</code> 语法格式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.collection.insertMany<span class=o>(</span>
</span></span><span class=line><span class=cl>   <span class=o>[</span> &lt;document 1&gt; , &lt;document 2&gt;, ... <span class=o>]</span>,
</span></span><span class=line><span class=cl>   <span class=o>{</span>
</span></span><span class=line><span class=cl>      writeConcern: &lt;document&gt;,
</span></span><span class=line><span class=cl>      ordered: &lt;boolean&gt;
</span></span><span class=line><span class=cl>   <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><p>参数说明：</p><ul><li>document：要写入的文档。</li><li>writeConcern：写入策略，默认为 1，即要求确认写操作，0 是不要求。</li><li>ordered：指定是否按顺序写入，默认 true，按顺序写入</li></ul><blockquote><p><code>insertOne()</code> 表示插入一条数据，<code>insertMany()</code> 表示插入多条数据</p></blockquote><p>插入文档</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 该命令会往test数据的lyj集合中插入文档</span>
</span></span><span class=line><span class=cl>db.lyj.insert<span class=o>({</span>title: <span class=s1>&#39;MongoDB 教程&#39;</span>, 
</span></span><span class=line><span class=cl>    description: <span class=s1>&#39;MongoDB 是一个 Nosql 数据库&#39;</span>,
</span></span><span class=line><span class=cl>    by: <span class=s1>&#39;菜鸟教程&#39;</span>,
</span></span><span class=line><span class=cl>    url: <span class=s1>&#39;http://www.runoob.com&#39;</span>,
</span></span><span class=line><span class=cl>    tags: <span class=o>[</span><span class=s1>&#39;mongodb&#39;</span>, <span class=s1>&#39;database&#39;</span>, <span class=s1>&#39;NoSQL&#39;</span><span class=o>]</span>,
</span></span><span class=line><span class=cl>    likes: <span class=m>100</span>
</span></span><span class=line><span class=cl><span class=o>})</span>
</span></span><span class=line><span class=cl><span class=c1># 查看已插入的文档</span>
</span></span><span class=line><span class=cl>db.lyj.find<span class=o>()</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=mongodb更新文档>MongoDB更新文档<a hidden class=anchor aria-hidden=true href=#mongodb更新文档>#</a></h1><p>MongoDB更新文档的语法格式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.collection.update<span class=o>(</span>
</span></span><span class=line><span class=cl>   &lt;query&gt;,
</span></span><span class=line><span class=cl>   &lt;update&gt;,
</span></span><span class=line><span class=cl>   <span class=o>{</span>
</span></span><span class=line><span class=cl>     upsert: &lt;boolean&gt;,
</span></span><span class=line><span class=cl>     multi: &lt;boolean&gt;,
</span></span><span class=line><span class=cl>     writeConcern: &lt;document&gt;
</span></span><span class=line><span class=cl>   <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>参数说明：</strong></p><ul><li><strong>query</strong> : update的查询条件，类似sql update查询内where后面的。</li><li><strong>update</strong> : update的对象和一些更新的操作符（如$,$inc&mldr;）等，也可以理解为sql update查询内set后面的</li><li><strong>upsert</strong> : 可选，这个参数的意思是，如果不存在update的记录，是否插入objNew,true为插入，默认是false，不插入。</li><li><strong>multi</strong> : 可选，mongodb 默认是false,只更新找到的第一条记录，如果这个参数为true,就把按条件查出来多条记录全部更新。</li><li><strong>writeConcern</strong> :可选，抛出异常的级别。</li></ul><blockquote><p>更新文档</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.lyj.update<span class=o>({</span><span class=s1>&#39;title&#39;</span>:<span class=s1>&#39;MongoDB 教程&#39;</span><span class=o>}</span>,<span class=o>{</span><span class=nv>$set</span>:<span class=o>{</span><span class=s1>&#39;title&#39;</span>:<span class=s1>&#39;MongoDB&#39;</span><span class=o>}})</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=mongodb删除文档>MongoDB删除文档<a hidden class=anchor aria-hidden=true href=#mongodb删除文档>#</a></h1><p>MongoDB删除数据库的语法格式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.collection.remove<span class=o>(</span>
</span></span><span class=line><span class=cl>   &lt;query&gt;,
</span></span><span class=line><span class=cl>   <span class=o>{</span>
</span></span><span class=line><span class=cl>     justOne: &lt;boolean&gt;,
</span></span><span class=line><span class=cl>     writeConcern: &lt;document&gt;
</span></span><span class=line><span class=cl>   <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>参数说明：</strong></p><ul><li><strong>query</strong> :（可选）删除的文档的条件。</li><li><strong>justOne</strong> : （可选）如果设为 true 或 1，则只删除一个文档，如果不设置该参数，或使用默认值 false，则删除所有匹配条件的文档。</li><li><strong>writeConcern</strong> :（可选）抛出异常的级别。</li></ul><blockquote><p>删除文档</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.lyj.remove<span class=o>({</span><span class=s1>&#39;title&#39;</span>:<span class=s1>&#39;MongoDB 教程&#39;</span><span class=o>})</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=mongodb查询文档>MongoDB查询文档<a hidden class=anchor aria-hidden=true href=#mongodb查询文档>#</a></h1><p>MongoDB查询文档的语法格式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.collection.find<span class=o>(</span>query, projection<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>query</strong> ：可选，使用查询操作符指定查询条件</li><li><strong>projection</strong> ：可选，使用投影操作符指定返回的键。查询时返回文档中所有键值， 只需省略该参数即可（默认省略）。</li></ul><blockquote><p>pretty() 方法以格式化的方式来显示所有文档<code>db.lyj.find().pretty()</code></p></blockquote><h2 id=mongodb-与-rdbms-where-语句比较>MongoDB 与 RDBMS Where 语句比较<a hidden class=anchor aria-hidden=true href=#mongodb-与-rdbms-where-语句比较>#</a></h2><table><thead><tr><th>操作</th><th>格式</th><th>范例</th><th>RDBMS中的类似语句</th></tr></thead><tbody><tr><td>等于</td><td><code>{&lt;key>:&lt;value></code>}</td><td><code>db.col.find({"by":"菜鸟教程"}).pretty()</code></td><td><code>where by = '菜鸟教程'</code></td></tr><tr><td>小于</td><td><code>{&lt;key>:{$lt:&lt;value>}}</code></td><td><code>db.col.find({"likes":{$lt:50}}).pretty()</code></td><td><code>where likes &lt; 50</code></td></tr><tr><td>小于或等于</td><td><code>{&lt;key>:{$lte:&lt;value>}}</code></td><td><code>db.col.find({"likes":{$lte:50}}).pretty()</code></td><td><code>where likes &lt;= 50</code></td></tr><tr><td>大于</td><td><code>{&lt;key>:{$gt:&lt;value>}}</code></td><td><code>db.col.find({"likes":{$gt:50}}).pretty()</code></td><td><code>where likes > 50</code></td></tr><tr><td>大于或等于</td><td><code>{&lt;key>:{$gte:&lt;value>}}</code></td><td><code>db.col.find({"likes":{$gte:50}}).pretty()</code></td><td><code>where likes >= 50</code></td></tr><tr><td>不等于</td><td><code>{&lt;key>:{$ne:&lt;value>}}</code></td><td><code>db.col.find({"likes":{$ne:50}}).pretty()</code></td><td><code>where likes != 50</code></td></tr></tbody></table><h2 id=mongodb的逻辑运算符>MongoDB的逻辑运算符<a hidden class=anchor aria-hidden=true href=#mongodb的逻辑运算符>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># and运算符</span>
</span></span><span class=line><span class=cl>db.lyj.find<span class=o>({</span>key1:value1, key2:value2<span class=o>})</span>.pretty<span class=o>()</span>
</span></span><span class=line><span class=cl><span class=c1># 案例</span>
</span></span><span class=line><span class=cl>db.lyj.find<span class=o>({</span><span class=s2>&#34;by&#34;</span>:<span class=s2>&#34;菜鸟教程&#34;</span>, <span class=s2>&#34;title&#34;</span>:<span class=s2>&#34;MongoDB 教程&#34;</span><span class=o>})</span>.pretty<span class=o>()</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;_id&#34;</span> : ObjectId<span class=o>(</span><span class=s2>&#34;56063f17ade2f21f36b03133&#34;</span><span class=o>)</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;title&#34;</span> : <span class=s2>&#34;MongoDB 教程&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;description&#34;</span> : <span class=s2>&#34;MongoDB 是一个 Nosql 数据库&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;by&#34;</span> : <span class=s2>&#34;菜鸟教程&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;url&#34;</span> : <span class=s2>&#34;http://www.runoob.com&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;tags&#34;</span> : <span class=o>[</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;mongodb&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;database&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;NoSQL&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>]</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;likes&#34;</span> : <span class=m>100</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=c1># or运算符</span>
</span></span><span class=line><span class=cl>&gt;db.col.find<span class=o>(</span>
</span></span><span class=line><span class=cl>   <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=nv>$or</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>         <span class=o>{</span>key1: value1<span class=o>}</span>, <span class=o>{</span>key2:value2<span class=o>}</span>
</span></span><span class=line><span class=cl>      <span class=o>]</span>
</span></span><span class=line><span class=cl>   <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>)</span>.pretty<span class=o>()</span>
</span></span><span class=line><span class=cl><span class=c1># 案例</span>
</span></span><span class=line><span class=cl>db.lyj.find<span class=o>({</span><span class=nv>$or</span>:<span class=o>[{</span><span class=s2>&#34;by&#34;</span>:<span class=s2>&#34;菜鸟教程&#34;</span><span class=o>}</span>,<span class=o>{</span><span class=s2>&#34;title&#34;</span>: <span class=s2>&#34;MongoDB 教程&#34;</span><span class=o>}]})</span>.pretty<span class=o>()</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;_id&#34;</span> : ObjectId<span class=o>(</span><span class=s2>&#34;56063f17ade2f21f36b03133&#34;</span><span class=o>)</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;title&#34;</span> : <span class=s2>&#34;MongoDB 教程&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;description&#34;</span> : <span class=s2>&#34;MongoDB 是一个 Nosql 数据库&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;by&#34;</span> : <span class=s2>&#34;菜鸟教程&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;url&#34;</span> : <span class=s2>&#34;http://www.runoob.com&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;tags&#34;</span> : <span class=o>[</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;mongodb&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;database&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;NoSQL&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>]</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;likes&#34;</span> : <span class=m>100</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=c1># and和or一起使用</span>
</span></span><span class=line><span class=cl>db.lyj.find<span class=o>({</span><span class=s2>&#34;likes&#34;</span>: <span class=o>{</span><span class=nv>$gt</span>:50<span class=o>}</span>, <span class=nv>$or</span>: <span class=o>[{</span><span class=s2>&#34;by&#34;</span>: <span class=s2>&#34;菜鸟教程&#34;</span><span class=o>}</span>,<span class=o>{</span><span class=s2>&#34;title&#34;</span>: <span class=s2>&#34;MongoDB 教程&#34;</span><span class=o>}]})</span>.pretty<span class=o>()</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;_id&#34;</span> : ObjectId<span class=o>(</span><span class=s2>&#34;56063f17ade2f21f36b03133&#34;</span><span class=o>)</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;title&#34;</span> : <span class=s2>&#34;MongoDB 教程&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;description&#34;</span> : <span class=s2>&#34;MongoDB 是一个 Nosql 数据库&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;by&#34;</span> : <span class=s2>&#34;菜鸟教程&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;url&#34;</span> : <span class=s2>&#34;http://www.runoob.com&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;tags&#34;</span> : <span class=o>[</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;mongodb&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;database&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;NoSQL&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>]</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;likes&#34;</span> : <span class=m>100</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=mongodb-type操作符>MongoDB $type操作符<a hidden class=anchor aria-hidden=true href=#mongodb-type操作符>#</a></h1><p><code>$type</code>操作符是基于BSON类型来检索集合中匹配的数据类型，并返回结果。
<strong>MongoDB 中可以使用的类型如下表所示：</strong></p><table><thead><tr><th><strong>类型</strong></th><th><strong>数字</strong></th><th><strong>备注</strong></th></tr></thead><tbody><tr><td>Double</td><td>1</td><td></td></tr><tr><td>String</td><td>2</td><td></td></tr><tr><td>Object</td><td>3</td><td></td></tr><tr><td>Array</td><td>4</td><td></td></tr><tr><td>Binary data</td><td>5</td><td></td></tr><tr><td>Undefined</td><td>6</td><td>已废弃。</td></tr><tr><td>Object id</td><td>7</td><td></td></tr><tr><td>Boolean</td><td>8</td><td></td></tr><tr><td>Date</td><td>9</td><td></td></tr><tr><td>Null</td><td>10</td><td></td></tr><tr><td>Regular Expression</td><td>11</td><td></td></tr><tr><td>JavaScript</td><td>13</td><td></td></tr><tr><td>Symbol</td><td>14</td><td></td></tr><tr><td>JavaScript (with scope)</td><td>15</td><td></td></tr><tr><td>32-bit integer</td><td>16</td><td></td></tr><tr><td>Timestamp</td><td>17</td><td></td></tr><tr><td>64-bit integer</td><td>18</td><td></td></tr><tr><td>Min key</td><td>255</td><td>Query with -1.</td></tr><tr><td>Max key</td><td>127</td><td></td></tr><tr><td><strong>案列</strong></td><td></td><td></td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 想获取 &#34;col&#34; 集合中 title 为 String 的数据，这两个的含义都是一样的</span>
</span></span><span class=line><span class=cl>db.col.find<span class=o>({</span><span class=s2>&#34;title&#34;</span> : <span class=o>{</span><span class=nv>$type</span> : 2<span class=o>}})</span>
</span></span><span class=line><span class=cl>db.col.find<span class=o>({</span><span class=s2>&#34;title&#34;</span> : <span class=o>{</span><span class=nv>$type</span> : <span class=s1>&#39;string&#39;</span><span class=o>}})</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=mongodb-limit和skip方法>MongoDB Limit和Skip方法<a hidden class=anchor aria-hidden=true href=#mongodb-limit和skip方法>#</a></h1><p>MongoDB的Limit()方法的语法格式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.COLLECTION_NAME.find<span class=o>()</span>.limit<span class=o>(</span>NUMBER<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>Limit()方法</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.lyj.find<span class=o>({}</span>,<span class=o>{</span><span class=s2>&#34;title&#34;</span>:lyj,_id:0<span class=o>})</span>.limit<span class=o>(</span>2<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><p>MongoDB的Skip()方法的语法格式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.COLLECTION_NAME.find<span class=o>()</span>.limit<span class=o>(</span>NUMBER<span class=o>)</span>.skip<span class=o>(</span>NUMBER<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>Skip()方法</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.lyj.find<span class=o>({}</span>,<span class=o>{</span><span class=s2>&#34;title&#34;</span>:1,_id:0<span class=o>})</span>.limit<span class=o>(</span>1<span class=o>)</span>.skip<span class=o>(</span>1<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=mongodb-sort方法>MongoDB sort方法<a hidden class=anchor aria-hidden=true href=#mongodb-sort方法>#</a></h1><p>在 MongoDB 中使用 sort() 方法对数据进行排序，sort() 方法可以通过参数指定排序的字段，并使用 1 和 -1 来指定排序的方式，其中 1 为升序排列，而 -1 是用于降序排列。
sort()方法的语法格式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.COLLECTION_NAME.find<span class=o>()</span>.sort<span class=o>({</span>KEY:1<span class=o>})</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>sort()方法</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.lyj.find<span class=o>({}</span>,<span class=o>{</span><span class=s2>&#34;title&#34;</span>:1,_id:0<span class=o>})</span>.sort<span class=o>({</span><span class=s2>&#34;likes&#34;</span>:-1<span class=o>})</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=mongodb-索引>MongoDB 索引<a hidden class=anchor aria-hidden=true href=#mongodb-索引>#</a></h1><p>索引通常能够极大的提高查询的效率，如果没有索引，MongoDB在读取数据时必须扫描集合中的每个文件并选取那些符合查询条件的记录。
这种扫描全集合的查询效率是非常低的，特别在处理大量的数据时，查询可能要花费几十秒甚至几分钟，这对网站的性能是非常致命的。
索引是特殊的数据结构，索引存储在一个易于遍历读取的数据集合中，索引是对数据库表中一列或多列的值进行排序的一种结构</p><blockquote><p>MongoDB使用 createIndex() 方法来创建索引。</p></blockquote><p>createIndex()方法基本语法格式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.collection.createIndex<span class=o>(</span>keys, options<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=c1># 实例</span>
</span></span><span class=line><span class=cl>db.lyj.createIndex<span class=o>({</span><span class=s2>&#34;title&#34;</span>:1<span class=o>})</span>
</span></span></code></pre></td></tr></table></div></div><p>createIndex() 接收可选参数，可选参数列表：</p><table><thead><tr><th>Parameter</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>background</td><td>Boolean</td><td>建索引过程会阻塞其它数据库操作，background可指定以后台方式创建索引，即增加 &ldquo;background&rdquo; 可选参数。 &ldquo;background&rdquo; 默认值为<strong>false</strong>。</td></tr><tr><td>unique</td><td>Boolean</td><td>建立的索引是否唯一。指定为true创建唯一索引。默认值为<strong>false</strong>.</td></tr><tr><td>name</td><td>string</td><td>索引的名称。如果未指定，MongoDB的通过连接索引的字段名和排序顺序生成一个索引名称。</td></tr><tr><td>dropDups</td><td>Boolean</td><td>3.0+版本已废弃。在建立唯一索引时是否删除重复记录,指定 true 创建唯一索引。默认值为 <strong>false</strong>.</td></tr><tr><td>sparse</td><td>Boolean</td><td>对文档中不存在的字段数据不启用索引；这个参数需要特别注意，如果设置为true的话，在索引字段中不会查询出不包含对应字段的文档.。默认值为 <strong>false</strong>.</td></tr><tr><td>expireAfterSeconds</td><td>integer</td><td>指定一个以秒为单位的数值，完成 TTL设定，设定集合的生存时间。</td></tr><tr><td>v</td><td>index version</td><td>索引的版本号。默认的索引版本取决于mongod创建索引时运行的版本。</td></tr><tr><td>weights</td><td>document</td><td>索引权重值，数值在 1 到 99,999 之间，表示该索引相对于其他索引字段的得分权重。</td></tr><tr><td>default_language</td><td>string</td><td>对于文本索引，该参数决定了停用词及词干和词器的规则的列表。 默认为英语</td></tr><tr><td>language_override</td><td>string</td><td>对于文本索引，该参数指定了包含在文档中的字段名，语言覆盖默认的language，默认值为 language.</td></tr></tbody></table><h1 id=mongodb-aggregate-方法>MongoDB aggregate() 方法<a hidden class=anchor aria-hidden=true href=#mongodb-aggregate-方法>#</a></h1><p><code>aggregate()</code> 方法在MongoDB中的作用是聚合
aggregate() 方法的基本语法格式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>db.COLLECTION_NAME.aggregate<span class=o>(</span>AGGREGATE_OPERATION<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><p>聚合的表达式:</p><table><thead><tr><th>表达式</th><th>描述</th><th>实例</th></tr></thead><tbody><tr><td>$sum</td><td>计算总和。</td><td>db.mycol.aggregate([{$group : {_id : &ldquo;$by_user&rdquo;, num_tutorial : {$sum : &ldquo;$likes&rdquo;}}}])</td></tr><tr><td>$avg</td><td>计算平均值</td><td>db.mycol.aggregate([{$group : {_id : &ldquo;$by_user&rdquo;, num_tutorial : {$avg : &ldquo;$likes&rdquo;}}}])</td></tr><tr><td>$min</td><td>获取集合中所有文档对应值得最小值。</td><td>db.mycol.aggregate([{$group : {_id : &ldquo;$by_user&rdquo;, num_tutorial : {$min : &ldquo;$likes&rdquo;}}}])</td></tr><tr><td>$max</td><td>获取集合中所有文档对应值得最大值。</td><td>db.mycol.aggregate([{$group : {_id : &ldquo;$by_user&rdquo;, num_tutorial : {$max : &ldquo;$likes&rdquo;}}}])</td></tr><tr><td>$push</td><td>将值加入一个数组中，不会判断是否有重复的值。</td><td>db.mycol.aggregate([{$group : {_id : &ldquo;$by_user&rdquo;, url : {$push: &ldquo;$url&rdquo;}}}])</td></tr><tr><td>$addToSet</td><td>将值加入一个数组中，会判断是否有重复的值，若相同的值在数组中已经存在了，则不加入。</td><td>db.mycol.aggregate([{$group : {_id : &ldquo;$by_user&rdquo;, url : {$addToSet : &ldquo;$url&rdquo;}}}])</td></tr><tr><td>$first</td><td>根据资源文档的排序获取第一个文档数据。</td><td>db.mycol.aggregate([{$group : {_id : &ldquo;$by_user&rdquo;, first_url : {$first : &ldquo;$url&rdquo;}}}])</td></tr><tr><td>$last</td><td>根据资源文档的排序获取最后一个文档数据</td><td>db.mycol.aggregate([{$group : {_id : &ldquo;$by_user&rdquo;, last_url : {$last : &ldquo;$url&rdquo;}}}])</td></tr></tbody></table><h2 id=管道>管道<a hidden class=anchor aria-hidden=true href=#管道>#</a></h2><p>管道在Unix和Linux中一般用于将当前命令的输出结果作为下一个命令的参数。
MongoDB的聚合管道将MongoDB文档在一个管道处理完毕后将结果传递给下一个管道处理。管道操作是可以重复的。
表达式：处理输入文档并输出。表达式是无状态的，只能用于计算当前聚合管道的文档，不能处理其它的文档。
聚合框架中常用的操作：</p><ul><li>$project：修改输入文档的结构。可以用来重命名、增加或删除域，也可以用于创建计算结果以及嵌套文档。</li><li>$match：用于过滤数据，只输出符合条件的文档。$match使用MongoDB的标准查询操作。</li><li>$limit：用来限制MongoDB聚合管道返回的文档数。</li><li>$skip：在聚合管道中跳过指定数量的文档，并返回余下的文档。</li><li>$unwind：将文档中的某一个数组类型字段拆分成多条，每条包含数组中的一个值。</li><li>$group：将集合中的文档分组，可用于统计结果。</li><li>$sort：将输入文档排序后输出。</li><li>$geoNear：输出接近某一地理位置的有序文档。</li></ul><h3 id=管道操作符实例>管道操作符实例<a hidden class=anchor aria-hidden=true href=#管道操作符实例>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># $project实例</span>
</span></span><span class=line><span class=cl>db.article.aggregate<span class=o>(</span>
</span></span><span class=line><span class=cl>    <span class=o>{</span> <span class=nv>$project</span> : <span class=o>{</span>
</span></span><span class=line><span class=cl>        title : <span class=m>1</span> ,
</span></span><span class=line><span class=cl>        author : <span class=m>1</span> ,
</span></span><span class=line><span class=cl>    <span class=o>}}</span>
</span></span><span class=line><span class=cl> <span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1># $match实例</span>
</span></span><span class=line><span class=cl>db.articles.aggregate<span class=o>(</span> <span class=o>[</span>
</span></span><span class=line><span class=cl>                        <span class=o>{</span> <span class=nv>$match</span> : <span class=o>{</span> score : <span class=o>{</span> <span class=nv>$gt</span> : 70, <span class=nv>$lte</span> : <span class=m>90</span> <span class=o>}</span> <span class=o>}</span> <span class=o>}</span>,
</span></span><span class=line><span class=cl>                        <span class=o>{</span> <span class=nv>$group</span>: <span class=o>{</span> _id: null, count: <span class=o>{</span> <span class=nv>$sum</span>: <span class=m>1</span> <span class=o>}</span> <span class=o>}</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>                       <span class=o>]</span> <span class=o>)</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1># $skip实例</span>
</span></span><span class=line><span class=cl>db.article.aggregate<span class=o>(</span>
</span></span><span class=line><span class=cl>    <span class=o>{</span> <span class=nv>$skip</span> : <span class=m>5</span> <span class=o>})</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://lyj.cloudns.ch/tags/mongodb/>MongoDB</a></li></ul><nav class=paginav><a class=prev href=https://lyj.cloudns.ch/post/gitignore-file-use/><span class=title>« 上一页</span><br><span>.gitignore文件的配置使用</span>
</a><a class=next href=https://lyj.cloudns.ch/post/domain-driver-design-desciption/><span class=title>下一页 »</span><br><span>DDD领域驱动设计</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://lyj.cloudns.ch/>LYJ's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>