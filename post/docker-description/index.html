<!doctype html><html lang=zh-cn dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Docker | LYJ's Blog</title>
<meta name=keywords content="Docker,Linux"><meta name=description content="Docker是一个开源的容器引擎，是一种操作系统级别的虚拟化技术，Docker让开发者可以打包自己的应用以及依赖到一个可移植的容器当中，然后发布到任何的Linux机器上面。"><meta name=author content="LYJ"><link rel=canonical href=https://lyj.cloudns.ch/post/docker-description/><link crossorigin=anonymous href=/assets/css/stylesheet.6ac597e8fd3ec87b479e9c23e4cdc2c9aed63cb215e157732cbc8732be5732c1.css integrity="sha256-asWX6P0+yHtHnpwj5M3Cya7WPLIV4VdzLLyHMr5XMsE=" rel="preload stylesheet" as=style><link rel=icon href=https://lyj.cloudns.ch/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://lyj.cloudns.ch/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://lyj.cloudns.ch/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://lyj.cloudns.ch/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://lyj.cloudns.ch/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh-cn href=https://lyj.cloudns.ch/post/docker-description/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://lyj.cloudns.ch/post/docker-description/"><meta property="og:site_name" content="LYJ's Blog"><meta property="og:title" content="Docker"><meta property="og:description" content="Docker是一个开源的容器引擎，是一种操作系统级别的虚拟化技术，Docker让开发者可以打包自己的应用以及依赖到一个可移植的容器当中，然后发布到任何的Linux机器上面。"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2023-08-24T20:18:49+00:00"><meta property="article:modified_time" content="2023-08-24T20:18:49+00:00"><meta property="article:tag" content="Docker"><meta property="og:image" content="https://lyj.cloudns.ch/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://lyj.cloudns.ch/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Docker"><meta name=twitter:description content="Docker是一个开源的容器引擎，是一种操作系统级别的虚拟化技术，Docker让开发者可以打包自己的应用以及依赖到一个可移植的容器当中，然后发布到任何的Linux机器上面。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://lyj.cloudns.ch/post/"},{"@type":"ListItem","position":2,"name":"Docker","item":"https://lyj.cloudns.ch/post/docker-description/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Docker","name":"Docker","description":"Docker是一个开源的容器引擎，是一种操作系统级别的虚拟化技术，Docker让开发者可以打包自己的应用以及依赖到一个可移植的容器当中，然后发布到任何的Linux机器上面。","keywords":["Docker","Linux"],"articleBody":"Docker概述 Docker为什么出现？ 一款产品：开发-上线 两套环境！应用环境！应用配置！\n开发 ··· 运维。问题：我的电脑用运行！版本更新，导致服务不可用！对于运维来说，考研太大了\n环境配置是十分麻烦，每一个机器都要部署环境(集群redis,es、Hadoop)！费时费力\n发布一个项目(jar + Redis Mysql + jdk ES),项目能不能都带上环境安装打包\nDocker给以上的问题，提出了解决方案\nDocker能做什么： 虚拟机技术缺点：\n资源占用十分多 冗余步骤多 启动很慢 容器化技术\n容器化技术不是模拟一个完整的系统\n比较docker和虚拟机技术的不同：\n传统虚拟机，虚拟处一条硬件，运行一个完整的操作系统，然后在这个系统上安装软件 容器内的应用直接运行在宿主机的内，容器没有自己的内核，也没有虚拟我们的硬件，所以轻便了 每一个容器是相互隔离的，每个容器内都有一个数据自己的文件系统，互不影响 DevOps（开发、运维）\n应用更快速的交付和部署:\n传统：一堆帮助文档，安装程序\nDocker:打包镜像发布测试，一键运行\n更便捷的升级和扩缩容:\n使用了Docker之后，我们部署应用就像搭积木一样！\n项目打包为一个镜像，扩展服务器A!服务器B！\n更简单的系统运维:\n在容器化之后，我的开发，测试环境都是高度一致的\n更高效的计算机资源利用:\nDocker是内核级别的虚拟化，可以再一个物理机上运行很多的容器实例！服务器性能可以压榨到极致\nDocker安装 Docker基本组成 镜像(image)：\ndocker镜像就好比一个模板，可以通过这个模板来创建容器服务，tomcat镜像==\u003erun==\u003etomcat容器(提供服务器)\n容器(container)：\ndocker利用容器技术，独立运行一个或者一组应用，通过镜像来创建。启动，停止，删除，基本命令！\n目前可以把这个容器理解为就是一个简易的linux系统\n仓库(repository)：\n仓库就是存放镜像的地方\n仓库分为公有和私有\nDocker Hub（默认是国外的）\n阿里云……都有容器服务器(配置镜像加速)\n安装Docker 环境准备\n1.需要会一点点linux的基础\n2.CentOs7\n3.连接服务器\n环境查看\n查看系统内核版本\n1 2 3 # 系统内核是3.10以上 [root@localhost /]# uname -r 3.10.0-1160.el7.x86_64 系统版本\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 NAME=\"CentOS Linux\" VERSION=\"7 (Core)\" ID=\"centos\" ID_LIKE=\"rhel fedora\" VERSION_ID=\"7\" PRETTY_NAME=\"CentOS Linux 7 (Core)\" ANSI_COLOR=\"0;31\" CPE_NAME=\"cpe:/o:centos:centos:7\" HOME_URL=\"https://www.centos.org/\" BUG_REPORT_URL=\"https://bugs.centos.org/\" CENTOS_MANTISBT_PROJECT=\"CentOS-7\" CENTOS_MANTISBT_PROJECT_VERSION=\"7\" REDHAT_SUPPORT_PRODUCT=\"centos\" REDHAT_SUPPORT_PRODUCT_VERSION=\"7\" 帮助文档\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 #卸载旧的docker yum remove docker \\ docker-client \\ docker-client-latest \\ docker-common \\ docker-latest \\ docker-latest-logrotate \\ docker-logrotate \\ docker-engine #需要的安装包 yum install -y yum-utils #设置镜像仓库 yum-config-manager \\ --add-repo \\ https://download.docker.com/linux/centos/docker-ce.repo #阿里云的镜像 yum-config-manager \\ --add-repo \\ http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo #更新yum软件包索引 yum makecache fast #安装docker相关的 docker-ce社区 ee企业版 yum install docker-ce docker-ce-cli containerd.io #启动Dockers systemctl start docker # 查看docker版本 docker version #hello-world docker run hello-world 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 latest: Pulling from library/hello-world 2db29710123e: Pull complete Digest: sha256:80f31da1ac7b312ba29d65080fddf797dd76acfb870e677f390d5acba9741b17 Status: Downloaded newer image for hello-world:latest Hello from Docker! This message shows that your installation appears to be working correctly. To generate this message, Docker took the following steps: 1. The Docker client contacted the Docker daemon. 2. The Docker daemon pulled the \"hello-world\" image from the Docker Hub. (amd64) 3. The Docker daemon created a new container from that image which runs the executable that produces the output you are currently reading. 4. The Docker daemon streamed that output to the Docker client, which sent it to your terminal. To try something more ambitious, you can run an Ubuntu container with: $ docker run -it ubuntu bash Share images, automate workflows, and more with a free Docker ID: https://hub.docker.com/ For more examples and ideas, visit: https://docs.docker.com/get-started/ 1 2 3 4 #查看下载的hello-world镜像 [root@localhost /]# docker images REPOSITORY TAG IMAGE ID CREATED SIZE hello-world latest feb5d9fea6a5 7 months ago 13.3kB 删除docker\n1 2 3 4 # 1.卸载依赖 yum remove docker-ce docker-ce-cli containerd.io # 2.删除资源 rm -rf /var/lib/docker Docker为什么比VM快 1、Docker有着比虚拟机更少的抽象层\n2、Docker利用的是宿主机的内核，vm需要是Guest OS\n所以说，新建一个容器时，docker不需要虚拟机一样需要重新加载一个操作系统内核，避免引导。虚拟机是加载Guest OS，分钟级别的，而docker是利用宿主机的操作系统内核，省略了这个复杂的过程，秒级\nDokcer的常用命令 帮助文档 1 2 3 docker version #显示dokcer的版本系统 docker info #显示dokcer的系统信息，包括镜像和容器的数量 docker 命令 --help #万能命令 镜像命令 1 2 3 4 5 6 7 8 9 10 11 docker images #查看所有的镜像 #解释 REPOSITORY 镜像的仓库源 TAG\t镜像的标签 IMAGE ID 镜像的id CREATED 镜像的创建时间 SIZE 镜像的大小 #可选项 -a, --all # 列出所有镜像 -q, --quiet # 只显示镜像id docker search镜像搜索 1 2 3 4 5 6 7 8 9 10 11 12 13 [root@localhost lyj]# docker search mysql NAME DESCRIPTION STARS OFFICIAL AUTOMATED mysql MySQL is a widely used, open-source relation… 12562 [OK] mariadb MariaDB Server is a high performing open sou… 4830 [OK] percona Percona Server is a fork of the MySQL relati… 576 [OK] phpmyadmin phpMyAdmin - A web interface for MySQL and M… 536 [OK] bitnami/mysql Bitnami MySQL Docker Image 71 [OK] # 可选项，通过搜索来过滤 --filter=STARS=3000 [root@localhost lyj]# docker search mysql --filter=STARS=3000 NAME DESCRIPTION STARS OFFICIAL AUTOMATED mysql MySQL is a widely used, open-source relation… 12562 [OK] mariadb MariaDB Server is a high performing open sou… 4830 [OK] docker pull下载镜像 1 2 3 #下载镜像docker pull 镜像名[:tag] [root@localhost lyj]# docker pull mysql Using default tag: latest dokcer rmi 删除镜像 1 2 3 4 #全部删除 [root@localhost lyj]# docker rmi -f $(docker images -aq) #单个删除 docker rmi -f 镜像id 容器命令 说明：有了镜像才可以创建容器，Linux，下载一个centos镜像来测试学习\n1 docker pull centos 新建容器并启动 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 docker run [可选参数] image # 参数说明 --name=“Name”容器名字， tomcat01,tomcat02,用来区分容器 --d 后台方式运行 --it 使用交互方式运行，进入容器查看内容 --p 指定容器的端口 -p 8080:8080 -p ip:主机端口：容器端口 -p 主机端口：容器端口(常用) -p 容器端口 容器端口 -p 随机指定端口 # 测试，启动并进入容器 [root@localhost lyj]# docker run -it centos /bin/bash [root@a7546e01fc42 /]# ls #查看容器内的centos，基础版本，很多命令都是不完善的 bin etc lib lost+found mnt proc run srv tmp var dev home lib64 media opt root sbin sys usr #从容器中退回主机 [root@a7546e01fc42 /]# exit exit 列出所有的运行中的容器 1 2 3 4 5 6 7 8 9 10 # docker ps 命令 -a #列出当前正在运行的容器+带出历史运行过的容器 -n=? #显示最近创建的容器 -q #只显示容器的编号 [root@localhost lyj]# docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES [root@localhost lyj]# docker ps -a CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES a7546e01fc42 centos \"/bin/bash\" 3 minutes ago Exited (0) About a minute ago condescending_williams 9913150f68cb feb5d9fea6a5 \"/hello\" About an hour ago Exited (0) About an hour ago ecstatic_hodgkin 退出容器 1 2 exit #直接停止并退出容器 Ctrl + P + Q #容器不停止但退出 删除容器 1 2 3 docker rm 容器id #删除指定内容，不能删除正在运行的容器，如果要强制删除 rm -f docker rm -f $(docker ps -aq) #删除所有内容 docker ps -a -q|xargs docker rm #删除所有容器 启动和停止容器的操作 1 2 3 4 docker start 容器id #启动容器 docker restart 容器id #重启容器 docker stop 容器id #停止当前正在运行的容器 docker kill 容器id #强制停止当前容器 常用的其他命令 后台启动容器 1 2 3 4 5 6 # 命令 docker run -d 镜像名 [root@localhost lyj]# docker run -d centos 0f13a674e8d67ff74b2498339d3c21d3ff2f99b3993a4121af9fa86246be916d [root@localhost lyj]# docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES # 常见的坑：docker容器使用后台运行，就必须要有一个前台进程，docker发现没有应用，就会自动停止，容器容器后发现自己没有提供服务，就会立刻停止，就是没有程序了 查看日志 1 2 3 4 5 6 7 docker logs -f -t --tail 容器，没有日志 #自己编写一段shell脚本 \"while true;do echo lyj;slepp 1;done\" #显示日志 -tf #显示日志 --tail number #显示日志条数 docker logs -ft --tail 10 24ac83cd18b4 查看容器中的进程信息 1 2 3 4 5 #命令 docker top 容器id [root@localhost lyj]# docker top 24ac83cd18b4 UID PID PPID C STIME TTY TIME CMD root 67867 67847 0 17:00 ? 00:00:00 /bin/sh -c while true;do echo lyj;sleep 1;done root 68185 67867 0 17:03 ? 00:00:00 /usr/bin/coreutils --coreutils-prog-shebang=sleep /usr/bin/sleep 1 查看镜像的元数据 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 # 命令 [root@localhost lyj]# docker inspect 24ac83cd18b4 [ { \"Id\": \"24ac83cd18b425e9f503e5899842dd1603559c0443926a393e814b7259aeb427\", \"Created\": \"2022-05-13T09:00:28.314887816Z\", \"Path\": \"/bin/sh\", \"Args\": [ \"-c\", \"while true;do echo lyj;sleep 1;done\" ], \"State\": { \"Status\": \"running\", \"Running\": true, \"Paused\": false, \"Restarting\": false, \"OOMKilled\": false, \"Dead\": false, \"Pid\": 67867, \"ExitCode\": 0, \"Error\": \"\", \"StartedAt\": \"2022-05-13T09:00:28.676332024Z\", \"FinishedAt\": \"0001-01-01T00:00:00Z\" }, \"Image\": \"sha256:5d0da3dc976460b72c77d94c8a1ad043720b0416bfc16c52c45d4847e53fadb6\", \"ResolvConfPath\": \"/var/lib/docker/containers/24ac83cd18b425e9f503e5899842dd1603559c0443926a393e814b7259aeb427/resolv.conf\", \"HostnamePath\": \"/var/lib/docker/containers/24ac83cd18b425e9f503e5899842dd1603559c0443926a393e814b7259aeb427/hostname\", \"HostsPath\": \"/var/lib/docker/containers/24ac83cd18b425e9f503e5899842dd1603559c0443926a393e814b7259aeb427/hosts\", \"LogPath\": \"/var/lib/docker/containers/24ac83cd18b425e9f503e5899842dd1603559c0443926a393e814b7259aeb427/24ac83cd18b425e9f503e5899842dd1603559c0443926a393e814b7259aeb427-json.log\", \"Name\": \"/elastic_gagarin\", \"RestartCount\": 0, \"Driver\": \"overlay2\", \"Platform\": \"linux\", \"MountLabel\": \"\", \"ProcessLabel\": \"\", \"AppArmorProfile\": \"\", \"ExecIDs\": null, \"HostConfig\": { \"Binds\": null, \"ContainerIDFile\": \"\", \"LogConfig\": { \"Type\": \"json-file\", \"Config\": {} }, \"NetworkMode\": \"default\", \"PortBindings\": {}, \"RestartPolicy\": { \"Name\": \"no\", \"MaximumRetryCount\": 0 }, \"AutoRemove\": false, \"VolumeDriver\": \"\", \"VolumesFrom\": null, \"CapAdd\": null, \"CapDrop\": null, \"CgroupnsMode\": \"host\", \"Dns\": [], \"DnsOptions\": [], \"DnsSearch\": [], \"ExtraHosts\": null, \"GroupAdd\": null, \"IpcMode\": \"private\", \"Cgroup\": \"\", \"Links\": null, \"OomScoreAdj\": 0, \"PidMode\": \"\", \"Privileged\": false, \"PublishAllPorts\": false, \"ReadonlyRootfs\": false, \"SecurityOpt\": null, \"UTSMode\": \"\", \"UsernsMode\": \"\", \"ShmSize\": 67108864, \"Runtime\": \"runc\", \"ConsoleSize\": [ 0, 0 ], \"Isolation\": \"\", \"CpuShares\": 0, \"Memory\": 0, \"NanoCpus\": 0, \"CgroupParent\": \"\", \"BlkioWeight\": 0, \"BlkioWeightDevice\": [], \"BlkioDeviceReadBps\": null, \"BlkioDeviceWriteBps\": null, \"BlkioDeviceReadIOps\": null, \"BlkioDeviceWriteIOps\": null, \"CpuPeriod\": 0, \"CpuQuota\": 0, \"CpuRealtimePeriod\": 0, \"CpuRealtimeRuntime\": 0, \"CpusetCpus\": \"\", \"CpusetMems\": \"\", \"Devices\": [], \"DeviceCgroupRules\": null, \"DeviceRequests\": null, \"KernelMemory\": 0, \"KernelMemoryTCP\": 0, \"MemoryReservation\": 0, \"MemorySwap\": 0, \"MemorySwappiness\": null, \"OomKillDisable\": false, \"PidsLimit\": null, \"Ulimits\": null, \"CpuCount\": 0, \"CpuPercent\": 0, \"IOMaximumIOps\": 0, \"IOMaximumBandwidth\": 0, \"MaskedPaths\": [ \"/proc/asound\", \"/proc/acpi\", \"/proc/kcore\", \"/proc/keys\", \"/proc/latency_stats\", \"/proc/timer_list\", \"/proc/timer_stats\", \"/proc/sched_debug\", \"/proc/scsi\", \"/sys/firmware\" ], \"ReadonlyPaths\": [ \"/proc/bus\", \"/proc/fs\", \"/proc/irq\", \"/proc/sys\", \"/proc/sysrq-trigger\" ] }, \"GraphDriver\": { \"Data\": { \"LowerDir\": \"/var/lib/docker/overlay2/5c73a261c173cec8db9c2dd48143a5b963b2cce23dda4eb01262802efc898c54-init/diff:/var/lib/docker/overlay2/993f875b14fb02906ce0a4cc96d2fd0bd51ac4c3137d23be448fb77fefd26c14/diff\", \"MergedDir\": \"/var/lib/docker/overlay2/5c73a261c173cec8db9c2dd48143a5b963b2cce23dda4eb01262802efc898c54/merged\", \"UpperDir\": \"/var/lib/docker/overlay2/5c73a261c173cec8db9c2dd48143a5b963b2cce23dda4eb01262802efc898c54/diff\", \"WorkDir\": \"/var/lib/docker/overlay2/5c73a261c173cec8db9c2dd48143a5b963b2cce23dda4eb01262802efc898c54/work\" }, \"Name\": \"overlay2\" }, \"Mounts\": [], \"Config\": { \"Hostname\": \"24ac83cd18b4\", \"Domainname\": \"\", \"User\": \"\", \"AttachStdin\": false, \"AttachStdout\": false, \"AttachStderr\": false, \"Tty\": false, \"OpenStdin\": false, \"StdinOnce\": false, \"Env\": [ \"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\" ], \"Cmd\": [ \"/bin/sh\", \"-c\", \"while true;do echo lyj;sleep 1;done\" ], \"Image\": \"centos\", \"Volumes\": null, \"WorkingDir\": \"\", \"Entrypoint\": null, \"OnBuild\": null, \"Labels\": { \"org.label-schema.build-date\": \"20210915\", \"org.label-schema.license\": \"GPLv2\", \"org.label-schema.name\": \"CentOS Base Image\", \"org.label-schema.schema-version\": \"1.0\", \"org.label-schema.vendor\": \"CentOS\" } }, \"NetworkSettings\": { \"Bridge\": \"\", \"SandboxID\": \"c3c2cb8267717831d8702df2cc45333b92f175b66461de902323aa9d61e94252\", \"HairpinMode\": false, \"LinkLocalIPv6Address\": \"\", \"LinkLocalIPv6PrefixLen\": 0, \"Ports\": {}, \"SandboxKey\": \"/var/run/docker/netns/c3c2cb826771\", \"SecondaryIPAddresses\": null, \"SecondaryIPv6Addresses\": null, \"EndpointID\": \"f73444ad58e812ca8039b7ccd3c683dbaa63873183a14c1a2d395136f6414d5b\", \"Gateway\": \"172.17.0.1\", \"GlobalIPv6Address\": \"\", \"GlobalIPv6PrefixLen\": 0, \"IPAddress\": \"172.17.0.2\", \"IPPrefixLen\": 16, \"IPv6Gateway\": \"\", \"MacAddress\": \"02:42:ac:11:00:02\", \"Networks\": { \"bridge\": { \"IPAMConfig\": null, \"Links\": null, \"Aliases\": null, \"NetworkID\": \"b3b838684f4e337f0a1e6fb386dd7b7a6860ba5e5b34bf1b2d32fd1833a058b5\", \"EndpointID\": \"f73444ad58e812ca8039b7ccd3c683dbaa63873183a14c1a2d395136f6414d5b\", \"Gateway\": \"172.17.0.1\", \"IPAddress\": \"172.17.0.2\", \"IPPrefixLen\": 16, \"IPv6Gateway\": \"\", \"GlobalIPv6Address\": \"\", \"GlobalIPv6PrefixLen\": 0, \"MacAddress\": \"02:42:ac:11:00:02\", \"DriverOpts\": null } } } } ] 进入当前正在运行的容器 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 #我们通常容器都是使用后台方式运行的，需要进入容器，修改一些配置 #命令 docker exec -it 容器id bashShell #测试 [root@localhost lyj]# docker exec -it 24ac83cd18b4 /bin/bash [root@24ac83cd18b4 /]# ls bin etc lib lost+found mnt proc run srv tmp var dev home lib64 media opt root sbin sys usr [root@24ac83cd18b4 /]# ps -ef UID PID PPID C STIME TTY TIME CMD root 1 0 0 09:00 ? 00:00:06 /bin/sh -c while true;do echo lyj;sleep 1;done root 9470 0 0 11:39 pts/0 00:00:00 /bin/bash root 9501 1 0 11:39 ? 00:00:00 /usr/bin/coreutils --coreutils-prog-shebang=sleep /usr/binroot 9502 9470 0 11:39 pts/0 00:00:00 ps -ef #方式二 docker attach 容器id #测试 [root@localhost lyj]# docker attach 24ac83cd18b4 #正在执行当前的代码 #docker exec 进入容器后开启一个新的终端，可以在里面操作（常用） #docker attach 进入容器正在执行的终端，不会启动新的进程 从容器内拷贝文件到主机上 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 docker cp 容器id:容器内路径 目的的主机路径 #测试 [root@localhost home]# docker attach e1c59c6358fd [root@e1c59c6358fd /]# cd /home [root@e1c59c6358fd home]# ls [root@e1c59c6358fd home]# touch test.java [root@e1c59c6358fd home]# ls test.java [root@e1c59c6358fd home]# exit exit [root@localhost home]# docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES [root@localhost home]# docker ps -a CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES e1c59c6358fd centos \"/bin/bash\" 2 minutes ago Exited (0) 8 seconds ago romantic_aryabhata [root@localhost home]# docker cp e1c59c6358fd:/home/test.java /home [root@localhost home]# ls lyj lyj.java test.java docker练习 Docker 安装nginx\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 # 1.搜索镜像 search # 在docker hub上搜索nginx # 2.下载镜像 pull [root@localhost lyj]# docker pull nginx Using default tag: latest latest: Pulling from library/nginx a2abf6c4d29d: Pull complete a9edb18cadd1: Pull complete 589b7251471a: Pull complete 186b1aaa4aa6: Pull complete b4df32aa5a72: Pull complete a0bcbecc962e: Pull complete Digest: sha256:0d17b565c37bcbd895e9d92315a05c1c3c9a29f762b011a10c54a66cd53c9b31 Status: Downloaded newer image for nginx:latest docker.io/library/nginx:latest [root@localhost lyj]# docker images REPOSITORY TAG IMAGE ID CREATED SIZE nginx latest 605c77e624dd 4 months ago 141MB centos latest 5d0da3dc9764 8 months ago 231MB # -d 后台运行 # --name 给容器命令 # -p 宿主机端口，容器内部端口 [root@localhost lyj]# docker run -d --name nginx01 -p 3344:80 nginx 65c821bada5be37eddada13eb537c095857535a5393d9d45dc8505798c80f259 # 进入容器 [root@localhost lyj]# docker exec -it nginx01 /bin/bash root@65c821bada5b:/# whereis nginx nginx: /usr/sbin/nginx /usr/lib/nginx /etc/nginx /usr/share/nginx root@65c821bada5b:/# ls bin dev docker-entrypoint.sh home lib64 mnt proc run srv tmp var boot docker-entrypoint.d etc lib media opt root sbin sys usr root@65c821bada5b:/# cd /ect/nginx bash: cd: /ect/nginx: No such file or directory root@65c821bada5b:/# cd /etc/nginx root@65c821bada5b:/etc/nginx# ls conf.d fastcgi_params mime.types modules nginx.conf scgi_params uwsgi_params Docker布局tomcat\n1 2 3 4 5 6 7 8 9 10 11 12 13 # 官方的使用 docker run -it --rm tomcat:9.0 #用来测试，用完即删 # 我们之前的启动都是后台，停止容器之后，容器还是可以查到 # 下载在启动 docker pull tomcat:9.0 # 启动运行 docker run -d -p 3355:8080 --name tomcat01 tomcat # 测试访问没有问题 # 进入容器 [root@localhost lyj]# docker exec -it tomcat01 /bin/bash # 发现问题：1.Linux命令太少了。 2.没有webapps. 阿里云镜像的原因，默认是最小的镜像，所以不必要的都剔除了 # 保证最小可运行镜像 Docker 部署es+kibana\n1 2 3 4 5 6 7 8 9 10 # es 暴露的端口很多！ # es 十分耗内存 # es 的数据一般需要放置到安全目录 # --net somenetwork ？ 网络设置 docker run -d --name elasticsearch --net somenetwork -p 9200:9200 -p 9300:9300 -e \"discovery.type=single-node\" elasticsearch:tag # 启动了 linux就卡住了 docker stats 查看cpu的状态 # es 是十分耗内存的 # 查看 docker stats 1 # 关闭es,修改配置文件 可视化 portainer(先用这个) 1 2 docker run -d -p 8088:9000 \\ --restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=true portainer/portainer Rancher(CI/CD再用) 什么portainer? Docker图形化界面管理工具！提供一个后台面板供我们操作！\n测试：访问外网\nDocker镜像原理 镜像是什么 镜像是一种轻量级、可执行的独立软件包，用来打包软件运行环境和基于运行环境开发的软件，它包含了运行某个软件所需的所有的内容，包括代码、运行时、库、环境变量和配置文件。\n如何得到镜像 从远程仓库下载 朋友拷贝给你 自己制作一个镜像DockerFile Docker 镜像加载原理 UnionFS（联合文件系统）\n**UnionFS（联合文件系统）：**UnionFS文件系统（UnionFS）是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改，作为一次提交一层层的叠加，同时可以将不同的目录挂载到同一个虚拟文件系统下（unite several directories into a single virtual file system）。Union文件系统所是Docker镜像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像。\n**特性：**一次同时加载多个文件系统，但才外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录\nDocker镜像加载原理\ndocker的镜像实际上由一层一层的文件系统组成，这个层级的文件系统UnionFS。\nbootfs(boot file system)主要包含bootloader和kernel，bootloader主要是引导加载kernel，linux刚启动后会加载bootfs文件系统，在docker镜像的最底层是bootfs。这一层与我们典型的linux/unix系统是一样的，包括boot加载器和内核。当boot加载完成之后整个内核就都在内存中了，此时内存的使用权已由bootfs转交给内核，此时系统也会卸载bootfs。\nrootfs（root file system）,在bootfs智商，包含的就是典型的linux系统中的/dev，/proc，/bin，/etc等标准目录和文件。rootfs就是各种不同的操作系统发行版本，比如ubuntu，centos等等\n平时我们安装虚拟机的CentOs都是好几个g，为什么docker这里才几百兆\n对于一个精简的os，rootfs可以很小，只需要包含最基本的命令，工具和程序库就可以了，因为底层直接用Host的kernel，自己只需要提供rootfs就可以了。由此可见对于不同的linux发行版，bootfs基本是一致的，rootfs会有差别，因此不同的发行版本可用公用bootfs。\n分层理解 分层的镜像\n为什么Docker镜像要采用这种分层的结构？\n1 2 3 4 5 6 7 8 9 10 11 12 [root@localhost lyj]# docker pull redis Using default tag: latest latest: Pulling from library/redis a2abf6c4d29d: Already exists c7a4e4382001: Pull complete 4044b9ba67c9: Pull complete c8388a79482f: Pull complete 413c8bb60be2: Pull complete 1abfd3011519: Pull complete Digest: sha256:db485f2e245b5b3329fdc7eff4eb00f913e09d8feb9ca720788059fdc2ed8339 Status: Downloaded newer image for redis:latest docker.io/library/redis:latest 最大的好处，莫过于资源共享了！比如有多个镜像都从相同的Base镜像构建而来，那么宿主机只需要在磁盘上保留一份base镜像，同时内存中也只需要加载一份base镜像，这样就可以为所有的容器服务了，而且镜像的每一层都可以被共享。\n查看镜像分层可以通过docker image inspect命令！\n1 [root@localhost lyj]# docker image inspect redis:latest commit镜像 1 2 3 docker commit 提交内容成为一个新的副本 # 命令和git类似 docker commit -m=\"提交的描述信息\" -a=\"作者\" 容器id 目标镜像名：[TAG] 实践\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # 启动一个默认的tomcat # 发现默认的tomcat是没有webapps应用的，原因在于官方的镜像webapps下的文件 # 将文件复制到webapps下 p -r webapps.dist/* webapps # 将修改过的容器通过commit操作提交为一个镜像，以后就可以使用修改过的镜像 [root@localhost lyj]# docker commit -a=\"lyj\" -m=\"add webapps app content\" 79602de12c77 tomcat02:1.0 sha256:60a918d863158b5ceb76c17bac25c9e974b2e0f6e107255c6538b100e80549c7 [root@localhost lyj]# docker images REPOSITORY TAG IMAGE ID CREATED SIZE tomcat02 1.0 60a918d86315 3 seconds ago 684MB nginx latest 605c77e624dd 4 months ago 141MB tomcat 9.0 b8e65a4d736d 4 months ago 680MB tomcat latest fb5657adc892 4 months ago 680MB redis latest 7614ae9453d1 4 months ago 113MB centos latest 5d0da3dc9764 8 months ago 231MB portainer/portainer latest 580c0e4e98b0 14 months ago 79.1MB elasticsearch 7.6.2 f29a1ee41030 2 years ago 791MB 容器数据卷 什么是容器数据卷 **docker的理念：**将应用和环境打包成一个镜像\n容器之间由一个数据共享的技术，Docker容器中产生的数据，可以同步到本地\n卷技术：将容器目录挂载到linux上面\n使用数据卷 直接使用命令挂载\n1 2 3 4 docker run -it -v 主机目录：容器目录 [root@localhost home]# docker run -it -v /home/test:/home centos /bin/bash #查看是否挂载成功 docker inspect 5ccb1ac870bf 实践：安装Mysql\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 # 下载镜像 [root@localhost /]# docker pull mysql:5.7 5.7: Pulling from library/mysql # 运行容器，挂载数据 # 安装启动mysql需要设置密码 # 官方： docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag # 启动成功 # -v 数据卷挂载 # -d 后台启动 # -p 端口映射 # -e 环境配置 # --name 容器名字 docker run -d -p 3310:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7 # 启动成功之后，连接docker的mysql # 通过navicat连接数据库 # 创建一个数据库，测试文件是否挂载成功 [root@localhost data]# ls auto.cnf client-cert.pem ibdata1 ibtmp1 private_key.pem server-key.pem ca-key.pem client-key.pem ib_logfile0 mysql public_key.pem sys ca.pem ib_buffer_pool ib_logfile1 performance_schema server-cert.pem test # 容器删除之后，挂载的数据卷依旧没有丢失文件 具名和匿名挂载 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # 匿名挂载 -v 容器内路径 -P 随机端口 docker run -d -P --name nginx01 -v /etc/nginx nginx [root@localhost /]# docker volume ls DRIVER VOLUME NAME local d13150 # 剧名挂载 [root@localhost /]# docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx nginx e35b3cf78a4964b5bcc6836c43c5e60665316c310e04580ee2ab42dde5473eb7 [root@localhost /]# docker volume ls DRIVER VOLUME NAME local d131501ea9c086991b05e9e59fa9902d265b46a339c15202c59bc9c023f4ab2f local juming-nginx 1 2 3 4 5 6 7 8 9 10 11 12 13 # 查看具名挂载的位置 [root@localhost /]# docker volume inspect juming-nginx [ { \"CreatedAt\": \"2022-05-14T15:49:21+08:00\", \"Driver\": \"local\", \"Labels\": null, \"Mountpoint\": \"/var/lib/docker/volumes/juming-nginx/_data\", \"Name\": \"juming-nginx\", \"Options\": null, \"Scope\": \"local\" } ] 所有docker容器内的卷，没有指定目录都是在/var/lib/docker/volumes/xxx/_data\n通过具名挂载可以方便的找到卷，大多数使用的都是具名挂载\n1 2 3 4 # 如何确定是具名挂载合适匿名挂载，还是指定路径挂载 -v 容器内路径 #匿名挂载 -v 卷名：容器内路径 #具名挂载 -v /宿主机路径：容器内路径 #指定路径挂载 拓展：\n1 2 3 4 5 6 7 # 通过 -v 容器内路径 ro rw 改变读写权限 # ro readonly 只读 # rw readwrite 可读可写 docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx:ro nginx docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx:rw nginx #ro 说明这个路径只能通过宿主机来操作，容器内部无法操作 初识DockerFile DockerFile就是用来构建docker镜像的构建文件！\n通过脚本生成镜像，镜像是一层一层的，脚本是一个个命令，每一个命令就是一层\n1 2 3 4 5 6 7 8 # 创建一个dockerfile文件，名字可以随便 # 文件中的内容 指令(大写) 参数 FORM centos VOLUME [\"volume01\",\"volume02\"] CMD echo \"----end----\" CMD /bin/bash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 [root@localhost docker-test-volume]# docker build -f /home/docker-test-volume/dockerfile1 -t lyj/centos:1.0 . Sending build context to Docker daemon 2.048kB Step 1/4 : FROM centos ---\u003e 5d0da3dc9764 Step 2/4 : VOLUME [\"volume01\",\"volume02\"] ---\u003e Running in adf475a0af98 Removing intermediate container adf475a0af98 ---\u003e 4dd2b9a5d3cc Step 3/4 : CMD echo \"----end----\" ---\u003e Running in 3f617792852a Removing intermediate container 3f617792852a ---\u003e 6b2f0b022f0d Step 4/4 : CMD /bin/bash ---\u003e Running in 216f3f309b22 Removing intermediate container 216f3f309b22 ---\u003e ac1b086b26d7 Successfully built ac1b086b26d7 Successfully tagged lyj/centos:1.0 启动自己的容器\n1 docker run -it ac1b086b26d7 /bin/bash 自己容器挂载的路径\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 \"Mounts\": [ { \"Type\": \"volume\", \"Name\": \"c9e87917b6ac7b8b8e659dc3aa18454c67480f8b18328873c8eb4005126cc260\", \"Source\": \"/var/lib/docker/volumes/c9e87917b6ac7b8b8e659dc3aa18454c67480f8b18328873c8eb4005126cc260/_data\", \"Destination\": \"volume01\", \"Driver\": \"local\", \"Mode\": \"\", \"RW\": true, \"Propagation\": \"\" }, { \"Type\": \"volume\", \"Name\": \"6716d8d8d2108ef678bd3d68632ec45a1f8b1086a3e9cab08965c0b73edde3f4\", \"Source\": \"/var/lib/docker/volumes/6716d8d8d2108ef678bd3d68632ec45a1f8b1086a3e9cab08965c0b73edde3f4/_data\", \"Destination\": \"volume02\", \"Driver\": \"local\", \"Mode\": \"\", \"RW\": true, \"Propagation\": \"\" } ], 数据卷容器 多个容器同步数据\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 # 启动三个镜像，通过我们自己写的镜像去启动 [root@localhost lyj]# docker run -it --name docker01 lyj/centos:1.0 [root@af22ef053837 /]# ls bin etc lib lost+found mnt proc run srv tmp var volume02 dev home lib64 media opt root sbin sys usr volume01 [root@af22ef053837 /]# ls -l total 0 lrwxrwxrwx. 1 root root 7 Nov 3 2020 bin -\u003e usr/bin drwxr-xr-x. 5 root root 360 May 17 02:18 dev drwxr-xr-x. 1 root root 66 May 17 02:18 etc drwxr-xr-x. 2 root root 6 Nov 3 2020 home lrwxrwxrwx. 1 root root 7 Nov 3 2020 lib -\u003e usr/lib lrwxrwxrwx. 1 root root 9 Nov 3 2020 lib64 -\u003e usr/lib64 drwx------. 2 root root 6 Sep 15 2021 lost+found drwxr-xr-x. 2 root root 6 Nov 3 2020 media drwxr-xr-x. 2 root root 6 Nov 3 2020 mnt drwxr-xr-x. 2 root root 6 Nov 3 2020 opt dr-xr-xr-x. 186 root root 0 May 17 02:18 proc dr-xr-x---. 2 root root 162 Sep 15 2021 root drwxr-xr-x. 11 root root 163 Sep 15 2021 run lrwxrwxrwx. 1 root root 8 Nov 3 2020 sbin -\u003e usr/sbin drwxr-xr-x. 2 root root 6 Nov 3 2020 srv dr-xr-xr-x. 13 root root 0 May 17 02:13 sys drwxrwxrwt. 7 root root 171 Sep 15 2021 tmp drwxr-xr-x. 12 root root 144 Sep 15 2021 usr drwxr-xr-x. 20 root root 262 Sep 15 2021 var drwxr-xr-x. 2 root root 6 May 17 02:18 volume01 drwxr-xr-x. 2 root root 6 May 17 02:18 volume02 删除docker01的容器之后数据依然存在\n容器之间买配置信息的传递，数据卷容器的生命周期一致持续到没有容器使用为止\nDockerFile DokerFile介绍 dockerFile是用来构建docker镜像的文件！命令参数脚本！\n构建步骤：\n编写一个dockerfile文件 docker build 构建成为一个镜像 docker run 运行镜像 docker push 发布镜像(Docker Hub、阿里云镜像仓库) 很多官方镜像都是基础包，很多功能没有，我们通常会自己搭建镜像\nDockerFile构建过程 基础知识：\n1、每个保留关键字(指令)都是必须大写字母\n2、执行顺序是从上到下的\n3、# 表示注释\n4、每一个指令都会创建提交一个新的镜像层，并提交！\ndockerFile是面向开发的，以后发布项目，做镜像，就需要编写dockerfile文件，这个文件很简单，dockerfil逐渐成为企业交付的标准，必须要掌握！\n步骤：开发、部署、运维缺一不可\nDockerFile：构建文件，定义了一切的步骤，源代码\nDockerImages：通过dockerfile构建生成的镜像，最终发布和运行的产品\nDocker容器：容器就是镜像运行起来提供服务器\n指令： 1 2 3 4 5 6 7 8 9 10 11 12 FROM\t# 基础镜像，一切从这里开始构建 MAINTAINER\t# 镜像是谁写的，姓名+邮箱 RUN\t# 镜像构建的时候需要运行的命令 ADD # 步骤，tomcat镜像，这个tomcat压缩包！添加内容 WORKDIR # 镜像的工作目录 VOLUEM # 挂载的目录 EXPOSE # 保留端口配置 CMD\t# 指定这个容器启动的时候要运行的命令，只有最后一个会生效，可被替代 ENTRYPOINT # 指定这个容器启动的时候要运行的命令，可以追加命令 ONBUILD # 当构建一个被继承DockerFile这个时候就会运行ONBUILD的指令 COPY # 类似ADD,将我们的文件拷贝到镜像中 ENV # 构建的时候设置环境变量！ 创建一个属于自己的centos\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 # 编写dockerfile的文件 [root@localhost dockerfile]# vim mydockerfile-centos [root@localhost dockerfile]# cat mydockerfile-centos FROM centos MAINTANER lyj-2063074967@qq.com ENV MYPATH /usr/local WORKDIR $MYPATH RUN yum -y install vim RUN yum -y install net-tools EXPOSE 80 CMD echo $MYPATH CMD echo \"---end---\" CMD /bin/bash # 构建镜像 [root@localhost dockerfile]# docker build -f mydockerfile-centos -t mycentos:0.1 . # 测试运行 docker run -it mycentos:0.1 # 查看历史变更 ot@localhost dockerfile]# docker history 5d0da3dc9764 IMAGE CREATED CREATED BY SIZE COMMENT 5d0da3dc9764 8 months ago /bin/sh -c #(nop) CMD [\"/bin/bash\"] 0B 8 months ago /bin/sh -c #(nop) LABEL org.label-schema.sc… 0B 8 months ago /bin/sh -c #(nop) ADD file:805cb5e15fb6e0bb0… 231MB CMD 和 ENTRYPOINT 区别\n测试cmd\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 [root@localhost dockerfile]# vim dockerfile-cmd-test # 脚本 FROM centos:7 CMD [\"ls\",\"-a\"] # 构建 [root@localhost dockerfile]# docker build -f dockerfile-cmd-test -t cmdtest . # 命令生效 [root@localhost dockerfile]# docker run 744c3d93e4a3 . .. .dockerenv anaconda-post.log bin dev etc home lib lib64 media mnt opt proc root run sbin srv sys tmp usr var # 想追加命令 il, ls -al [root@localhost dockerfile]# docker run 744c3d93e4a3 -l docker: Error response from daemon: failed to create shim task: OCI runtime create failed: runc create failed: unable to start container process: exec: \"-l\": executable file not found in $PATH: unknown. # cmd情况下-l 替代了ls -a 测试ENTRYPOINT\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 [root@localhost dockerfile]# vim dockerfile-cmd-entryponit # 脚本 FROM centos:7 ENTRYPOINT [\"ls\",\"-a\"] [root@localhost dockerfile]# docker build -f dockerfile-cmd-entryponit -t entrypoint-test . Sending build context to Docker daemon 4.096kB Step 1/2 : FROM centos:7 ---\u003e eeb6ee3f44bd Step 2/2 : ENTRYPOINT [\"ls\",\"-a\"] ---\u003e Running in 84619c168165 Removing intermediate container 84619c168165 ---\u003e a0a8da7d7890 Successfully built a0a8da7d7890 Successfully tagged entrypoint-test:latest [root@localhost dockerfile]# docker run a0a8da7d7890 . .. .dockerenv anaconda-post.log bin dev etc home lib lib64 media mnt opt proc root run sbin srv sys tmp usr var [root@localhost dockerfile]# docker run a0a8da7d7890 -l total 12 drwxr-xr-x. 1 root root 6 May 17 03:33 . drwxr-xr-x. 1 root root 6 May 17 03:33 .. -rwxr-xr-x. 1 root root 0 May 17 03:33 .dockerenv -rw-r--r--. 1 root root 12114 Nov 13 2020 anaconda-post.log lrwxrwxrwx. 1 root root 7 Nov 13 2020 bin -\u003e usr/bin drwxr-xr-x. 5 root root 340 May 17 03:33 dev drwxr-xr-x. 1 root root 66 May 17 03:33 etc drwxr-xr-x. 2 root root 6 Apr 11 2018 home lrwxrwxrwx. 1 root root 7 Nov 13 2020 lib -\u003e usr/lib lrwxrwxrwx. 1 root root 9 Nov 13 2020 lib64 -\u003e usr/lib64 drwxr-xr-x. 2 root root 6 Apr 11 2018 media drwxr-xr-x. 2 root root 6 Apr 11 2018 mnt drwxr-xr-x. 2 root root 6 Apr 11 2018 opt dr-xr-xr-x. 187 root root 0 May 17 03:33 proc dr-xr-x---. 2 root root 114 Nov 13 2020 root drwxr-xr-x. 11 root root 148 Nov 13 2020 run lrwxrwxrwx. 1 root root 8 Nov 13 2020 sbin -\u003e usr/sbin drwxr-xr-x. 2 root root 6 Apr 11 2018 srv dr-xr-xr-x. 13 root root 0 May 17 02:13 sys drwxrwxrwt. 7 root root 132 Nov 13 2020 tmp drwxr-xr-x. 13 root root 155 Nov 13 2020 usr drwxr-xr-x. 18 root root 238 Nov 13 2020 var Dockerfile中很多命令都十分相似，我们需要了解它们的区别，我的最好的学习就是对比测试\n实践：Tomcat镜像 1、准备镜像文件tomcat压缩包，jdk的压缩包\n2、准备dockerfile文件，官方命令Dockerfile,build时会自动寻找这个文件，就不需要-f指定了\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 FROM centos:7 MAINTAINET lyj-2063074967@qq.com COPY readme.txt /usr/local/readme.txt ADD jdk-8u181-linux-x64.tar.gz /usr/local/ ADD apache-tomcat-9.0.63.tar.gz /usr/lcoal/ RUN yum -y install vim ENV MYPATH /usr/local WORKDIR $MYPATH ENV JAVA_HOME /usr/local/jdk1.8.0_181 ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar ENV CATALINA_HOME /usr/local/apache-tomcat-9.0.63 ENV CATALINA_BASE /usr/local/apache-tomcat-9.0.63 ENV PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin EXPOSE 8080 CMD /usr/local/apache-tomcat-9.0.63/bin/startup.sh \u0026\u0026 tail -F /usr/local/apache-tomcat-9.0.63/bin/logs/catalina.out 3、构建镜像\n1 # docker build -t diytomcat . Docker网络 理解Docker0 清空所有环境（镜像和容器）\n1 2 3 4 5 6 # docker 如何处理容器网络访问 [root@localhost /]# docker run -d -P --name tomcat01 tomcat # 查看容器的内部网络地址 ip addr # linux可以Ping 容器内部 原理\n1、每启动一个docker容器，docker就会给docker容器分配一个ip,只要安装了docker，就会有一个网卡docker0桥接模式，使用的技术是evth-pair技术\n2、在启动一个容器又多了一个网卡\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 [root@localhost /]# ip addr 1: lo: mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 2: ens33: mtu 1500 qdisc pfifo_fast state UP group default qlen 1000 link/ether 00:0c:29:32:a0:bc brd ff:ff:ff:ff:ff:ff inet 192.168.108.110/24 brd 192.168.108.255 scope global noprefixroute ens33 valid_lft forever preferred_lft forever inet6 fe80::32c9:7680:6e1:ea04/64 scope link noprefixroute valid_lft forever preferred_lft forever 3: virbr0: mtu 1500 qdisc noqueue state DOWN group default qlen 1000 link/ether 52:54:00:c7:4f:55 brd ff:ff:ff:ff:ff:ff inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0 valid_lft forever preferred_lft forever 4: virbr0-nic: mtu 1500 qdisc pfifo_fast master virbr0 state DOWN group default qlen 1000 link/ether 52:54:00:c7:4f:55 brd ff:ff:ff:ff:ff:ff 5: br-11e4c4d39e6c: mtu 1500 qdisc noqueue state DOWN group default link/ether 02:42:20:e8:3d:98 brd ff:ff:ff:ff:ff:ff inet 172.18.0.1/16 brd 172.18.255.255 scope global br-11e4c4d39e6c valid_lft forever preferred_lft forever 6: docker0: mtu 1500 qdisc noqueue state UP group default link/ether 02:42:cc:cd:5d:3d brd ff:ff:ff:ff:ff:ff inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0 valid_lft forever preferred_lft forever inet6 fe80::42:ccff:fecd:5d3d/64 scope link valid_lft forever preferred_lft forever 8: vethbd6aa9d@if7: mtu 1500 qdisc noqueue master docker0 state UP group default link/ether ba:cc:e4:b3:69:1e brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet6 fe80::b8cc:e4ff:feb3:691e/64 scope link valid_lft forever preferred_lft forever 10: veth9702194@if9: mtu 1500 qdisc noqueue master docker0 state UP group default link/ether 96:99:e6:6c:aa:b6 brd ff:ff:ff:ff:ff:ff link-netnsid 1 inet6 fe80::9499:e6ff:fe6c:aab6/64 scope link valid_lft forever preferred_lft forever 容器带来的网卡，都是一对的，evth-pair就是一对虚拟设备接口，他们都是成对出现的，一段连着协议，一段彼此相连，正因为这个特性，evth-pari充当一个桥接，连接各种虚拟网络设备的，Docker容器之间的连接，都是使用evth-paur技术\nlink 1 docker run -P --name tomcat03 --link tomcat02 tomcat 1 2 3 4 5 6 7 8 [root@localhost /]# docker exec -it tomcat02 cat /etc/hosts 127.0.0.1 localhost ::1 localhost ip6-localhost ip6-loopback fe00::0 ip6-localnet ff00::0 ip6-mcastprefix ff02::1 ip6-allnodes ff02::2 ip6-allrouters 172.17.0.3 555cc43e71d6 link的本质：就是在hosts配置增加了171.17.0.3 容器id\n自定义网络 查看所有docker 网络\n1 2 3 4 5 6 [root@localhost /]# docker network ls NETWORK ID NAME DRIVER SCOPE 835678176bfb bridge bridge local 33bd4092d423 host host local c67b96605b65 none null local 11e4c4d39e6c somenetwork bridge local 网络模式 bridge：桥接docker（默认）自己创建网络也是用bridge模式\nnone：不配置网络\nhost：和宿主机共享网络\ncontainer：容器网络联通（用的少，局限很大）\n测试\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # 直接启动的命令， --net bridge,而这个就docker0 docker run -d -P --name tomcat01 docker run -d -P --name tomcat01 --net bridge tomcat # docker0特点，默认，域名不用访问，--link可以打通连接 # 自定义一个网络 # --diver 桥接模式 # --subnet 子网 # --gateway 网关 [root@localhost /]# docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet dc5bf1caafaa16013e9f9f0654982ed97cd589713f5925ddbd2908c0ccb1351b [root@localhost /]# docker network ls NETWORK ID NAME DRIVER SCOPE 835678176bfb bridge bridge local 33bd4092d423 host host local dc5bf1caafaa mynet bridge local c67b96605b65 none null local # 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 [root@localhost /]# docker run -d -P --name tomcat-net-01 --net mynet \"docker run\" requires at least 1 argument. See 'docker run --help'. Usage: docker run [OPTIONS] IMAGE [COMMAND] [ARG...] Run a command in a new container [root@localhost /]# docker run -d -P --name tomcat-net-01 --net mynet tomcat a07c51438812bcfc529fd503c929866a6f77d30a7e8716c72f9548ffc5025877 [root@localhost /]# docker run -d -P --name tomcat-net-02 --net mynet tomcat ecdda4c64e007c8c7ef24de2dd581cbe967593c2fc730805f769c68930b82f6a [root@localhost /]# docker network inspect mynet [ { \"Name\": \"mynet\", \"Id\": \"dc5bf1caafaa16013e9f9f0654982ed97cd589713f5925ddbd2908c0ccb1351b\", \"Created\": \"2022-05-18T11:06:01.965660686+08:00\", \"Scope\": \"local\", \"Driver\": \"bridge\", \"EnableIPv6\": false, \"IPAM\": { \"Driver\": \"default\", \"Options\": {}, \"Config\": [ { \"Subnet\": \"192.168.0.0/16\", \"Gateway\": \"192.168.0.1\" } ] }, \"Internal\": false, \"Attachable\": false, \"Ingress\": false, \"ConfigFrom\": { \"Network\": \"\" }, \"ConfigOnly\": false, \"Containers\": { \"a07c51438812bcfc529fd503c929866a6f77d30a7e8716c72f9548ffc5025877\": { \"Name\": \"tomcat-net-01\", \"EndpointID\": \"de83ba706e481876e2973336408e5c071da47133ce309c7801bf8935bb391618\", \"MacAddress\": \"02:42:c0:a8:00:02\", \"IPv4Address\": \"192.168.0.2/16\", \"IPv6Address\": \"\" }, \"ecdda4c64e007c8c7ef24de2dd581cbe967593c2fc730805f769c68930b82f6a\": { \"Name\": \"tomcat-net-02\", \"EndpointID\": \"066c8632e98ebfb0d8cd3ebc3da9bc28df18749532ebd71fda9561e810e0a49b\", \"MacAddress\": \"02:42:c0:a8:00:03\", \"IPv4Address\": \"192.168.0.3/16\", \"IPv6Address\": \"\" } }, \"Options\": {}, \"Labels\": {} } ] 自定义的网络docker已经帮我们维护好了对应的关系\n好处：\nredis-不同的集群使用不同的网络，保证了集群是安全和健康的\nmysql-不同的集群使用不同的网络，保证了集群是安全和健康的\n网络连通 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 [root@localhost /]# docker network --help Usage: docker network COMMAND Manage networks Commands: connect Connect a container to a network create Create a network disconnect Disconnect a container from a network inspect Display detailed information on one or more networks ls List networks prune Remove all unused networks rm Remove one or more networks Run 'docker network COMMAND --help' for more information on a command. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 # 测试打通tomcat01到mynet [root@localhost /]# docker network connect mynet tomcat01 # 连通之后就是tomcat01放到了mynet网络下 [root@localhost /]# docker network inspect mynet [ { \"Name\": \"mynet\", \"Id\": \"dc5bf1caafaa16013e9f9f0654982ed97cd589713f5925ddbd2908c0ccb1351b\", \"Created\": \"2022-05-18T11:06:01.965660686+08:00\", \"Scope\": \"local\", \"Driver\": \"bridge\", \"EnableIPv6\": false, \"IPAM\": { \"Driver\": \"default\", \"Options\": {}, \"Config\": [ { \"Subnet\": \"192.168.0.0/16\", \"Gateway\": \"192.168.0.1\" } ] }, \"Internal\": false, \"Attachable\": false, \"Ingress\": false, \"ConfigFrom\": { \"Network\": \"\" }, \"ConfigOnly\": false, \"Containers\": { \"3e25bc8a0e7586f3105c12ca550d5a28b0407ba5aa9bd362c4993422eb1729dd\": { \"Name\": \"tomcat01\", \"EndpointID\": \"5e6c258c064273d14450c2acfb98a34455524b11af4980378b62de1ae2249271\", \"MacAddress\": \"02:42:c0:a8:00:04\", \"IPv4Address\": \"192.168.0.4/16\", \"IPv6Address\": \"\" }, \"a07c51438812bcfc529fd503c929866a6f77d30a7e8716c72f9548ffc5025877\": { \"Name\": \"tomcat-net-01\", \"EndpointID\": \"de83ba706e481876e2973336408e5c071da47133ce309c7801bf8935bb391618\", \"MacAddress\": \"02:42:c0:a8:00:02\", \"IPv4Address\": \"192.168.0.2/16\", \"IPv6Address\": \"\" }, \"ecdda4c64e007c8c7ef24de2dd581cbe967593c2fc730805f769c68930b82f6a\": { \"Name\": \"tomcat-net-02\", \"EndpointID\": \"066c8632e98ebfb0d8cd3ebc3da9bc28df18749532ebd71fda9561e810e0a49b\", \"MacAddress\": \"02:42:c0:a8:00:03\", \"IPv4Address\": \"192.168.0.3/16\", \"IPv6Address\": \"\" } }, \"Options\": {}, \"Labels\": {} } ] 1 2 # 移除网络 [root@localhost /]# docker network rm somenetwork 部署redis集群 创建redis网卡\n1 [root@localhost /]# docker network create redis --subnet 172.38.0.0/16 通过脚本创建六个reids配置\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 for port in $(seq 1 6); \\ do \\ mkdir -p /mydata/redis/node-${port}/conf touch /mydata/redis/node-${port}/conf/redis.conf cat \u003c\u003c EOF \u003e/mydata/redis/node-${port}/conf/redis.conf port 6379 bind 0.0.0.0 cluster-enabled yes cluster-config-file nodes.conf cluster-node-timeout 5000 cluster-announce-ip 172.38.0.1${port} cluster-announce-port 6379 cluster-announce-bus-port 16379 appendonly yes EOF done 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 # 启动容器 for port in $(seq 1 6); \\ do \\ docker run -p 637${port}:6379 -p 1637${port}:16379 --name redis-${port} \\ -v /mydata/redis/node-${port}/data:/data \\ -v /mydata/redis/node-${port}/conf/redis.conf:/etc/redis/redis.conf \\ -d --net redis --ip 172.38.0.1${port} redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf; \\ done #进入一个容器 docker exec -it redis-1 /bin/sh # 创建集群 redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379 172.38.0.13:6379 172.38.0.14:6379 172.38.0.15:6379 172.38.0.16:6379 --cluster-replicas 1 \u003e\u003e\u003e Performing hash slots allocation on 6 nodes... Master[0] -\u003e Slots 0 - 5460 Master[1] -\u003e Slots 5461 - 10922 Master[2] -\u003e Slots 10923 - 16383 Adding replica 172.38.0.15:6379 to 172.38.0.11:6379 Adding replica 172.38.0.16:6379 to 172.38.0.12:6379 Adding replica 172.38.0.14:6379 to 172.38.0.13:6379 M: 9d90cb6cfe72a617664d5cc5ed83f654c2e9865b 172.38.0.11:6379 slots:[0-5460] (5461 slots) master M: ff448dc8dea2517b2c77b2558e04cbeda7fab184 172.38.0.12:6379 slots:[5461-10922] (5462 slots) master M: fc808d7350a36679cdc645dbaa8ec18702ca9e99 172.38.0.13:6379 slots:[10923-16383] (5461 slots) master S: a595255f05ffe1317a217143bc87ec97cc287432 172.38.0.14:6379 replicates fc808d7350a36679cdc645dbaa8ec18702ca9e99 S: 88f5fca469eab471e64edebb7a75f4422c9ada08 172.38.0.15:6379 replicates 9d90cb6cfe72a617664d5cc5ed83f654c2e9865b S: 73f4b703c96d5c36e5480574bee473aef9914da8 172.38.0.16:6379 replicates ff448dc8dea2517b2c77b2558e04cbeda7fab184 Can I set the above configuration? (type 'yes' to accept): yes \u003e\u003e\u003e Nodes configuration updated \u003e\u003e\u003e Assign a different config epoch to each node \u003e\u003e\u003e Sending CLUSTER MEET messages to join the cluster Waiting for the cluster to join ... \u003e\u003e\u003e Performing Cluster Check (using node 172.38.0.11:6379) M: 9d90cb6cfe72a617664d5cc5ed83f654c2e9865b 172.38.0.11:6379 slots:[0-5460] (5461 slots) master 1 additional replica(s) M: ff448dc8dea2517b2c77b2558e04cbeda7fab184 172.38.0.12:6379 slots:[5461-10922] (5462 slots) master 1 additional replica(s) S: a595255f05ffe1317a217143bc87ec97cc287432 172.38.0.14:6379 slots: (0 slots) slave replicates fc808d7350a36679cdc645dbaa8ec18702ca9e99 S: 73f4b703c96d5c36e5480574bee473aef9914da8 172.38.0.16:6379 slots: (0 slots) slave replicates ff448dc8dea2517b2c77b2558e04cbeda7fab184 S: 88f5fca469eab471e64edebb7a75f4422c9ada08 172.38.0.15:6379 slots: (0 slots) slave replicates 9d90cb6cfe72a617664d5cc5ed83f654c2e9865b M: fc808d7350a36679cdc645dbaa8ec18702ca9e99 172.38.0.13:6379 slots:[10923-16383] (5461 slots) master 1 additional replica(s) [OK] All nodes agree about slots configuration. \u003e\u003e\u003e Check for open slots... \u003e\u003e\u003e Check slots coverage... SpringBoot项目打包Docker镜像 1、构建springboot项目\n2、打包应用\n3、编写Dockerfile\n4、构建镜像\n5、发布运行\nDocker Compose 简介： Docker\nDockerFile build run 手动操作，单个容器！\n微服务，100个微服务！依赖关系\nDocker Compose 来轻松高效的管理容器，定义运行多个容器。\nCompose是docker官方的开源项目，需要安装，\nDockerfile让程序可以在任何地方运行，web服务、redis、MySQL、nginx…多个容器\nCompose\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 version: \"3.9\" # optional since v1.27.0 services: web: build: . ports: - \"8000:5000\" volumes: - .:/code - logvolume01:/var/log links: - redis redis: image: redis volumes: logvolume01: {} docker-compose -up 100个服务\nCompose：重要的概念\n服务services，容器，应用。（web、redis、mysql） 项目project，一组关联的容器。博客，web,mysql Compose 安装 1 curl -L https://get.daocloud.io/docker/compose/releases/download/v2.5.0/docker-compose-`uname -s`-`uname -m` \u003e /usr/local/bin/docker-compose 授权\n1 2 3 4 chmod +x docker-compose [root@localhost bin]# docker-compose version Docker Compose version v2.5.0 体验 python应用，计数器，redis。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 mkdir composetest cd composetest vim app.py # 文件内容 import time import redis from flask import Flask app = Flask(__name__) cache = redis.Redis(host='redis', port=6379) def get_hit_count(): retries = 5 while True: try: return cache.incr('hits') except redis.exceptions.ConnectionError as exc: if retries == 0: raise exc retries -= 1 time.sleep(0.5) @app.route('/') def hello(): count = get_hit_count() return 'Hello World! I have been seen {} times.\\n'.format(count) vim requirements.txt # 文件内容 flask redis vim Dockerfile # 文件内容 # syntax=docker/dockerfile:1 FROM python:3.7-alpine RUN echo -e http://mirrors.ustc.edu.cn/alpine/v3.12/main/ \u003e /etc/apk/repositories WORKDIR /code ENV FLASK_APP=app.py ENV FLASK_RUN_HOST=0.0.0.0 RUN apk add --no-cache gcc musl-dev linux-headers COPY requirements.txt requirements.txt RUN pip install -i https://pypi.tuna.tsinghua.edu.cn/simple --no-cache-dir -r requirements.txt EXPOSE 5000 COPY . . CMD [\"flask\", \"run\"] vim docker-compose.yml # 文件内容 version: \"3.9\" services: web: build: . ports: - \"8000:5000\" redis: image: \"redis:alpine\" # 运行 docker-compose up yaml 规则 docker-compose.yaml核心\n1 2 3 4 5 6 7 8 9 10 11 12 # 3层 version: '' #版本 services: #服务 服务1： web # 服务配置 images build network 服务2： redis 服务3： redis # 其他配置 网络/卷、 全局规则 开源项目 下载程序，安装数据库、配置……\ncompose应用。=》一键启动\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 mkdir my_wordpress cd my_wordpress vim docker-compose.yml # 文件内容 version: \"3.9\" services: db: image: mysql:5.7 volumes: - db_data:/var/lib/mysql restart: always environment: MYSQL_ROOT_PASSWORD: somewordpress MYSQL_DATABASE: wordpress MYSQL_USER: wordpress MYSQL_PASSWORD: wordpress wordpress: depends_on: - db image: wordpress:latest volumes: - wordpress_data:/var/www/html ports: - \"8000:80\" restart: always environment: WORDPRESS_DB_HOST: db WORDPRESS_DB_USER: wordpress WORDPRESS_DB_PASSWORD: wordpress WORDPRESS_DB_NAME: wordpress volumes: db_data: {} wordpress_data: {} 前台启动\n1 2 3 4 5 docker -d docker-compose -d [+] Running 2/2 ⠿ Container my_wordpress-db-1 Started 0.5s ⠿ Container my_wordpress-wordpress-1 Started 1.2s 测试： 1 2 3 4 5 6 7 8 9 10 11 12 @RestController public class HelloController { @Autowired StringRedisTemplate redisTemplate; @GetMapping(\"/hello\") public String hello(){ Long views = redisTemplate.opsForValue().increment(\"views\"); return \"hello lyj views:\" + views; } } 1 2 3 # application.propertiees server.port=8080 spring.redis.host=redis 1 2 3 4 5 6 7 8 9 10 # Dockerfile FROM java:8 COPY *.jar /app.jar CMD [\"--server.port=8080\"] EXPOSE 8080 ENTRYPOINT [\"java\",\"-jar\",\"/app.jar\"] 1 2 3 4 5 6 7 8 9 10 11 12 # docker-compose.yml version: \"3.9\" services: lyjapp: build: . image: lyj depends_on: - redis ports: - \"8080:8080\" redis: image: \"library/redis:alpine\" 项目要重新打包\n1 docker-compose up --build ","wordCount":"5726","inLanguage":"zh-cn","image":"https://lyj.cloudns.ch/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2023-08-24T20:18:49Z","dateModified":"2023-08-24T20:18:49Z","author":{"@type":"Person","name":"LYJ"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://lyj.cloudns.ch/post/docker-description/"},"publisher":{"@type":"Organization","name":"LYJ's Blog","logo":{"@type":"ImageObject","url":"https://lyj.cloudns.ch/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://lyj.cloudns.ch/ accesskey=h title="Home (Alt + H)"><img src=https://lyj.cloudns.ch/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://lyj.cloudns.ch/ title="LYJ's Blog"><span>首页</span></a></li><li><a href=https://lyj.cloudns.ch/archives/ title=归档><span>归档</span></a></li><li><a href=https://lyj.cloudns.ch/categories/ title=Categories><span>分类</span></a></li><li><a href=https://lyj.cloudns.ch/tags/ title=Tags><span>标签</span></a></li><li><a href=https://lyj.cloudns.ch/search/ title=搜索><span>搜索</span></a></li><li><a href=https://lyj.cloudns.ch/about/ title=关于><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://lyj.cloudns.ch/>Home</a>&nbsp;»&nbsp;<a href=https://lyj.cloudns.ch/post/>Posts</a></div><h1 class="post-title entry-hint-parent">Docker</h1><div class=post-description>Docker是一个开源的容器引擎，是一种操作系统级别的虚拟化技术，Docker让开发者可以打包自己的应用以及依赖到一个可移植的容器当中，然后发布到任何的Linux机器上面。</div><div class=post-meta><span title='2023-08-24 20:18:49 +0000 UTC'>2023-08-24</span>&nbsp;·&nbsp;5726 字数&nbsp;·&nbsp;LYJ</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#docker概述>Docker概述</a><ul><li><a href=#docker为什么出现>Docker为什么出现？</a></li><li><a href=#docker能做什么>Docker能做什么：</a></li></ul></li><li><a href=#docker安装>Docker安装</a><ul><li><a href=#docker基本组成>Docker基本组成</a></li><li><a href=#安装docker>安装Docker</a></li><li><a href=#docker为什么比vm快>Docker为什么比VM快</a></li></ul></li><li><a href=#dokcer的常用命令>Dokcer的常用命令</a><ul><li><a href=#帮助文档>帮助文档</a></li><li><a href=#镜像命令>镜像命令</a></li><li><a href=#容器命令>容器命令</a></li><li><a href=#常用的其他命令>常用的其他命令</a></li><li><a href=#docker练习>docker练习</a></li></ul></li><li><a href=#docker镜像原理>Docker镜像原理</a><ul><li><a href=#镜像是什么>镜像是什么</a></li><li><a href=#docker-镜像加载原理>Docker 镜像加载原理</a></li><li><a href=#分层理解>分层理解</a></li><li><a href=#commit镜像>commit镜像</a></li></ul></li><li><a href=#容器数据卷>容器数据卷</a><ul><li><a href=#什么是容器数据卷>什么是容器数据卷</a></li><li><a href=#使用数据卷>使用数据卷</a></li><li><a href=#具名和匿名挂载>具名和匿名挂载</a></li><li><a href=#初识dockerfile>初识DockerFile</a></li><li><a href=#数据卷容器>数据卷容器</a></li></ul></li><li><a href=#dockerfile>DockerFile</a><ul><li><a href=#dokerfile介绍>DokerFile介绍</a></li><li><a href=#dockerfile构建过程>DockerFile构建过程</a></li><li><a href=#指令>指令：</a></li><li><a href=#实践tomcat镜像>实践：Tomcat镜像</a></li></ul></li><li><a href=#docker网络>Docker网络</a><ul><li><a href=#理解docker0>理解Docker0</a></li><li><a href=#link>link</a></li><li><a href=#自定义网络>自定义网络</a></li><li><a href=#网络连通>网络连通</a></li><li><a href=#部署redis集群>部署redis集群</a></li><li><a href=#springboot项目打包docker镜像>SpringBoot项目打包Docker镜像</a></li></ul></li><li><a href=#docker-compose>Docker Compose</a><ul><li><a href=#简介>简介：</a></li><li><a href=#compose-安装>Compose 安装</a></li><li><a href=#体验>体验</a></li><li><a href=#yaml-规则>yaml 规则</a></li><li><a href=#开源项目>开源项目</a></li><li><a href=#测试>测试：</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h2 id=docker概述>Docker概述<a hidden class=anchor aria-hidden=true href=#docker概述>#</a></h2><h3 id=docker为什么出现>Docker为什么出现？<a hidden class=anchor aria-hidden=true href=#docker为什么出现>#</a></h3><p>一款产品：开发-上线 两套环境！应用环境！应用配置！</p><p>开发 ··· 运维。问题：我的电脑用运行！版本更新，导致服务不可用！对于运维来说，考研太大了</p><p>环境配置是十分麻烦，每一个机器都要部署环境(集群redis,es、Hadoop)！费时费力</p><p>发布一个项目(jar + Redis Mysql + jdk ES),项目能不能都带上环境安装打包</p><p>Docker给以上的问题，提出了解决方案</p><h3 id=docker能做什么>Docker能做什么：<a hidden class=anchor aria-hidden=true href=#docker能做什么>#</a></h3><p><strong>虚拟机技术缺点：</strong></p><ol><li>资源占用十分多</li><li>冗余步骤多</li><li>启动很慢</li></ol><blockquote><p>容器化技术</p></blockquote><p><code>容器化技术不是模拟一个完整的系统</code></p><p>比较docker和虚拟机技术的不同：</p><ul><li>传统虚拟机，虚拟处一条硬件，运行一个完整的操作系统，然后在这个系统上安装软件</li><li>容器内的应用直接运行在宿主机的内，容器没有自己的内核，也没有虚拟我们的硬件，所以轻便了</li><li>每一个容器是相互隔离的，每个容器内都有一个数据自己的文件系统，互不影响</li></ul><blockquote><p>DevOps（开发、运维）</p></blockquote><p><strong>应用更快速的交付和部署:</strong></p><p>传统：一堆帮助文档，安装程序</p><p>Docker:打包镜像发布测试，一键运行</p><p><strong>更便捷的升级和扩缩容:</strong></p><p>使用了Docker之后，我们部署应用就像搭积木一样！</p><p>项目打包为一个镜像，扩展服务器A!服务器B！</p><p><strong>更简单的系统运维:</strong></p><p>在容器化之后，我的开发，测试环境都是高度一致的</p><p><strong>更高效的计算机资源利用:</strong></p><p>Docker是内核级别的虚拟化，可以再一个物理机上运行很多的容器实例！服务器性能可以压榨到极致</p><h2 id=docker安装>Docker安装<a hidden class=anchor aria-hidden=true href=#docker安装>#</a></h2><h3 id=docker基本组成>Docker基本组成<a hidden class=anchor aria-hidden=true href=#docker基本组成>#</a></h3><p><strong>镜像(image)：</strong></p><p>docker镜像就好比一个模板，可以通过这个模板来创建容器服务，tomcat镜像==>run==>tomcat容器(提供服务器)</p><p><strong>容器(container)：</strong></p><p>docker利用容器技术，独立运行一个或者一组应用，通过镜像来创建。启动，停止，删除，基本命令！</p><p>目前可以把这个容器理解为就是一个简易的linux系统</p><p><strong>仓库(repository)：</strong></p><p>仓库就是存放镜像的地方</p><p>仓库分为公有和私有</p><p>Docker Hub（默认是国外的）</p><p>阿里云……都有容器服务器(配置镜像加速)</p><h3 id=安装docker>安装Docker<a hidden class=anchor aria-hidden=true href=#安装docker>#</a></h3><blockquote><p>环境准备</p></blockquote><p>1.需要会一点点linux的基础</p><p>2.CentOs7</p><p>3.连接服务器</p><blockquote><p>环境查看</p></blockquote><p>查看系统内核版本</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 系统内核是3.10以上</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost /<span class=o>]</span><span class=c1># uname -r</span>
</span></span><span class=line><span class=cl>3.10.0-1160.el7.x86_64
</span></span></code></pre></td></tr></table></div></div><p>系统版本</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>NAME</span><span class=o>=</span><span class=s2>&#34;CentOS Linux&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>VERSION</span><span class=o>=</span><span class=s2>&#34;7 (Core)&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>ID</span><span class=o>=</span><span class=s2>&#34;centos&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>ID_LIKE</span><span class=o>=</span><span class=s2>&#34;rhel fedora&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>VERSION_ID</span><span class=o>=</span><span class=s2>&#34;7&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>PRETTY_NAME</span><span class=o>=</span><span class=s2>&#34;CentOS Linux 7 (Core)&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>ANSI_COLOR</span><span class=o>=</span><span class=s2>&#34;0;31&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>CPE_NAME</span><span class=o>=</span><span class=s2>&#34;cpe:/o:centos:centos:7&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>HOME_URL</span><span class=o>=</span><span class=s2>&#34;https://www.centos.org/&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>BUG_REPORT_URL</span><span class=o>=</span><span class=s2>&#34;https://bugs.centos.org/&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>CENTOS_MANTISBT_PROJECT</span><span class=o>=</span><span class=s2>&#34;CentOS-7&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>CENTOS_MANTISBT_PROJECT_VERSION</span><span class=o>=</span><span class=s2>&#34;7&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>REDHAT_SUPPORT_PRODUCT</span><span class=o>=</span><span class=s2>&#34;centos&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>REDHAT_SUPPORT_PRODUCT_VERSION</span><span class=o>=</span><span class=s2>&#34;7&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>帮助文档</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#卸载旧的docker</span>
</span></span><span class=line><span class=cl>yum remove docker <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                  docker-client <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                  docker-client-latest <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                  docker-common <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                  docker-latest <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                  docker-latest-logrotate <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                  docker-logrotate <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                  docker-engine
</span></span><span class=line><span class=cl><span class=c1>#需要的安装包</span>
</span></span><span class=line><span class=cl>yum install -y yum-utils
</span></span><span class=line><span class=cl><span class=c1>#设置镜像仓库</span>
</span></span><span class=line><span class=cl>yum-config-manager <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --add-repo <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    https://download.docker.com/linux/centos/docker-ce.repo
</span></span><span class=line><span class=cl><span class=c1>#阿里云的镜像</span>
</span></span><span class=line><span class=cl> yum-config-manager <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --add-repo <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
</span></span><span class=line><span class=cl><span class=c1>#更新yum软件包索引</span>
</span></span><span class=line><span class=cl>yum makecache fast
</span></span><span class=line><span class=cl><span class=c1>#安装docker相关的 docker-ce社区 ee企业版</span>
</span></span><span class=line><span class=cl>yum install docker-ce docker-ce-cli containerd.io
</span></span><span class=line><span class=cl><span class=c1>#启动Dockers</span>
</span></span><span class=line><span class=cl>systemctl start docker
</span></span><span class=line><span class=cl><span class=c1># 查看docker版本</span>
</span></span><span class=line><span class=cl>docker version
</span></span><span class=line><span class=cl><span class=c1>#hello-world</span>
</span></span><span class=line><span class=cl>docker run hello-world
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>latest: Pulling from library/hello-world
</span></span><span class=line><span class=cl>2db29710123e: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>Digest: sha256:80f31da1ac7b312ba29d65080fddf797dd76acfb870e677f390d5acba9741b17
</span></span><span class=line><span class=cl>Status: Downloaded newer image <span class=k>for</span> hello-world:latest
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Hello from Docker!
</span></span><span class=line><span class=cl>This message shows that your installation appears to be working correctly.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>To generate this message, Docker took the following steps:
</span></span><span class=line><span class=cl> 1. The Docker client contacted the Docker daemon.
</span></span><span class=line><span class=cl> 2. The Docker daemon pulled the <span class=s2>&#34;hello-world&#34;</span> image from the Docker Hub.
</span></span><span class=line><span class=cl>    <span class=o>(</span>amd64<span class=o>)</span>
</span></span><span class=line><span class=cl> 3. The Docker daemon created a new container from that image which runs the
</span></span><span class=line><span class=cl>    executable that produces the output you are currently reading.
</span></span><span class=line><span class=cl> 4. The Docker daemon streamed that output to the Docker client, which sent it
</span></span><span class=line><span class=cl>    to your terminal.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>To try something more ambitious, you can run an Ubuntu container with:
</span></span><span class=line><span class=cl> $ docker run -it ubuntu bash
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Share images, automate workflows, and more with a free Docker ID:
</span></span><span class=line><span class=cl> https://hub.docker.com/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>For more examples and ideas, visit:
</span></span><span class=line><span class=cl> https://docs.docker.com/get-started/
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#查看下载的hello-world镜像
</span></span><span class=line><span class=cl>[root@localhost /]# docker images
</span></span><span class=line><span class=cl>REPOSITORY    TAG       IMAGE ID       CREATED        SIZE
</span></span><span class=line><span class=cl>hello-world   latest    feb5d9fea6a5   7 months ago   13.3kB
</span></span></code></pre></td></tr></table></div></div><p>删除docker</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1.卸载依赖</span>
</span></span><span class=line><span class=cl>yum remove docker-ce docker-ce-cli containerd.io
</span></span><span class=line><span class=cl><span class=c1># 2.删除资源</span>
</span></span><span class=line><span class=cl>rm -rf /var/lib/docker
</span></span></code></pre></td></tr></table></div></div><h3 id=docker为什么比vm快>Docker为什么比VM快<a hidden class=anchor aria-hidden=true href=#docker为什么比vm快>#</a></h3><p>1、Docker有着比虚拟机更少的抽象层</p><p>2、Docker利用的是宿主机的内核，vm需要是Guest OS</p><p>所以说，新建一个容器时，docker不需要虚拟机一样需要重新加载一个操作系统内核，避免引导。虚拟机是加载Guest OS，分钟级别的，而docker是利用宿主机的操作系统内核，省略了这个复杂的过程，秒级</p><h2 id=dokcer的常用命令>Dokcer的常用命令<a hidden class=anchor aria-hidden=true href=#dokcer的常用命令>#</a></h2><h3 id=帮助文档>帮助文档<a hidden class=anchor aria-hidden=true href=#帮助文档>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker version <span class=c1>#显示dokcer的版本系统</span>
</span></span><span class=line><span class=cl>docker info <span class=c1>#显示dokcer的系统信息，包括镜像和容器的数量</span>
</span></span><span class=line><span class=cl>docker 命令 --help <span class=c1>#万能命令</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=镜像命令>镜像命令<a hidden class=anchor aria-hidden=true href=#镜像命令>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker images <span class=c1>#查看所有的镜像</span>
</span></span><span class=line><span class=cl><span class=c1>#解释</span>
</span></span><span class=line><span class=cl>REPOSITORY 镜像的仓库源
</span></span><span class=line><span class=cl>TAG		   镜像的标签
</span></span><span class=line><span class=cl>IMAGE ID   镜像的id
</span></span><span class=line><span class=cl>CREATED    镜像的创建时间
</span></span><span class=line><span class=cl>SIZE       镜像的大小
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#可选项</span>
</span></span><span class=line><span class=cl>  -a, --all             <span class=c1># 列出所有镜像</span>
</span></span><span class=line><span class=cl>  -q, --quiet           <span class=c1># 只显示镜像id</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=docker-search镜像搜索>docker search镜像搜索<a hidden class=anchor aria-hidden=true href=#docker-search镜像搜索>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@localhost lyj<span class=o>]</span><span class=c1># docker search mysql</span>
</span></span><span class=line><span class=cl>NAME                           DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
</span></span><span class=line><span class=cl>mysql                          MySQL is a widely used, open-source relation…   <span class=m>12562</span>     <span class=o>[</span>OK<span class=o>]</span>       
</span></span><span class=line><span class=cl>mariadb                        MariaDB Server is a high performing open sou…   <span class=m>4830</span>      <span class=o>[</span>OK<span class=o>]</span>       
</span></span><span class=line><span class=cl>percona                        Percona Server is a fork of the MySQL relati…   <span class=m>576</span>       <span class=o>[</span>OK<span class=o>]</span>       
</span></span><span class=line><span class=cl>phpmyadmin                     phpMyAdmin - A web interface <span class=k>for</span> MySQL and M…   <span class=m>536</span>       <span class=o>[</span>OK<span class=o>]</span>       
</span></span><span class=line><span class=cl>bitnami/mysql                  Bitnami MySQL Docker Image                      <span class=m>71</span>                   <span class=o>[</span>OK<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=c1># 可选项，通过搜索来过滤</span>
</span></span><span class=line><span class=cl>--filter<span class=o>=</span><span class=nv>STARS</span><span class=o>=</span><span class=m>3000</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost lyj<span class=o>]</span><span class=c1># docker search mysql --filter=STARS=3000</span>
</span></span><span class=line><span class=cl>NAME      DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
</span></span><span class=line><span class=cl>mysql     MySQL is a widely used, open-source relation…   <span class=m>12562</span>     <span class=o>[</span>OK<span class=o>]</span>       
</span></span><span class=line><span class=cl>mariadb   MariaDB Server is a high performing open sou…   <span class=m>4830</span>      <span class=o>[</span>OK<span class=o>]</span> 
</span></span></code></pre></td></tr></table></div></div><h4 id=docker-pull下载镜像>docker pull下载镜像<a hidden class=anchor aria-hidden=true href=#docker-pull下载镜像>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#下载镜像docker pull 镜像名[:tag]
</span></span><span class=line><span class=cl>[root@localhost lyj]# docker pull mysql
</span></span><span class=line><span class=cl>Using default tag: latest
</span></span></code></pre></td></tr></table></div></div><h4 id=dokcer-rmi-删除镜像>dokcer rmi 删除镜像<a hidden class=anchor aria-hidden=true href=#dokcer-rmi-删除镜像>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#全部删除</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost lyj<span class=o>]</span><span class=c1># docker rmi -f $(docker images -aq)</span>
</span></span><span class=line><span class=cl><span class=c1>#单个删除</span>
</span></span><span class=line><span class=cl>docker rmi -f 镜像id
</span></span></code></pre></td></tr></table></div></div><h3 id=容器命令>容器命令<a hidden class=anchor aria-hidden=true href=#容器命令>#</a></h3><p><strong>说明：有了镜像才可以创建容器，Linux，下载一个centos镜像来测试学习</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker pull centos
</span></span></code></pre></td></tr></table></div></div><h4 id=新建容器并启动>新建容器并启动<a hidden class=anchor aria-hidden=true href=#新建容器并启动>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run <span class=o>[</span>可选参数<span class=o>]</span> image
</span></span><span class=line><span class=cl><span class=c1># 参数说明</span>
</span></span><span class=line><span class=cl>--name<span class=o>=</span>“Name”容器名字， tomcat01,tomcat02,用来区分容器
</span></span><span class=line><span class=cl>--d       后台方式运行
</span></span><span class=line><span class=cl>--it      使用交互方式运行，进入容器查看内容
</span></span><span class=line><span class=cl>--p       指定容器的端口 -p 8080:8080
</span></span><span class=line><span class=cl>	-p ip:主机端口：容器端口
</span></span><span class=line><span class=cl>	-p 主机端口：容器端口<span class=o>(</span>常用<span class=o>)</span>
</span></span><span class=line><span class=cl>	-p 容器端口
</span></span><span class=line><span class=cl>	容器端口
</span></span><span class=line><span class=cl>-p        随机指定端口
</span></span><span class=line><span class=cl><span class=c1># 测试，启动并进入容器</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost lyj<span class=o>]</span><span class=c1># docker run -it centos /bin/bash</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@a7546e01fc42 /<span class=o>]</span><span class=c1># ls #查看容器内的centos，基础版本，很多命令都是不完善的</span>
</span></span><span class=line><span class=cl>bin  etc   lib    lost+found  mnt  proc  run   srv  tmp  var
</span></span><span class=line><span class=cl>dev  home  lib64  media       opt  root  sbin  sys  usr
</span></span><span class=line><span class=cl><span class=c1>#从容器中退回主机</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@a7546e01fc42 /<span class=o>]</span><span class=c1># exit</span>
</span></span><span class=line><span class=cl><span class=nb>exit</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=列出所有的运行中的容器>列出所有的运行中的容器<a hidden class=anchor aria-hidden=true href=#列出所有的运行中的容器>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># docker ps 命令</span>
</span></span><span class=line><span class=cl>-a  <span class=c1>#列出当前正在运行的容器+带出历史运行过的容器</span>
</span></span><span class=line><span class=cl>-n<span class=o>=</span>? <span class=c1>#显示最近创建的容器</span>
</span></span><span class=line><span class=cl>-q   <span class=c1>#只显示容器的编号</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost lyj<span class=o>]</span><span class=c1># docker ps</span>
</span></span><span class=line><span class=cl>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost lyj<span class=o>]</span><span class=c1># docker ps -a</span>
</span></span><span class=line><span class=cl>CONTAINER ID   IMAGE          COMMAND       CREATED             STATUS                          PORTS     NAMES
</span></span><span class=line><span class=cl>a7546e01fc42   centos         <span class=s2>&#34;/bin/bash&#34;</span>   <span class=m>3</span> minutes ago       Exited <span class=o>(</span>0<span class=o>)</span> About a minute ago             condescending_williams
</span></span><span class=line><span class=cl>9913150f68cb   feb5d9fea6a5   <span class=s2>&#34;/hello&#34;</span>      About an hour ago   Exited <span class=o>(</span>0<span class=o>)</span> About an hour ago              ecstatic_hodgkin
</span></span></code></pre></td></tr></table></div></div><h4 id=退出容器>退出容器<a hidden class=anchor aria-hidden=true href=#退出容器>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>exit</span> <span class=c1>#直接停止并退出容器</span>
</span></span><span class=line><span class=cl>Ctrl + P + Q <span class=c1>#容器不停止但退出</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=删除容器>删除容器<a hidden class=anchor aria-hidden=true href=#删除容器>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker rm 容器id <span class=c1>#删除指定内容，不能删除正在运行的容器，如果要强制删除 rm -f</span>
</span></span><span class=line><span class=cl>docker rm -f <span class=k>$(</span>docker ps -aq<span class=k>)</span> <span class=c1>#删除所有内容</span>
</span></span><span class=line><span class=cl>docker ps -a -q<span class=p>|</span>xargs docker rm <span class=c1>#删除所有容器</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=启动和停止容器的操作>启动和停止容器的操作<a hidden class=anchor aria-hidden=true href=#启动和停止容器的操作>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker start 容器id #启动容器
</span></span><span class=line><span class=cl>docker restart 容器id #重启容器
</span></span><span class=line><span class=cl>docker stop 容器id #停止当前正在运行的容器
</span></span><span class=line><span class=cl>docker kill 容器id #强制停止当前容器
</span></span></code></pre></td></tr></table></div></div><h3 id=常用的其他命令>常用的其他命令<a hidden class=anchor aria-hidden=true href=#常用的其他命令>#</a></h3><h4 id=后台启动容器>后台启动容器<a hidden class=anchor aria-hidden=true href=#后台启动容器>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 命令 docker run -d 镜像名</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost lyj<span class=o>]</span><span class=c1># docker run -d centos</span>
</span></span><span class=line><span class=cl>0f13a674e8d67ff74b2498339d3c21d3ff2f99b3993a4121af9fa86246be916d
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost lyj<span class=o>]</span><span class=c1># docker ps</span>
</span></span><span class=line><span class=cl>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
</span></span><span class=line><span class=cl><span class=c1># 常见的坑：docker容器使用后台运行，就必须要有一个前台进程，docker发现没有应用，就会自动停止，容器容器后发现自己没有提供服务，就会立刻停止，就是没有程序了</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=查看日志>查看日志<a hidden class=anchor aria-hidden=true href=#查看日志>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker logs -f -t --tail 容器，没有日志
</span></span><span class=line><span class=cl><span class=c1>#自己编写一段shell脚本</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;while true;do echo lyj;slepp 1;done&#34;</span>
</span></span><span class=line><span class=cl><span class=c1>#显示日志</span>
</span></span><span class=line><span class=cl>-tf           <span class=c1>#显示日志</span>
</span></span><span class=line><span class=cl>--tail number <span class=c1>#显示日志条数</span>
</span></span><span class=line><span class=cl>docker logs -ft --tail <span class=m>10</span> 24ac83cd18b4
</span></span></code></pre></td></tr></table></div></div><h4 id=查看容器中的进程信息>查看容器中的进程信息<a hidden class=anchor aria-hidden=true href=#查看容器中的进程信息>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#命令 docker top 容器id</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost lyj<span class=o>]</span><span class=c1># docker top 24ac83cd18b4</span>
</span></span><span class=line><span class=cl>UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD
</span></span><span class=line><span class=cl>root                <span class=m>67867</span>               <span class=m>67847</span>               <span class=m>0</span>                   17:00               ?                   00:00:00            /bin/sh -c <span class=k>while</span> true<span class=p>;</span><span class=k>do</span> <span class=nb>echo</span> lyj<span class=p>;</span>sleep 1<span class=p>;</span><span class=k>done</span>
</span></span><span class=line><span class=cl>root                <span class=m>68185</span>               <span class=m>67867</span>               <span class=m>0</span>                   17:03               ?                   00:00:00            /usr/bin/coreutils --coreutils-prog-shebang<span class=o>=</span>sleep /usr/bin/sleep <span class=m>1</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=查看镜像的元数据>查看镜像的元数据<a hidden class=anchor aria-hidden=true href=#查看镜像的元数据>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 命令</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost lyj<span class=o>]</span><span class=c1># docker inspect 24ac83cd18b4</span>
</span></span><span class=line><span class=cl><span class=o>[</span>
</span></span><span class=line><span class=cl>    <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Id&#34;</span>: <span class=s2>&#34;24ac83cd18b425e9f503e5899842dd1603559c0443926a393e814b7259aeb427&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Created&#34;</span>: <span class=s2>&#34;2022-05-13T09:00:28.314887816Z&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Path&#34;</span>: <span class=s2>&#34;/bin/sh&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Args&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;-c&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;while true;do echo lyj;sleep 1;done&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>]</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;State&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Status&#34;</span>: <span class=s2>&#34;running&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Running&#34;</span>: true,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Paused&#34;</span>: false,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Restarting&#34;</span>: false,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;OOMKilled&#34;</span>: false,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Dead&#34;</span>: false,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Pid&#34;</span>: 67867,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;ExitCode&#34;</span>: 0,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Error&#34;</span>: <span class=s2>&#34;&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;StartedAt&#34;</span>: <span class=s2>&#34;2022-05-13T09:00:28.676332024Z&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;FinishedAt&#34;</span>: <span class=s2>&#34;0001-01-01T00:00:00Z&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Image&#34;</span>: <span class=s2>&#34;sha256:5d0da3dc976460b72c77d94c8a1ad043720b0416bfc16c52c45d4847e53fadb6&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;ResolvConfPath&#34;</span>: <span class=s2>&#34;/var/lib/docker/containers/24ac83cd18b425e9f503e5899842dd1603559c0443926a393e814b7259aeb427/resolv.conf&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;HostnamePath&#34;</span>: <span class=s2>&#34;/var/lib/docker/containers/24ac83cd18b425e9f503e5899842dd1603559c0443926a393e814b7259aeb427/hostname&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;HostsPath&#34;</span>: <span class=s2>&#34;/var/lib/docker/containers/24ac83cd18b425e9f503e5899842dd1603559c0443926a393e814b7259aeb427/hosts&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;LogPath&#34;</span>: <span class=s2>&#34;/var/lib/docker/containers/24ac83cd18b425e9f503e5899842dd1603559c0443926a393e814b7259aeb427/24ac83cd18b425e9f503e5899842dd1603559c0443926a393e814b7259aeb427-json.log&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Name&#34;</span>: <span class=s2>&#34;/elastic_gagarin&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;RestartCount&#34;</span>: 0,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Driver&#34;</span>: <span class=s2>&#34;overlay2&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Platform&#34;</span>: <span class=s2>&#34;linux&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;MountLabel&#34;</span>: <span class=s2>&#34;&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;ProcessLabel&#34;</span>: <span class=s2>&#34;&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;AppArmorProfile&#34;</span>: <span class=s2>&#34;&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;ExecIDs&#34;</span>: null,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;HostConfig&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Binds&#34;</span>: null,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;ContainerIDFile&#34;</span>: <span class=s2>&#34;&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;LogConfig&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;Type&#34;</span>: <span class=s2>&#34;json-file&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;Config&#34;</span>: <span class=o>{}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;NetworkMode&#34;</span>: <span class=s2>&#34;default&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;PortBindings&#34;</span>: <span class=o>{}</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;RestartPolicy&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;Name&#34;</span>: <span class=s2>&#34;no&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;MaximumRetryCount&#34;</span>: <span class=m>0</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;AutoRemove&#34;</span>: false,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;VolumeDriver&#34;</span>: <span class=s2>&#34;&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;VolumesFrom&#34;</span>: null,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;CapAdd&#34;</span>: null,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;CapDrop&#34;</span>: null,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;CgroupnsMode&#34;</span>: <span class=s2>&#34;host&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Dns&#34;</span>: <span class=o>[]</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;DnsOptions&#34;</span>: <span class=o>[]</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;DnsSearch&#34;</span>: <span class=o>[]</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;ExtraHosts&#34;</span>: null,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;GroupAdd&#34;</span>: null,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;IpcMode&#34;</span>: <span class=s2>&#34;private&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Cgroup&#34;</span>: <span class=s2>&#34;&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Links&#34;</span>: null,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;OomScoreAdj&#34;</span>: 0,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;PidMode&#34;</span>: <span class=s2>&#34;&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Privileged&#34;</span>: false,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;PublishAllPorts&#34;</span>: false,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;ReadonlyRootfs&#34;</span>: false,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;SecurityOpt&#34;</span>: null,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;UTSMode&#34;</span>: <span class=s2>&#34;&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;UsernsMode&#34;</span>: <span class=s2>&#34;&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;ShmSize&#34;</span>: 67108864,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Runtime&#34;</span>: <span class=s2>&#34;runc&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;ConsoleSize&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>                0,
</span></span><span class=line><span class=cl>                <span class=m>0</span>
</span></span><span class=line><span class=cl>            <span class=o>]</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Isolation&#34;</span>: <span class=s2>&#34;&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;CpuShares&#34;</span>: 0,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Memory&#34;</span>: 0,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;NanoCpus&#34;</span>: 0,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;CgroupParent&#34;</span>: <span class=s2>&#34;&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;BlkioWeight&#34;</span>: 0,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;BlkioWeightDevice&#34;</span>: <span class=o>[]</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;BlkioDeviceReadBps&#34;</span>: null,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;BlkioDeviceWriteBps&#34;</span>: null,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;BlkioDeviceReadIOps&#34;</span>: null,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;BlkioDeviceWriteIOps&#34;</span>: null,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;CpuPeriod&#34;</span>: 0,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;CpuQuota&#34;</span>: 0,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;CpuRealtimePeriod&#34;</span>: 0,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;CpuRealtimeRuntime&#34;</span>: 0,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;CpusetCpus&#34;</span>: <span class=s2>&#34;&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;CpusetMems&#34;</span>: <span class=s2>&#34;&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Devices&#34;</span>: <span class=o>[]</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;DeviceCgroupRules&#34;</span>: null,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;DeviceRequests&#34;</span>: null,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;KernelMemory&#34;</span>: 0,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;KernelMemoryTCP&#34;</span>: 0,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;MemoryReservation&#34;</span>: 0,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;MemorySwap&#34;</span>: 0,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;MemorySwappiness&#34;</span>: null,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;OomKillDisable&#34;</span>: false,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;PidsLimit&#34;</span>: null,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Ulimits&#34;</span>: null,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;CpuCount&#34;</span>: 0,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;CpuPercent&#34;</span>: 0,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;IOMaximumIOps&#34;</span>: 0,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;IOMaximumBandwidth&#34;</span>: 0,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;MaskedPaths&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;/proc/asound&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;/proc/acpi&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;/proc/kcore&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;/proc/keys&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;/proc/latency_stats&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;/proc/timer_list&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;/proc/timer_stats&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;/proc/sched_debug&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;/proc/scsi&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;/sys/firmware&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>]</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;ReadonlyPaths&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;/proc/bus&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;/proc/fs&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;/proc/irq&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;/proc/sys&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;/proc/sysrq-trigger&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>]</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;GraphDriver&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Data&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;LowerDir&#34;</span>: <span class=s2>&#34;/var/lib/docker/overlay2/5c73a261c173cec8db9c2dd48143a5b963b2cce23dda4eb01262802efc898c54-init/diff:/var/lib/docker/overlay2/993f875b14fb02906ce0a4cc96d2fd0bd51ac4c3137d23be448fb77fefd26c14/diff&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;MergedDir&#34;</span>: <span class=s2>&#34;/var/lib/docker/overlay2/5c73a261c173cec8db9c2dd48143a5b963b2cce23dda4eb01262802efc898c54/merged&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;UpperDir&#34;</span>: <span class=s2>&#34;/var/lib/docker/overlay2/5c73a261c173cec8db9c2dd48143a5b963b2cce23dda4eb01262802efc898c54/diff&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;WorkDir&#34;</span>: <span class=s2>&#34;/var/lib/docker/overlay2/5c73a261c173cec8db9c2dd48143a5b963b2cce23dda4eb01262802efc898c54/work&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Name&#34;</span>: <span class=s2>&#34;overlay2&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Mounts&#34;</span>: <span class=o>[]</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Config&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Hostname&#34;</span>: <span class=s2>&#34;24ac83cd18b4&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Domainname&#34;</span>: <span class=s2>&#34;&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;User&#34;</span>: <span class=s2>&#34;&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;AttachStdin&#34;</span>: false,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;AttachStdout&#34;</span>: false,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;AttachStderr&#34;</span>: false,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Tty&#34;</span>: false,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;OpenStdin&#34;</span>: false,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;StdinOnce&#34;</span>: false,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Env&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>]</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Cmd&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;/bin/sh&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;-c&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;while true;do echo lyj;sleep 1;done&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>]</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Image&#34;</span>: <span class=s2>&#34;centos&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Volumes&#34;</span>: null,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;WorkingDir&#34;</span>: <span class=s2>&#34;&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Entrypoint&#34;</span>: null,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;OnBuild&#34;</span>: null,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Labels&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;org.label-schema.build-date&#34;</span>: <span class=s2>&#34;20210915&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;org.label-schema.license&#34;</span>: <span class=s2>&#34;GPLv2&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;org.label-schema.name&#34;</span>: <span class=s2>&#34;CentOS Base Image&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;org.label-schema.schema-version&#34;</span>: <span class=s2>&#34;1.0&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;org.label-schema.vendor&#34;</span>: <span class=s2>&#34;CentOS&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;NetworkSettings&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Bridge&#34;</span>: <span class=s2>&#34;&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;SandboxID&#34;</span>: <span class=s2>&#34;c3c2cb8267717831d8702df2cc45333b92f175b66461de902323aa9d61e94252&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;HairpinMode&#34;</span>: false,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;LinkLocalIPv6Address&#34;</span>: <span class=s2>&#34;&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;LinkLocalIPv6PrefixLen&#34;</span>: 0,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Ports&#34;</span>: <span class=o>{}</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;SandboxKey&#34;</span>: <span class=s2>&#34;/var/run/docker/netns/c3c2cb826771&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;SecondaryIPAddresses&#34;</span>: null,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;SecondaryIPv6Addresses&#34;</span>: null,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;EndpointID&#34;</span>: <span class=s2>&#34;f73444ad58e812ca8039b7ccd3c683dbaa63873183a14c1a2d395136f6414d5b&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Gateway&#34;</span>: <span class=s2>&#34;172.17.0.1&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;GlobalIPv6Address&#34;</span>: <span class=s2>&#34;&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;GlobalIPv6PrefixLen&#34;</span>: 0,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;IPAddress&#34;</span>: <span class=s2>&#34;172.17.0.2&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;IPPrefixLen&#34;</span>: 16,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;IPv6Gateway&#34;</span>: <span class=s2>&#34;&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;MacAddress&#34;</span>: <span class=s2>&#34;02:42:ac:11:00:02&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Networks&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;bridge&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;IPAMConfig&#34;</span>: null,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;Links&#34;</span>: null,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;Aliases&#34;</span>: null,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;NetworkID&#34;</span>: <span class=s2>&#34;b3b838684f4e337f0a1e6fb386dd7b7a6860ba5e5b34bf1b2d32fd1833a058b5&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;EndpointID&#34;</span>: <span class=s2>&#34;f73444ad58e812ca8039b7ccd3c683dbaa63873183a14c1a2d395136f6414d5b&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;Gateway&#34;</span>: <span class=s2>&#34;172.17.0.1&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;IPAddress&#34;</span>: <span class=s2>&#34;172.17.0.2&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;IPPrefixLen&#34;</span>: 16,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;IPv6Gateway&#34;</span>: <span class=s2>&#34;&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;GlobalIPv6Address&#34;</span>: <span class=s2>&#34;&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;GlobalIPv6PrefixLen&#34;</span>: 0,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;MacAddress&#34;</span>: <span class=s2>&#34;02:42:ac:11:00:02&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;DriverOpts&#34;</span>: null
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=进入当前正在运行的容器>进入当前正在运行的容器<a hidden class=anchor aria-hidden=true href=#进入当前正在运行的容器>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#我们通常容器都是使用后台方式运行的，需要进入容器，修改一些配置</span>
</span></span><span class=line><span class=cl><span class=c1>#命令</span>
</span></span><span class=line><span class=cl>docker <span class=nb>exec</span> -it 容器id bashShell
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#测试</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost lyj<span class=o>]</span><span class=c1># docker exec -it 24ac83cd18b4 /bin/bash</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@24ac83cd18b4 /<span class=o>]</span><span class=c1># ls</span>
</span></span><span class=line><span class=cl>bin  etc   lib    lost+found  mnt  proc  run   srv  tmp  var
</span></span><span class=line><span class=cl>dev  home  lib64  media       opt  root  sbin  sys  usr
</span></span><span class=line><span class=cl><span class=o>[</span>root@24ac83cd18b4 /<span class=o>]</span><span class=c1># ps -ef</span>
</span></span><span class=line><span class=cl>UID         PID   PPID  C STIME TTY          TIME CMD
</span></span><span class=line><span class=cl>root          <span class=m>1</span>      <span class=m>0</span>  <span class=m>0</span> 09:00 ?        00:00:06 /bin/sh -c <span class=k>while</span> true<span class=p>;</span><span class=k>do</span> <span class=nb>echo</span> lyj<span class=p>;</span>sleep 1<span class=p>;</span><span class=k>done</span>
</span></span><span class=line><span class=cl>root       <span class=m>9470</span>      <span class=m>0</span>  <span class=m>0</span> 11:39 pts/0    00:00:00 /bin/bash
</span></span><span class=line><span class=cl>root       <span class=m>9501</span>      <span class=m>1</span>  <span class=m>0</span> 11:39 ?        00:00:00 /usr/bin/coreutils --coreutils-prog-shebang<span class=o>=</span>sleep /usr/binroot       <span class=m>9502</span>   <span class=m>9470</span>  <span class=m>0</span> 11:39 pts/0    00:00:00 ps -ef
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#方式二</span>
</span></span><span class=line><span class=cl>docker attach 容器id
</span></span><span class=line><span class=cl><span class=c1>#测试</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost lyj<span class=o>]</span><span class=c1># docker attach  24ac83cd18b4</span>
</span></span><span class=line><span class=cl><span class=c1>#正在执行当前的代码</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#docker exec 进入容器后开启一个新的终端，可以在里面操作（常用）</span>
</span></span><span class=line><span class=cl><span class=c1>#docker attach 进入容器正在执行的终端，不会启动新的进程</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=从容器内拷贝文件到主机上>从容器内拷贝文件到主机上<a hidden class=anchor aria-hidden=true href=#从容器内拷贝文件到主机上>#</a></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker cp 容器id:容器内路径  目的的主机路径
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#测试</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost home<span class=o>]</span><span class=c1># docker attach e1c59c6358fd</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@e1c59c6358fd /<span class=o>]</span><span class=c1># cd /home</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@e1c59c6358fd home<span class=o>]</span><span class=c1># ls</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@e1c59c6358fd home<span class=o>]</span><span class=c1># touch test.java</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@e1c59c6358fd home<span class=o>]</span><span class=c1># ls</span>
</span></span><span class=line><span class=cl>test.java
</span></span><span class=line><span class=cl><span class=o>[</span>root@e1c59c6358fd home<span class=o>]</span><span class=c1># exit</span>
</span></span><span class=line><span class=cl><span class=nb>exit</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost home<span class=o>]</span><span class=c1># docker ps</span>
</span></span><span class=line><span class=cl>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost home<span class=o>]</span><span class=c1># docker ps -a</span>
</span></span><span class=line><span class=cl>CONTAINER ID   IMAGE     COMMAND       CREATED         STATUS                     PORTS     NAMES
</span></span><span class=line><span class=cl>e1c59c6358fd   centos    <span class=s2>&#34;/bin/bash&#34;</span>   <span class=m>2</span> minutes ago   Exited <span class=o>(</span>0<span class=o>)</span> <span class=m>8</span> seconds ago             romantic_aryabhata
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost home<span class=o>]</span><span class=c1># docker cp e1c59c6358fd:/home/test.java /home</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost home<span class=o>]</span><span class=c1># ls</span>
</span></span><span class=line><span class=cl>lyj  lyj.java  test.java
</span></span></code></pre></td></tr></table></div></div><h3 id=docker练习>docker练习<a hidden class=anchor aria-hidden=true href=#docker练习>#</a></h3><blockquote><p>Docker 安装nginx</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1.搜索镜像 search </span>
</span></span><span class=line><span class=cl><span class=c1># 在docker hub上搜索nginx</span>
</span></span><span class=line><span class=cl><span class=c1># 2.下载镜像 pull</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost lyj<span class=o>]</span><span class=c1># docker pull nginx</span>
</span></span><span class=line><span class=cl>Using default tag: latest
</span></span><span class=line><span class=cl>latest: Pulling from library/nginx
</span></span><span class=line><span class=cl>a2abf6c4d29d: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>a9edb18cadd1: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>589b7251471a: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>186b1aaa4aa6: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>b4df32aa5a72: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>a0bcbecc962e: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>Digest: sha256:0d17b565c37bcbd895e9d92315a05c1c3c9a29f762b011a10c54a66cd53c9b31
</span></span><span class=line><span class=cl>Status: Downloaded newer image <span class=k>for</span> nginx:latest
</span></span><span class=line><span class=cl>docker.io/library/nginx:latest
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost lyj<span class=o>]</span><span class=c1># docker images</span>
</span></span><span class=line><span class=cl>REPOSITORY   TAG       IMAGE ID       CREATED        SIZE
</span></span><span class=line><span class=cl>nginx        latest    605c77e624dd   <span class=m>4</span> months ago   141MB
</span></span><span class=line><span class=cl>centos       latest    5d0da3dc9764   <span class=m>8</span> months ago   231MB
</span></span><span class=line><span class=cl><span class=c1># -d 后台运行 </span>
</span></span><span class=line><span class=cl><span class=c1># --name 给容器命令</span>
</span></span><span class=line><span class=cl><span class=c1># -p 宿主机端口，容器内部端口</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost lyj<span class=o>]</span><span class=c1># docker run -d --name nginx01 -p 3344:80 nginx</span>
</span></span><span class=line><span class=cl>65c821bada5be37eddada13eb537c095857535a5393d9d45dc8505798c80f259
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 进入容器</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost lyj<span class=o>]</span><span class=c1># docker exec -it nginx01 /bin/bash</span>
</span></span><span class=line><span class=cl>root@65c821bada5b:/# whereis nginx
</span></span><span class=line><span class=cl>nginx: /usr/sbin/nginx /usr/lib/nginx /etc/nginx /usr/share/nginx
</span></span><span class=line><span class=cl>root@65c821bada5b:/# ls
</span></span><span class=line><span class=cl>bin   dev                  docker-entrypoint.sh  home  lib64  mnt  proc  run   srv  tmp  var
</span></span><span class=line><span class=cl>boot  docker-entrypoint.d  etc                   lib   media  opt  root  sbin  sys  usr
</span></span><span class=line><span class=cl>root@65c821bada5b:/# <span class=nb>cd</span> /ect/nginx
</span></span><span class=line><span class=cl>bash: cd: /ect/nginx: No such file or directory
</span></span><span class=line><span class=cl>root@65c821bada5b:/# <span class=nb>cd</span> /etc/nginx
</span></span><span class=line><span class=cl>root@65c821bada5b:/etc/nginx# ls
</span></span><span class=line><span class=cl>conf.d  fastcgi_params  mime.types  modules  nginx.conf  scgi_params  uwsgi_params
</span></span></code></pre></td></tr></table></div></div><blockquote><p>Docker布局tomcat</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 官方的使用</span>
</span></span><span class=line><span class=cl>docker run -it --rm tomcat:9.0 <span class=c1>#用来测试，用完即删</span>
</span></span><span class=line><span class=cl><span class=c1># 我们之前的启动都是后台，停止容器之后，容器还是可以查到</span>
</span></span><span class=line><span class=cl><span class=c1># 下载在启动</span>
</span></span><span class=line><span class=cl>docker pull tomcat:9.0
</span></span><span class=line><span class=cl><span class=c1># 启动运行</span>
</span></span><span class=line><span class=cl>docker run -d -p 3355:8080 --name tomcat01 tomcat
</span></span><span class=line><span class=cl><span class=c1># 测试访问没有问题</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 进入容器</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost lyj<span class=o>]</span><span class=c1># docker exec -it tomcat01 /bin/bash</span>
</span></span><span class=line><span class=cl><span class=c1># 发现问题：1.Linux命令太少了。 2.没有webapps. 阿里云镜像的原因，默认是最小的镜像，所以不必要的都剔除了</span>
</span></span><span class=line><span class=cl><span class=c1># 保证最小可运行镜像</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>Docker 部署es+kibana</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># es 暴露的端口很多！</span>
</span></span><span class=line><span class=cl><span class=c1># es 十分耗内存</span>
</span></span><span class=line><span class=cl><span class=c1># es 的数据一般需要放置到安全目录</span>
</span></span><span class=line><span class=cl><span class=c1># --net somenetwork ？ 网络设置</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>docker run -d --name elasticsearch --net somenetwork -p 9200:9200 -p 9300:9300 -e <span class=s2>&#34;discovery.type=single-node&#34;</span> elasticsearch:tag
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 启动了 linux就卡住了 docker stats 查看cpu的状态</span>
</span></span><span class=line><span class=cl><span class=c1># es 是十分耗内存的</span>
</span></span><span class=line><span class=cl><span class=c1># 查看 docker stats</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 关闭es,修改配置文件</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=可视化>可视化<a hidden class=anchor aria-hidden=true href=#可视化>#</a></h4><ul><li>portainer(先用这个)</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -d -p 8088:9000 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--restart<span class=o>=</span>always -v /var/run/docker.sock:/var/run/docker.sock --privileged<span class=o>=</span><span class=nb>true</span> portainer/portainer
</span></span></code></pre></td></tr></table></div></div><ul><li>Rancher(CI/CD再用)</li></ul><h5 id=什么portainer>什么portainer?<a hidden class=anchor aria-hidden=true href=#什么portainer>#</a></h5><p>Docker图形化界面管理工具！提供一个后台面板供我们操作！</p><p>测试：访问外网</p><h2 id=docker镜像原理>Docker镜像原理<a hidden class=anchor aria-hidden=true href=#docker镜像原理>#</a></h2><h3 id=镜像是什么>镜像是什么<a hidden class=anchor aria-hidden=true href=#镜像是什么>#</a></h3><p>镜像是一种轻量级、可执行的独立软件包，用来打包软件运行环境和基于运行环境开发的软件，它包含了运行某个软件所需的所有的内容，包括代码、运行时、库、环境变量和配置文件。</p><h4 id=如何得到镜像>如何得到镜像<a hidden class=anchor aria-hidden=true href=#如何得到镜像>#</a></h4><ul><li>从远程仓库下载</li><li>朋友拷贝给你</li><li>自己制作一个镜像DockerFile</li></ul><h3 id=docker-镜像加载原理>Docker 镜像加载原理<a hidden class=anchor aria-hidden=true href=#docker-镜像加载原理>#</a></h3><blockquote><p>UnionFS（联合文件系统）</p></blockquote><p>**UnionFS（联合文件系统）：**UnionFS文件系统（UnionFS）是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改，作为一次提交一层层的叠加，同时可以将不同的目录挂载到同一个虚拟文件系统下（unite several directories into a single virtual file system）。Union文件系统所是Docker镜像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像。</p><p>**特性：**一次同时加载多个文件系统，但才外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录</p><blockquote><p>Docker镜像加载原理</p></blockquote><p>docker的镜像实际上由一层一层的文件系统组成，这个层级的文件系统UnionFS。</p><p>bootfs(boot file system)主要包含bootloader和kernel，bootloader主要是引导加载kernel，linux刚启动后会加载bootfs文件系统，在docker镜像的最底层是bootfs。这一层与我们典型的linux/unix系统是一样的，包括boot加载器和内核。当boot加载完成之后整个内核就都在内存中了，此时内存的使用权已由bootfs转交给内核，此时系统也会卸载bootfs。</p><p>rootfs（root file system）,在bootfs智商，包含的就是典型的linux系统中的/dev，/proc，/bin，/etc等标准目录和文件。rootfs就是各种不同的操作系统发行版本，比如ubuntu，centos等等</p><p>平时我们安装虚拟机的CentOs都是好几个g，为什么docker这里才几百兆</p><p>对于一个精简的os，rootfs可以很小，只需要包含最基本的命令，工具和程序库就可以了，因为底层直接用Host的kernel，自己只需要提供rootfs就可以了。由此可见对于不同的linux发行版，bootfs基本是一致的，rootfs会有差别，因此不同的发行版本可用公用bootfs。</p><h3 id=分层理解>分层理解<a hidden class=anchor aria-hidden=true href=#分层理解>#</a></h3><blockquote><p>分层的镜像</p></blockquote><p>为什么Docker镜像要采用这种分层的结构？</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@localhost lyj<span class=o>]</span><span class=c1># docker pull redis</span>
</span></span><span class=line><span class=cl>Using default tag: latest
</span></span><span class=line><span class=cl>latest: Pulling from library/redis
</span></span><span class=line><span class=cl>a2abf6c4d29d: Already exists 
</span></span><span class=line><span class=cl>c7a4e4382001: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>4044b9ba67c9: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>c8388a79482f: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>413c8bb60be2: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>1abfd3011519: Pull <span class=nb>complete</span> 
</span></span><span class=line><span class=cl>Digest: sha256:db485f2e245b5b3329fdc7eff4eb00f913e09d8feb9ca720788059fdc2ed8339
</span></span><span class=line><span class=cl>Status: Downloaded newer image <span class=k>for</span> redis:latest
</span></span><span class=line><span class=cl>docker.io/library/redis:latest
</span></span></code></pre></td></tr></table></div></div><p>最大的好处，莫过于资源共享了！比如有多个镜像都从相同的Base镜像构建而来，那么宿主机只需要在磁盘上保留一份base镜像，同时内存中也只需要加载一份base镜像，这样就可以为所有的容器服务了，而且镜像的每一层都可以被共享。</p><p>查看镜像分层可以通过docker image inspect命令！</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@localhost lyj<span class=o>]</span><span class=c1># docker image inspect redis:latest</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=commit镜像>commit镜像<a hidden class=anchor aria-hidden=true href=#commit镜像>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker commit 提交内容成为一个新的副本
</span></span><span class=line><span class=cl><span class=c1># 命令和git类似</span>
</span></span><span class=line><span class=cl>docker commit -m<span class=o>=</span><span class=s2>&#34;提交的描述信息&#34;</span> -a<span class=o>=</span><span class=s2>&#34;作者&#34;</span> 容器id 目标镜像名：<span class=o>[</span>TAG<span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>实践</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 启动一个默认的tomcat</span>
</span></span><span class=line><span class=cl><span class=c1># 发现默认的tomcat是没有webapps应用的，原因在于官方的镜像webapps下的文件</span>
</span></span><span class=line><span class=cl><span class=c1># 将文件复制到webapps下</span>
</span></span><span class=line><span class=cl>p -r webapps.dist/* webapps
</span></span><span class=line><span class=cl><span class=c1># 将修改过的容器通过commit操作提交为一个镜像，以后就可以使用修改过的镜像</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost lyj<span class=o>]</span><span class=c1># docker commit -a=&#34;lyj&#34; -m=&#34;add webapps app content&#34; 79602de12c77 tomcat02:1.0</span>
</span></span><span class=line><span class=cl>sha256:60a918d863158b5ceb76c17bac25c9e974b2e0f6e107255c6538b100e80549c7
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost lyj<span class=o>]</span><span class=c1># docker images</span>
</span></span><span class=line><span class=cl>REPOSITORY            TAG       IMAGE ID       CREATED         SIZE
</span></span><span class=line><span class=cl>tomcat02              1.0       60a918d86315   <span class=m>3</span> seconds ago   684MB
</span></span><span class=line><span class=cl>nginx                 latest    605c77e624dd   <span class=m>4</span> months ago    141MB
</span></span><span class=line><span class=cl>tomcat                9.0       b8e65a4d736d   <span class=m>4</span> months ago    680MB
</span></span><span class=line><span class=cl>tomcat                latest    fb5657adc892   <span class=m>4</span> months ago    680MB
</span></span><span class=line><span class=cl>redis                 latest    7614ae9453d1   <span class=m>4</span> months ago    113MB
</span></span><span class=line><span class=cl>centos                latest    5d0da3dc9764   <span class=m>8</span> months ago    231MB
</span></span><span class=line><span class=cl>portainer/portainer   latest    580c0e4e98b0   <span class=m>14</span> months ago   79.1MB
</span></span><span class=line><span class=cl>elasticsearch         7.6.2     f29a1ee41030   <span class=m>2</span> years ago     791MB
</span></span></code></pre></td></tr></table></div></div><h2 id=容器数据卷>容器数据卷<a hidden class=anchor aria-hidden=true href=#容器数据卷>#</a></h2><h3 id=什么是容器数据卷>什么是容器数据卷<a hidden class=anchor aria-hidden=true href=#什么是容器数据卷>#</a></h3><p>**docker的理念：**将应用和环境打包成一个镜像</p><p>容器之间由一个数据共享的技术，Docker容器中产生的数据，可以同步到本地</p><p>卷技术：将容器目录挂载到linux上面</p><h3 id=使用数据卷>使用数据卷<a hidden class=anchor aria-hidden=true href=#使用数据卷>#</a></h3><blockquote><p>直接使用命令挂载</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -it -v 主机目录：容器目录
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost home<span class=o>]</span><span class=c1># docker run -it -v /home/test:/home centos /bin/bash</span>
</span></span><span class=line><span class=cl><span class=c1>#查看是否挂载成功</span>
</span></span><span class=line><span class=cl>docker inspect 5ccb1ac870bf
</span></span></code></pre></td></tr></table></div></div><blockquote><p>实践：安装Mysql</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 下载镜像</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost /<span class=o>]</span><span class=c1># docker pull mysql:5.7</span>
</span></span><span class=line><span class=cl>5.7: Pulling from library/mysql
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 运行容器，挂载数据</span>
</span></span><span class=line><span class=cl><span class=c1># 安装启动mysql需要设置密码</span>
</span></span><span class=line><span class=cl><span class=c1># 官方：  docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 启动成功</span>
</span></span><span class=line><span class=cl><span class=c1># -v 数据卷挂载</span>
</span></span><span class=line><span class=cl><span class=c1># -d 后台启动</span>
</span></span><span class=line><span class=cl><span class=c1># -p 端口映射</span>
</span></span><span class=line><span class=cl><span class=c1># -e 环境配置</span>
</span></span><span class=line><span class=cl><span class=c1># --name 容器名字</span>
</span></span><span class=line><span class=cl>docker run -d -p 3310:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e <span class=nv>MYSQL_ROOT_PASSWORD</span><span class=o>=</span><span class=m>123456</span> --name mysql01 mysql:5.7
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 启动成功之后，连接docker的mysql</span>
</span></span><span class=line><span class=cl><span class=c1># 通过navicat连接数据库</span>
</span></span><span class=line><span class=cl><span class=c1># 创建一个数据库，测试文件是否挂载成功</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost data<span class=o>]</span><span class=c1># ls</span>
</span></span><span class=line><span class=cl>auto.cnf    client-cert.pem  ibdata1      ibtmp1              private_key.pem  server-key.pem
</span></span><span class=line><span class=cl>ca-key.pem  client-key.pem   ib_logfile0  mysql               public_key.pem   sys
</span></span><span class=line><span class=cl>ca.pem      ib_buffer_pool   ib_logfile1  performance_schema  server-cert.pem  <span class=nb>test</span>
</span></span><span class=line><span class=cl><span class=c1># 容器删除之后，挂载的数据卷依旧没有丢失文件</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=具名和匿名挂载>具名和匿名挂载<a hidden class=anchor aria-hidden=true href=#具名和匿名挂载>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 匿名挂载</span>
</span></span><span class=line><span class=cl>-v 容器内路径
</span></span><span class=line><span class=cl>-P 随机端口
</span></span><span class=line><span class=cl>docker run -d -P --name nginx01 -v /etc/nginx nginx
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost /<span class=o>]</span><span class=c1># docker volume ls</span>
</span></span><span class=line><span class=cl>DRIVER    VOLUME NAME
</span></span><span class=line><span class=cl><span class=nb>local</span>     d13150
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 剧名挂载</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost /<span class=o>]</span><span class=c1># docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx nginx</span>
</span></span><span class=line><span class=cl>e35b3cf78a4964b5bcc6836c43c5e60665316c310e04580ee2ab42dde5473eb7
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost /<span class=o>]</span><span class=c1># docker volume ls</span>
</span></span><span class=line><span class=cl>DRIVER    VOLUME NAME
</span></span><span class=line><span class=cl><span class=nb>local</span>     d131501ea9c086991b05e9e59fa9902d265b46a339c15202c59bc9c023f4ab2f
</span></span><span class=line><span class=cl><span class=nb>local</span>     juming-nginx
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 查看具名挂载的位置</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost /<span class=o>]</span><span class=c1># docker volume inspect juming-nginx</span>
</span></span><span class=line><span class=cl><span class=o>[</span>
</span></span><span class=line><span class=cl>    <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;CreatedAt&#34;</span>: <span class=s2>&#34;2022-05-14T15:49:21+08:00&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Driver&#34;</span>: <span class=s2>&#34;local&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Labels&#34;</span>: null,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Mountpoint&#34;</span>: <span class=s2>&#34;/var/lib/docker/volumes/juming-nginx/_data&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Name&#34;</span>: <span class=s2>&#34;juming-nginx&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Options&#34;</span>: null,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Scope&#34;</span>: <span class=s2>&#34;local&#34;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><p>所有docker容器内的卷，没有指定目录都是在<code>/var/lib/docker/volumes/xxx/_data</code></p><p>通过具名挂载可以方便的找到卷，大多数使用的都是<code>具名挂载</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 如何确定是具名挂载合适匿名挂载，还是指定路径挂载</span>
</span></span><span class=line><span class=cl>-v 容器内路径  <span class=c1>#匿名挂载</span>
</span></span><span class=line><span class=cl>-v 卷名：容器内路径 <span class=c1>#具名挂载</span>
</span></span><span class=line><span class=cl>-v /宿主机路径：容器内路径 <span class=c1>#指定路径挂载</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>拓展：</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 通过 -v 容器内路径 ro rw 改变读写权限</span>
</span></span><span class=line><span class=cl><span class=c1># ro  readonly 只读</span>
</span></span><span class=line><span class=cl><span class=c1># rw  readwrite 可读可写</span>
</span></span><span class=line><span class=cl>docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx:ro nginx
</span></span><span class=line><span class=cl>docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx:rw nginx
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#ro 说明这个路径只能通过宿主机来操作，容器内部无法操作</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=初识dockerfile>初识DockerFile<a hidden class=anchor aria-hidden=true href=#初识dockerfile>#</a></h3><p>DockerFile就是用来构建docker镜像的构建文件！</p><p>通过脚本生成镜像，镜像是一层一层的，脚本是一个个命令，每一个命令就是一层</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 创建一个dockerfile文件，名字可以随便</span>
</span></span><span class=line><span class=cl><span class=c1># 文件中的内容 指令(大写) 参数</span>
</span></span><span class=line><span class=cl>FORM centos
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>VOLUME <span class=o>[</span><span class=s2>&#34;volume01&#34;</span>,<span class=s2>&#34;volume02&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>CMD <span class=nb>echo</span> <span class=s2>&#34;----end----&#34;</span>
</span></span><span class=line><span class=cl>CMD /bin/bash
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@localhost docker-test-volume<span class=o>]</span><span class=c1># docker build -f /home/docker-test-volume/dockerfile1 -t lyj/centos:1.0 .</span>
</span></span><span class=line><span class=cl>Sending build context to Docker daemon  2.048kB
</span></span><span class=line><span class=cl>Step 1/4 : FROM centos
</span></span><span class=line><span class=cl> ---&gt; 5d0da3dc9764
</span></span><span class=line><span class=cl>Step 2/4 : VOLUME <span class=o>[</span><span class=s2>&#34;volume01&#34;</span>,<span class=s2>&#34;volume02&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl> ---&gt; Running in adf475a0af98
</span></span><span class=line><span class=cl>Removing intermediate container adf475a0af98
</span></span><span class=line><span class=cl> ---&gt; 4dd2b9a5d3cc
</span></span><span class=line><span class=cl>Step 3/4 : CMD <span class=nb>echo</span> <span class=s2>&#34;----end----&#34;</span>
</span></span><span class=line><span class=cl> ---&gt; Running in 3f617792852a
</span></span><span class=line><span class=cl>Removing intermediate container 3f617792852a
</span></span><span class=line><span class=cl> ---&gt; 6b2f0b022f0d
</span></span><span class=line><span class=cl>Step 4/4 : CMD /bin/bash
</span></span><span class=line><span class=cl> ---&gt; Running in 216f3f309b22
</span></span><span class=line><span class=cl>Removing intermediate container 216f3f309b22
</span></span><span class=line><span class=cl> ---&gt; ac1b086b26d7
</span></span><span class=line><span class=cl>Successfully built ac1b086b26d7
</span></span><span class=line><span class=cl>Successfully tagged lyj/centos:1.0
</span></span></code></pre></td></tr></table></div></div><p><strong>启动自己的容器</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl> docker run -it ac1b086b26d7 /bin/bash
</span></span></code></pre></td></tr></table></div></div><p><strong>自己容器挂载的路径</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=s2>&#34;Mounts&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>            <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;Type&#34;</span>: <span class=s2>&#34;volume&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;Name&#34;</span>: <span class=s2>&#34;c9e87917b6ac7b8b8e659dc3aa18454c67480f8b18328873c8eb4005126cc260&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;Source&#34;</span>: <span class=s2>&#34;/var/lib/docker/volumes/c9e87917b6ac7b8b8e659dc3aa18454c67480f8b18328873c8eb4005126cc260/_data&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;Destination&#34;</span>: <span class=s2>&#34;volume01&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;Driver&#34;</span>: <span class=s2>&#34;local&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;Mode&#34;</span>: <span class=s2>&#34;&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;RW&#34;</span>: true,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;Propagation&#34;</span>: <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>,
</span></span><span class=line><span class=cl>            <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;Type&#34;</span>: <span class=s2>&#34;volume&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;Name&#34;</span>: <span class=s2>&#34;6716d8d8d2108ef678bd3d68632ec45a1f8b1086a3e9cab08965c0b73edde3f4&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;Source&#34;</span>: <span class=s2>&#34;/var/lib/docker/volumes/6716d8d8d2108ef678bd3d68632ec45a1f8b1086a3e9cab08965c0b73edde3f4/_data&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;Destination&#34;</span>: <span class=s2>&#34;volume02&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;Driver&#34;</span>: <span class=s2>&#34;local&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;Mode&#34;</span>: <span class=s2>&#34;&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;RW&#34;</span>: true,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;Propagation&#34;</span>: <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>]</span>,
</span></span></code></pre></td></tr></table></div></div><h3 id=数据卷容器>数据卷容器<a hidden class=anchor aria-hidden=true href=#数据卷容器>#</a></h3><p>多个容器同步数据</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 启动三个镜像，通过我们自己写的镜像去启动</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost lyj<span class=o>]</span><span class=c1># docker run -it --name docker01 lyj/centos:1.0</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@af22ef053837 /<span class=o>]</span><span class=c1># ls</span>
</span></span><span class=line><span class=cl>bin  etc   lib    lost+found  mnt  proc  run   srv  tmp  var       volume02
</span></span><span class=line><span class=cl>dev  home  lib64  media       opt  root  sbin  sys  usr  volume01
</span></span><span class=line><span class=cl><span class=o>[</span>root@af22ef053837 /<span class=o>]</span><span class=c1># ls -l</span>
</span></span><span class=line><span class=cl>total <span class=m>0</span>
</span></span><span class=line><span class=cl>lrwxrwxrwx.   <span class=m>1</span> root root   <span class=m>7</span> Nov  <span class=m>3</span>  <span class=m>2020</span> bin -&gt; usr/bin
</span></span><span class=line><span class=cl>drwxr-xr-x.   <span class=m>5</span> root root <span class=m>360</span> May <span class=m>17</span> 02:18 dev
</span></span><span class=line><span class=cl>drwxr-xr-x.   <span class=m>1</span> root root  <span class=m>66</span> May <span class=m>17</span> 02:18 etc
</span></span><span class=line><span class=cl>drwxr-xr-x.   <span class=m>2</span> root root   <span class=m>6</span> Nov  <span class=m>3</span>  <span class=m>2020</span> home
</span></span><span class=line><span class=cl>lrwxrwxrwx.   <span class=m>1</span> root root   <span class=m>7</span> Nov  <span class=m>3</span>  <span class=m>2020</span> lib -&gt; usr/lib
</span></span><span class=line><span class=cl>lrwxrwxrwx.   <span class=m>1</span> root root   <span class=m>9</span> Nov  <span class=m>3</span>  <span class=m>2020</span> lib64 -&gt; usr/lib64
</span></span><span class=line><span class=cl>drwx------.   <span class=m>2</span> root root   <span class=m>6</span> Sep <span class=m>15</span>  <span class=m>2021</span> lost+found
</span></span><span class=line><span class=cl>drwxr-xr-x.   <span class=m>2</span> root root   <span class=m>6</span> Nov  <span class=m>3</span>  <span class=m>2020</span> media
</span></span><span class=line><span class=cl>drwxr-xr-x.   <span class=m>2</span> root root   <span class=m>6</span> Nov  <span class=m>3</span>  <span class=m>2020</span> mnt
</span></span><span class=line><span class=cl>drwxr-xr-x.   <span class=m>2</span> root root   <span class=m>6</span> Nov  <span class=m>3</span>  <span class=m>2020</span> opt
</span></span><span class=line><span class=cl>dr-xr-xr-x. <span class=m>186</span> root root   <span class=m>0</span> May <span class=m>17</span> 02:18 proc
</span></span><span class=line><span class=cl>dr-xr-x---.   <span class=m>2</span> root root <span class=m>162</span> Sep <span class=m>15</span>  <span class=m>2021</span> root
</span></span><span class=line><span class=cl>drwxr-xr-x.  <span class=m>11</span> root root <span class=m>163</span> Sep <span class=m>15</span>  <span class=m>2021</span> run
</span></span><span class=line><span class=cl>lrwxrwxrwx.   <span class=m>1</span> root root   <span class=m>8</span> Nov  <span class=m>3</span>  <span class=m>2020</span> sbin -&gt; usr/sbin
</span></span><span class=line><span class=cl>drwxr-xr-x.   <span class=m>2</span> root root   <span class=m>6</span> Nov  <span class=m>3</span>  <span class=m>2020</span> srv
</span></span><span class=line><span class=cl>dr-xr-xr-x.  <span class=m>13</span> root root   <span class=m>0</span> May <span class=m>17</span> 02:13 sys
</span></span><span class=line><span class=cl>drwxrwxrwt.   <span class=m>7</span> root root <span class=m>171</span> Sep <span class=m>15</span>  <span class=m>2021</span> tmp
</span></span><span class=line><span class=cl>drwxr-xr-x.  <span class=m>12</span> root root <span class=m>144</span> Sep <span class=m>15</span>  <span class=m>2021</span> usr
</span></span><span class=line><span class=cl>drwxr-xr-x.  <span class=m>20</span> root root <span class=m>262</span> Sep <span class=m>15</span>  <span class=m>2021</span> var
</span></span><span class=line><span class=cl>drwxr-xr-x.   <span class=m>2</span> root root   <span class=m>6</span> May <span class=m>17</span> 02:18 volume01
</span></span><span class=line><span class=cl>drwxr-xr-x.   <span class=m>2</span> root root   <span class=m>6</span> May <span class=m>17</span> 02:18 volume02
</span></span></code></pre></td></tr></table></div></div><p>删除docker01的容器之后数据依然存在</p><blockquote><p>容器之间买配置信息的传递，数据卷容器的生命周期一致持续到没有容器使用为止</p></blockquote><h2 id=dockerfile>DockerFile<a hidden class=anchor aria-hidden=true href=#dockerfile>#</a></h2><h3 id=dokerfile介绍>DokerFile介绍<a hidden class=anchor aria-hidden=true href=#dokerfile介绍>#</a></h3><p>dockerFile是用来构建docker镜像的文件！命令参数脚本！</p><p>构建步骤：</p><ol><li>编写一个dockerfile文件</li><li>docker build 构建成为一个镜像</li><li>docker run 运行镜像</li><li>docker push 发布镜像(Docker Hub、阿里云镜像仓库)</li></ol><p><code>很多官方镜像都是基础包，很多功能没有，我们通常会自己搭建镜像</code></p><h3 id=dockerfile构建过程>DockerFile构建过程<a hidden class=anchor aria-hidden=true href=#dockerfile构建过程>#</a></h3><p><strong>基础知识：</strong></p><p>1、每个保留关键字(指令)都是必须大写字母</p><p>2、执行顺序是从上到下的</p><p>3、# 表示注释</p><p>4、每一个指令都会创建提交一个新的镜像层，并提交！</p><p>dockerFile是面向开发的，以后发布项目，做镜像，就需要编写dockerfile文件，这个文件很简单，dockerfil逐渐成为企业交付的标准，必须要掌握！</p><p>步骤：开发、部署、运维缺一不可</p><p>DockerFile：构建文件，定义了一切的步骤，源代码</p><p>DockerImages：通过dockerfile构建生成的镜像，最终发布和运行的产品</p><p>Docker容器：容器就是镜像运行起来提供服务器</p><h3 id=指令>指令：<a hidden class=anchor aria-hidden=true href=#指令>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>FROM	<span class=c1># 基础镜像，一切从这里开始构建</span>
</span></span><span class=line><span class=cl>MAINTAINER	<span class=c1># 镜像是谁写的，姓名+邮箱</span>
</span></span><span class=line><span class=cl>RUN		<span class=c1># 镜像构建的时候需要运行的命令</span>
</span></span><span class=line><span class=cl>ADD 	<span class=c1># 步骤，tomcat镜像，这个tomcat压缩包！添加内容</span>
</span></span><span class=line><span class=cl>WORKDIR 	<span class=c1># 镜像的工作目录</span>
</span></span><span class=line><span class=cl>VOLUEM 		<span class=c1># 挂载的目录</span>
</span></span><span class=line><span class=cl>EXPOSE 		<span class=c1># 保留端口配置</span>
</span></span><span class=line><span class=cl>CMD			<span class=c1># 指定这个容器启动的时候要运行的命令，只有最后一个会生效，可被替代</span>
</span></span><span class=line><span class=cl>ENTRYPOINT  <span class=c1># 指定这个容器启动的时候要运行的命令，可以追加命令</span>
</span></span><span class=line><span class=cl>ONBUILD 	<span class=c1># 当构建一个被继承DockerFile这个时候就会运行ONBUILD的指令</span>
</span></span><span class=line><span class=cl>COPY 		<span class=c1># 类似ADD,将我们的文件拷贝到镜像中</span>
</span></span><span class=line><span class=cl>ENV 		<span class=c1># 构建的时候设置环境变量！</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>创建一个属于自己的centos</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 编写dockerfile的文件</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost dockerfile<span class=o>]</span><span class=c1># vim mydockerfile-centos</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost dockerfile<span class=o>]</span><span class=c1># cat mydockerfile-centos </span>
</span></span><span class=line><span class=cl>FROM centos
</span></span><span class=line><span class=cl>MAINTANER lyj-2063074967@qq.com
</span></span><span class=line><span class=cl>ENV MYPATH /usr/local
</span></span><span class=line><span class=cl>WORKDIR <span class=nv>$MYPATH</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>RUN  yum -y install vim
</span></span><span class=line><span class=cl>RUN  yum -y install net-tools
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>EXPOSE <span class=m>80</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>CMD <span class=nb>echo</span> <span class=nv>$MYPATH</span>
</span></span><span class=line><span class=cl>CMD <span class=nb>echo</span> <span class=s2>&#34;---end---&#34;</span>
</span></span><span class=line><span class=cl>CMD /bin/bash
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 构建镜像</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost dockerfile<span class=o>]</span><span class=c1># docker build -f mydockerfile-centos -t mycentos:0.1 .</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 测试运行</span>
</span></span><span class=line><span class=cl>docker run -it mycentos:0.1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看历史变更</span>
</span></span><span class=line><span class=cl>ot@localhost dockerfile<span class=o>]</span><span class=c1># docker history 5d0da3dc9764</span>
</span></span><span class=line><span class=cl>IMAGE          CREATED        CREATED BY                                      SIZE      COMMENT
</span></span><span class=line><span class=cl>5d0da3dc9764   <span class=m>8</span> months ago   /bin/sh -c <span class=c1>#(nop)  CMD [&#34;/bin/bash&#34;]            0B        </span>
</span></span><span class=line><span class=cl>&lt;missing&gt;      <span class=m>8</span> months ago   /bin/sh -c <span class=c1>#(nop)  LABEL org.label-schema.sc…   0B        </span>
</span></span><span class=line><span class=cl>&lt;missing&gt;      <span class=m>8</span> months ago   /bin/sh -c <span class=c1>#(nop) ADD file:805cb5e15fb6e0bb0…   231MB   </span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>CMD 和 ENTRYPOINT 区别</p></blockquote><p>测试cmd</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@localhost dockerfile<span class=o>]</span><span class=c1># vim dockerfile-cmd-test</span>
</span></span><span class=line><span class=cl><span class=c1># 脚本</span>
</span></span><span class=line><span class=cl>FROM centos:7
</span></span><span class=line><span class=cl>CMD <span class=o>[</span><span class=s2>&#34;ls&#34;</span>,<span class=s2>&#34;-a&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 构建</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost dockerfile<span class=o>]</span><span class=c1># docker build -f dockerfile-cmd-test  -t cmdtest .</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 命令生效</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost dockerfile<span class=o>]</span><span class=c1># docker run 744c3d93e4a3</span>
</span></span><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>..
</span></span><span class=line><span class=cl>.dockerenv
</span></span><span class=line><span class=cl>anaconda-post.log
</span></span><span class=line><span class=cl>bin
</span></span><span class=line><span class=cl>dev
</span></span><span class=line><span class=cl>etc
</span></span><span class=line><span class=cl>home
</span></span><span class=line><span class=cl>lib
</span></span><span class=line><span class=cl>lib64
</span></span><span class=line><span class=cl>media
</span></span><span class=line><span class=cl>mnt
</span></span><span class=line><span class=cl>opt
</span></span><span class=line><span class=cl>proc
</span></span><span class=line><span class=cl>root
</span></span><span class=line><span class=cl>run
</span></span><span class=line><span class=cl>sbin
</span></span><span class=line><span class=cl>srv
</span></span><span class=line><span class=cl>sys
</span></span><span class=line><span class=cl>tmp
</span></span><span class=line><span class=cl>usr
</span></span><span class=line><span class=cl>var
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 想追加命令 il, ls -al</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost dockerfile<span class=o>]</span><span class=c1># docker run 744c3d93e4a3 -l</span>
</span></span><span class=line><span class=cl>docker: Error response from daemon: failed to create shim task: OCI runtime create failed: runc create failed: unable to start container process: exec: <span class=s2>&#34;-l&#34;</span>: executable file not found in <span class=nv>$PATH</span>: unknown.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># cmd情况下-l 替代了ls -a</span>
</span></span></code></pre></td></tr></table></div></div><p>测试ENTRYPOINT</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@localhost dockerfile<span class=o>]</span><span class=c1># vim dockerfile-cmd-entryponit</span>
</span></span><span class=line><span class=cl><span class=c1># 脚本</span>
</span></span><span class=line><span class=cl>FROM centos:7
</span></span><span class=line><span class=cl>ENTRYPOINT <span class=o>[</span><span class=s2>&#34;ls&#34;</span>,<span class=s2>&#34;-a&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost dockerfile<span class=o>]</span><span class=c1># docker build -f dockerfile-cmd-entryponit -t entrypoint-test .</span>
</span></span><span class=line><span class=cl>Sending build context to Docker daemon  4.096kB
</span></span><span class=line><span class=cl>Step 1/2 : FROM centos:7
</span></span><span class=line><span class=cl> ---&gt; eeb6ee3f44bd
</span></span><span class=line><span class=cl>Step 2/2 : ENTRYPOINT <span class=o>[</span><span class=s2>&#34;ls&#34;</span>,<span class=s2>&#34;-a&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl> ---&gt; Running in 84619c168165
</span></span><span class=line><span class=cl>Removing intermediate container 84619c168165
</span></span><span class=line><span class=cl> ---&gt; a0a8da7d7890
</span></span><span class=line><span class=cl>Successfully built a0a8da7d7890
</span></span><span class=line><span class=cl>Successfully tagged entrypoint-test:latest
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost dockerfile<span class=o>]</span><span class=c1># docker run a0a8da7d7890</span>
</span></span><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>..
</span></span><span class=line><span class=cl>.dockerenv
</span></span><span class=line><span class=cl>anaconda-post.log
</span></span><span class=line><span class=cl>bin
</span></span><span class=line><span class=cl>dev
</span></span><span class=line><span class=cl>etc
</span></span><span class=line><span class=cl>home
</span></span><span class=line><span class=cl>lib
</span></span><span class=line><span class=cl>lib64
</span></span><span class=line><span class=cl>media
</span></span><span class=line><span class=cl>mnt
</span></span><span class=line><span class=cl>opt
</span></span><span class=line><span class=cl>proc
</span></span><span class=line><span class=cl>root
</span></span><span class=line><span class=cl>run
</span></span><span class=line><span class=cl>sbin
</span></span><span class=line><span class=cl>srv
</span></span><span class=line><span class=cl>sys
</span></span><span class=line><span class=cl>tmp
</span></span><span class=line><span class=cl>usr
</span></span><span class=line><span class=cl>var
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost dockerfile<span class=o>]</span><span class=c1># docker run a0a8da7d7890 -l</span>
</span></span><span class=line><span class=cl>total <span class=m>12</span>
</span></span><span class=line><span class=cl>drwxr-xr-x.   <span class=m>1</span> root root     <span class=m>6</span> May <span class=m>17</span> 03:33 .
</span></span><span class=line><span class=cl>drwxr-xr-x.   <span class=m>1</span> root root     <span class=m>6</span> May <span class=m>17</span> 03:33 ..
</span></span><span class=line><span class=cl>-rwxr-xr-x.   <span class=m>1</span> root root     <span class=m>0</span> May <span class=m>17</span> 03:33 .dockerenv
</span></span><span class=line><span class=cl>-rw-r--r--.   <span class=m>1</span> root root <span class=m>12114</span> Nov <span class=m>13</span>  <span class=m>2020</span> anaconda-post.log
</span></span><span class=line><span class=cl>lrwxrwxrwx.   <span class=m>1</span> root root     <span class=m>7</span> Nov <span class=m>13</span>  <span class=m>2020</span> bin -&gt; usr/bin
</span></span><span class=line><span class=cl>drwxr-xr-x.   <span class=m>5</span> root root   <span class=m>340</span> May <span class=m>17</span> 03:33 dev
</span></span><span class=line><span class=cl>drwxr-xr-x.   <span class=m>1</span> root root    <span class=m>66</span> May <span class=m>17</span> 03:33 etc
</span></span><span class=line><span class=cl>drwxr-xr-x.   <span class=m>2</span> root root     <span class=m>6</span> Apr <span class=m>11</span>  <span class=m>2018</span> home
</span></span><span class=line><span class=cl>lrwxrwxrwx.   <span class=m>1</span> root root     <span class=m>7</span> Nov <span class=m>13</span>  <span class=m>2020</span> lib -&gt; usr/lib
</span></span><span class=line><span class=cl>lrwxrwxrwx.   <span class=m>1</span> root root     <span class=m>9</span> Nov <span class=m>13</span>  <span class=m>2020</span> lib64 -&gt; usr/lib64
</span></span><span class=line><span class=cl>drwxr-xr-x.   <span class=m>2</span> root root     <span class=m>6</span> Apr <span class=m>11</span>  <span class=m>2018</span> media
</span></span><span class=line><span class=cl>drwxr-xr-x.   <span class=m>2</span> root root     <span class=m>6</span> Apr <span class=m>11</span>  <span class=m>2018</span> mnt
</span></span><span class=line><span class=cl>drwxr-xr-x.   <span class=m>2</span> root root     <span class=m>6</span> Apr <span class=m>11</span>  <span class=m>2018</span> opt
</span></span><span class=line><span class=cl>dr-xr-xr-x. <span class=m>187</span> root root     <span class=m>0</span> May <span class=m>17</span> 03:33 proc
</span></span><span class=line><span class=cl>dr-xr-x---.   <span class=m>2</span> root root   <span class=m>114</span> Nov <span class=m>13</span>  <span class=m>2020</span> root
</span></span><span class=line><span class=cl>drwxr-xr-x.  <span class=m>11</span> root root   <span class=m>148</span> Nov <span class=m>13</span>  <span class=m>2020</span> run
</span></span><span class=line><span class=cl>lrwxrwxrwx.   <span class=m>1</span> root root     <span class=m>8</span> Nov <span class=m>13</span>  <span class=m>2020</span> sbin -&gt; usr/sbin
</span></span><span class=line><span class=cl>drwxr-xr-x.   <span class=m>2</span> root root     <span class=m>6</span> Apr <span class=m>11</span>  <span class=m>2018</span> srv
</span></span><span class=line><span class=cl>dr-xr-xr-x.  <span class=m>13</span> root root     <span class=m>0</span> May <span class=m>17</span> 02:13 sys
</span></span><span class=line><span class=cl>drwxrwxrwt.   <span class=m>7</span> root root   <span class=m>132</span> Nov <span class=m>13</span>  <span class=m>2020</span> tmp
</span></span><span class=line><span class=cl>drwxr-xr-x.  <span class=m>13</span> root root   <span class=m>155</span> Nov <span class=m>13</span>  <span class=m>2020</span> usr
</span></span><span class=line><span class=cl>drwxr-xr-x.  <span class=m>18</span> root root   <span class=m>238</span> Nov <span class=m>13</span>  <span class=m>2020</span> var
</span></span></code></pre></td></tr></table></div></div><p>Dockerfile中很多命令都十分相似，我们需要了解它们的区别，我的最好的学习就是对比测试</p><h3 id=实践tomcat镜像>实践：Tomcat镜像<a hidden class=anchor aria-hidden=true href=#实践tomcat镜像>#</a></h3><p>1、准备镜像文件tomcat压缩包，jdk的压缩包</p><p>2、准备dockerfile文件，官方命令<code>Dockerfile</code>,build时会自动寻找这个文件，就不需要-f指定了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>FROM centos:7
</span></span><span class=line><span class=cl>MAINTAINET lyj-2063074967@qq.com
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>COPY readme.txt /usr/local/readme.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ADD jdk-8u181-linux-x64.tar.gz /usr/local/
</span></span><span class=line><span class=cl>ADD apache-tomcat-9.0.63.tar.gz /usr/lcoal/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>RUN yum -y install vim
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ENV MYPATH /usr/local
</span></span><span class=line><span class=cl>WORKDIR <span class=nv>$MYPATH</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ENV JAVA_HOME /usr/local/jdk1.8.0_181
</span></span><span class=line><span class=cl>ENV CLASSPATH <span class=nv>$JAVA_HOME</span>/lib/dt.jar:<span class=nv>$JAVA_HOME</span>/lib/tools.jar
</span></span><span class=line><span class=cl>ENV CATALINA_HOME /usr/local/apache-tomcat-9.0.63
</span></span><span class=line><span class=cl>ENV CATALINA_BASE /usr/local/apache-tomcat-9.0.63
</span></span><span class=line><span class=cl>ENV PATH <span class=nv>$PATH</span>:<span class=nv>$JAVA_HOME</span>/bin:<span class=nv>$CATALINA_HOME</span>/lib:<span class=nv>$CATALINA_HOME</span>/bin
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>EXPOSE <span class=m>8080</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>CMD /usr/local/apache-tomcat-9.0.63/bin/startup.sh <span class=o>&amp;&amp;</span> tail -F /usr/local/apache-tomcat-9.0.63/bin/logs/catalina.out
</span></span></code></pre></td></tr></table></div></div><p>3、构建镜像</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># docker build -t diytomcat .</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=docker网络>Docker网络<a hidden class=anchor aria-hidden=true href=#docker网络>#</a></h2><h3 id=理解docker0>理解Docker0<a hidden class=anchor aria-hidden=true href=#理解docker0>#</a></h3><p>清空所有环境（镜像和容器）</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># docker 如何处理容器网络访问</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost /<span class=o>]</span><span class=c1># docker run -d -P --name tomcat01 tomcat</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看容器的内部网络地址 ip addr</span>
</span></span><span class=line><span class=cl><span class=c1># linux可以Ping 容器内部</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>原理</p></blockquote><p>1、每启动一个docker容器，docker就会给docker容器分配一个ip,只要安装了docker，就会有一个网卡docker0桥接模式，使用的技术是evth-pair技术</p><p>2、在启动一个容器又多了一个网卡</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@localhost /<span class=o>]</span><span class=c1># ip addr</span>
</span></span><span class=line><span class=cl>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class=m>65536</span> qdisc noqueue state UNKNOWN group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span></span><span class=line><span class=cl>    inet 127.0.0.1/8 scope host lo
</span></span><span class=line><span class=cl>       valid_lft forever preferred_lft forever
</span></span><span class=line><span class=cl>    inet6 ::1/128 scope host 
</span></span><span class=line><span class=cl>       valid_lft forever preferred_lft forever
</span></span><span class=line><span class=cl>2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class=m>1500</span> qdisc pfifo_fast state UP group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/ether 00:0c:29:32:a0:bc brd ff:ff:ff:ff:ff:ff
</span></span><span class=line><span class=cl>    inet 192.168.108.110/24 brd 192.168.108.255 scope global noprefixroute ens33
</span></span><span class=line><span class=cl>       valid_lft forever preferred_lft forever
</span></span><span class=line><span class=cl>    inet6 fe80::32c9:7680:6e1:ea04/64 scope link noprefixroute 
</span></span><span class=line><span class=cl>       valid_lft forever preferred_lft forever
</span></span><span class=line><span class=cl>3: virbr0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu <span class=m>1500</span> qdisc noqueue state DOWN group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/ether 52:54:00:c7:4f:55 brd ff:ff:ff:ff:ff:ff
</span></span><span class=line><span class=cl>    inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0
</span></span><span class=line><span class=cl>       valid_lft forever preferred_lft forever
</span></span><span class=line><span class=cl>4: virbr0-nic: &lt;BROADCAST,MULTICAST&gt; mtu <span class=m>1500</span> qdisc pfifo_fast master virbr0 state DOWN group default qlen <span class=m>1000</span>
</span></span><span class=line><span class=cl>    link/ether 52:54:00:c7:4f:55 brd ff:ff:ff:ff:ff:ff
</span></span><span class=line><span class=cl>5: br-11e4c4d39e6c: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu <span class=m>1500</span> qdisc noqueue state DOWN group default 
</span></span><span class=line><span class=cl>    link/ether 02:42:20:e8:3d:98 brd ff:ff:ff:ff:ff:ff
</span></span><span class=line><span class=cl>    inet 172.18.0.1/16 brd 172.18.255.255 scope global br-11e4c4d39e6c
</span></span><span class=line><span class=cl>       valid_lft forever preferred_lft forever
</span></span><span class=line><span class=cl>6: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class=m>1500</span> qdisc noqueue state UP group default 
</span></span><span class=line><span class=cl>    link/ether 02:42:cc:cd:5d:3d brd ff:ff:ff:ff:ff:ff
</span></span><span class=line><span class=cl>    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0
</span></span><span class=line><span class=cl>       valid_lft forever preferred_lft forever
</span></span><span class=line><span class=cl>    inet6 fe80::42:ccff:fecd:5d3d/64 scope link 
</span></span><span class=line><span class=cl>       valid_lft forever preferred_lft forever
</span></span><span class=line><span class=cl>8: vethbd6aa9d@if7: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class=m>1500</span> qdisc noqueue master docker0 state UP group default 
</span></span><span class=line><span class=cl>    link/ether ba:cc:e4:b3:69:1e brd ff:ff:ff:ff:ff:ff link-netnsid <span class=m>0</span>
</span></span><span class=line><span class=cl>    inet6 fe80::b8cc:e4ff:feb3:691e/64 scope link 
</span></span><span class=line><span class=cl>       valid_lft forever preferred_lft forever
</span></span><span class=line><span class=cl>10: veth9702194@if9: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class=m>1500</span> qdisc noqueue master docker0 state UP group default 
</span></span><span class=line><span class=cl>    link/ether 96:99:e6:6c:aa:b6 brd ff:ff:ff:ff:ff:ff link-netnsid <span class=m>1</span>
</span></span><span class=line><span class=cl>    inet6 fe80::9499:e6ff:fe6c:aab6/64 scope link 
</span></span><span class=line><span class=cl>       valid_lft forever preferred_lft forever
</span></span></code></pre></td></tr></table></div></div><p>容器带来的网卡，都是一对的，evth-pair就是一对虚拟设备接口，他们都是成对出现的，一段连着协议，一段彼此相连，正因为这个特性，evth-pari充当一个桥接，连接各种虚拟网络设备的，Docker容器之间的连接，都是使用evth-paur技术</p><h3 id=link>link<a hidden class=anchor aria-hidden=true href=#link>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -P  --name tomcat03 --link tomcat02 tomcat
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@localhost /<span class=o>]</span><span class=c1># docker exec -it tomcat02 cat /etc/hosts</span>
</span></span><span class=line><span class=cl>127.0.0.1       localhost
</span></span><span class=line><span class=cl>::1     localhost ip6-localhost ip6-loopback
</span></span><span class=line><span class=cl>fe00::0 ip6-localnet
</span></span><span class=line><span class=cl>ff00::0 ip6-mcastprefix
</span></span><span class=line><span class=cl>ff02::1 ip6-allnodes
</span></span><span class=line><span class=cl>ff02::2 ip6-allrouters
</span></span><span class=line><span class=cl>172.17.0.3      555cc43e71d6
</span></span></code></pre></td></tr></table></div></div><p>link的本质：就是在hosts配置增加了171.17.0.3 容器id</p><h3 id=自定义网络>自定义网络<a hidden class=anchor aria-hidden=true href=#自定义网络>#</a></h3><blockquote><p>查看所有docker 网络</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[root@localhost /]# docker network ls
</span></span><span class=line><span class=cl>NETWORK ID     NAME          DRIVER    SCOPE
</span></span><span class=line><span class=cl>835678176bfb   bridge        bridge    local
</span></span><span class=line><span class=cl>33bd4092d423   host          host      local
</span></span><span class=line><span class=cl>c67b96605b65   none          null      local
</span></span><span class=line><span class=cl>11e4c4d39e6c   somenetwork   bridge    local
</span></span></code></pre></td></tr></table></div></div><h4 id=网络模式>网络模式<a hidden class=anchor aria-hidden=true href=#网络模式>#</a></h4><p>bridge：桥接docker（默认）自己创建网络也是用bridge模式</p><p>none：不配置网络</p><p>host：和宿主机共享网络</p><p>container：容器网络联通（用的少，局限很大）</p><p><strong>测试</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 直接启动的命令， --net bridge,而这个就docker0</span>
</span></span><span class=line><span class=cl>docker run -d -P --name tomcat01
</span></span><span class=line><span class=cl>docker run -d -P --name tomcat01 --net bridge tomcat
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># docker0特点，默认，域名不用访问，--link可以打通连接</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 自定义一个网络</span>
</span></span><span class=line><span class=cl><span class=c1># --diver 桥接模式</span>
</span></span><span class=line><span class=cl><span class=c1># --subnet 子网</span>
</span></span><span class=line><span class=cl><span class=c1># --gateway 网关</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost /<span class=o>]</span><span class=c1># docker network create --driver bridge  --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet</span>
</span></span><span class=line><span class=cl>dc5bf1caafaa16013e9f9f0654982ed97cd589713f5925ddbd2908c0ccb1351b
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost /<span class=o>]</span><span class=c1># docker network ls</span>
</span></span><span class=line><span class=cl>NETWORK ID     NAME      DRIVER    SCOPE
</span></span><span class=line><span class=cl>835678176bfb   bridge    bridge    <span class=nb>local</span>
</span></span><span class=line><span class=cl>33bd4092d423   host      host      <span class=nb>local</span>
</span></span><span class=line><span class=cl>dc5bf1caafaa   mynet     bridge    <span class=nb>local</span>
</span></span><span class=line><span class=cl>c67b96605b65   none      null      <span class=nb>local</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># </span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span>root@localhost /<span class=o>]</span><span class=c1># docker run -d -P --name tomcat-net-01 --net mynet</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;docker run&#34;</span> requires at least <span class=m>1</span> argument.
</span></span><span class=line><span class=cl>See <span class=s1>&#39;docker run --help&#39;</span>.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Usage:  docker run <span class=o>[</span>OPTIONS<span class=o>]</span> IMAGE <span class=o>[</span>COMMAND<span class=o>]</span> <span class=o>[</span>ARG...<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Run a <span class=nb>command</span> in a new container
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost /<span class=o>]</span><span class=c1># docker run -d -P --name tomcat-net-01 --net mynet tomcat</span>
</span></span><span class=line><span class=cl>a07c51438812bcfc529fd503c929866a6f77d30a7e8716c72f9548ffc5025877
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost /<span class=o>]</span><span class=c1># docker run -d -P --name tomcat-net-02 --net mynet tomcat</span>
</span></span><span class=line><span class=cl>ecdda4c64e007c8c7ef24de2dd581cbe967593c2fc730805f769c68930b82f6a
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost /<span class=o>]</span><span class=c1># docker network inspect mynet</span>
</span></span><span class=line><span class=cl><span class=o>[</span>
</span></span><span class=line><span class=cl>    <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Name&#34;</span>: <span class=s2>&#34;mynet&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Id&#34;</span>: <span class=s2>&#34;dc5bf1caafaa16013e9f9f0654982ed97cd589713f5925ddbd2908c0ccb1351b&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Created&#34;</span>: <span class=s2>&#34;2022-05-18T11:06:01.965660686+08:00&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Scope&#34;</span>: <span class=s2>&#34;local&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Driver&#34;</span>: <span class=s2>&#34;bridge&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;EnableIPv6&#34;</span>: false,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;IPAM&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Driver&#34;</span>: <span class=s2>&#34;default&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Options&#34;</span>: <span class=o>{}</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Config&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>                <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;Subnet&#34;</span>: <span class=s2>&#34;192.168.0.0/16&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;Gateway&#34;</span>: <span class=s2>&#34;192.168.0.1&#34;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>]</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Internal&#34;</span>: false,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Attachable&#34;</span>: false,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Ingress&#34;</span>: false,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;ConfigFrom&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Network&#34;</span>: <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;ConfigOnly&#34;</span>: false,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Containers&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;a07c51438812bcfc529fd503c929866a6f77d30a7e8716c72f9548ffc5025877&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;Name&#34;</span>: <span class=s2>&#34;tomcat-net-01&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;EndpointID&#34;</span>: <span class=s2>&#34;de83ba706e481876e2973336408e5c071da47133ce309c7801bf8935bb391618&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;MacAddress&#34;</span>: <span class=s2>&#34;02:42:c0:a8:00:02&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;IPv4Address&#34;</span>: <span class=s2>&#34;192.168.0.2/16&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;IPv6Address&#34;</span>: <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;ecdda4c64e007c8c7ef24de2dd581cbe967593c2fc730805f769c68930b82f6a&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;Name&#34;</span>: <span class=s2>&#34;tomcat-net-02&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;EndpointID&#34;</span>: <span class=s2>&#34;066c8632e98ebfb0d8cd3ebc3da9bc28df18749532ebd71fda9561e810e0a49b&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;MacAddress&#34;</span>: <span class=s2>&#34;02:42:c0:a8:00:03&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;IPv4Address&#34;</span>: <span class=s2>&#34;192.168.0.3/16&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;IPv6Address&#34;</span>: <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Options&#34;</span>: <span class=o>{}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Labels&#34;</span>: <span class=o>{}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><p>自定义的网络docker已经帮我们维护好了对应的关系</p><p>好处：</p><p>redis-不同的集群使用不同的网络，保证了集群是安全和健康的</p><p>mysql-不同的集群使用不同的网络，保证了集群是安全和健康的</p><h3 id=网络连通>网络连通<a hidden class=anchor aria-hidden=true href=#网络连通>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span>root@localhost /<span class=o>]</span><span class=c1># docker network --help</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Usage:  docker network COMMAND
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Manage networks
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Commands:
</span></span><span class=line><span class=cl>  connect     Connect a container to a network
</span></span><span class=line><span class=cl>  create      Create a network
</span></span><span class=line><span class=cl>  disconnect  Disconnect a container from a network
</span></span><span class=line><span class=cl>  inspect     Display detailed information on one or more networks
</span></span><span class=line><span class=cl>  ls          List networks
</span></span><span class=line><span class=cl>  prune       Remove all unused networks
</span></span><span class=line><span class=cl>  rm          Remove one or more networks
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Run <span class=s1>&#39;docker network COMMAND --help&#39;</span> <span class=k>for</span> more information on a command.
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 测试打通tomcat01到mynet</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost /<span class=o>]</span><span class=c1># docker network connect mynet tomcat01</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 连通之后就是tomcat01放到了mynet网络下</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost /<span class=o>]</span><span class=c1># docker network inspect mynet</span>
</span></span><span class=line><span class=cl><span class=o>[</span>
</span></span><span class=line><span class=cl>    <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Name&#34;</span>: <span class=s2>&#34;mynet&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Id&#34;</span>: <span class=s2>&#34;dc5bf1caafaa16013e9f9f0654982ed97cd589713f5925ddbd2908c0ccb1351b&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Created&#34;</span>: <span class=s2>&#34;2022-05-18T11:06:01.965660686+08:00&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Scope&#34;</span>: <span class=s2>&#34;local&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Driver&#34;</span>: <span class=s2>&#34;bridge&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;EnableIPv6&#34;</span>: false,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;IPAM&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Driver&#34;</span>: <span class=s2>&#34;default&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Options&#34;</span>: <span class=o>{}</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Config&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>                <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;Subnet&#34;</span>: <span class=s2>&#34;192.168.0.0/16&#34;</span>,
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;Gateway&#34;</span>: <span class=s2>&#34;192.168.0.1&#34;</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>]</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Internal&#34;</span>: false,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Attachable&#34;</span>: false,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Ingress&#34;</span>: false,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;ConfigFrom&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Network&#34;</span>: <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;ConfigOnly&#34;</span>: false,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Containers&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;3e25bc8a0e7586f3105c12ca550d5a28b0407ba5aa9bd362c4993422eb1729dd&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;Name&#34;</span>: <span class=s2>&#34;tomcat01&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;EndpointID&#34;</span>: <span class=s2>&#34;5e6c258c064273d14450c2acfb98a34455524b11af4980378b62de1ae2249271&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;MacAddress&#34;</span>: <span class=s2>&#34;02:42:c0:a8:00:04&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;IPv4Address&#34;</span>: <span class=s2>&#34;192.168.0.4/16&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;IPv6Address&#34;</span>: <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;a07c51438812bcfc529fd503c929866a6f77d30a7e8716c72f9548ffc5025877&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;Name&#34;</span>: <span class=s2>&#34;tomcat-net-01&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;EndpointID&#34;</span>: <span class=s2>&#34;de83ba706e481876e2973336408e5c071da47133ce309c7801bf8935bb391618&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;MacAddress&#34;</span>: <span class=s2>&#34;02:42:c0:a8:00:02&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;IPv4Address&#34;</span>: <span class=s2>&#34;192.168.0.2/16&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;IPv6Address&#34;</span>: <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;ecdda4c64e007c8c7ef24de2dd581cbe967593c2fc730805f769c68930b82f6a&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;Name&#34;</span>: <span class=s2>&#34;tomcat-net-02&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;EndpointID&#34;</span>: <span class=s2>&#34;066c8632e98ebfb0d8cd3ebc3da9bc28df18749532ebd71fda9561e810e0a49b&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;MacAddress&#34;</span>: <span class=s2>&#34;02:42:c0:a8:00:03&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;IPv4Address&#34;</span>: <span class=s2>&#34;192.168.0.3/16&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;IPv6Address&#34;</span>: <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Options&#34;</span>: <span class=o>{}</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Labels&#34;</span>: <span class=o>{}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 移除网络</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost /<span class=o>]</span><span class=c1># docker network rm somenetwork</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=部署redis集群>部署redis集群<a hidden class=anchor aria-hidden=true href=#部署redis集群>#</a></h3><p>创建redis网卡</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span>root@localhost /<span class=o>]</span><span class=c1># docker network create redis --subnet 172.38.0.0/16</span>
</span></span></code></pre></td></tr></table></div></div><p>通过脚本创建六个reids配置</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=k>for</span> port in <span class=k>$(</span>seq <span class=m>1</span> 6<span class=k>)</span><span class=p>;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=k>do</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>mkdir -p /mydata/redis/node-<span class=si>${</span><span class=nv>port</span><span class=si>}</span>/conf
</span></span><span class=line><span class=cl>touch /mydata/redis/node-<span class=si>${</span><span class=nv>port</span><span class=si>}</span>/conf/redis.conf
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt; EOF &gt;/mydata/redis/node-${port}/conf/redis.conf
</span></span></span><span class=line><span class=cl><span class=s>port 6379 
</span></span></span><span class=line><span class=cl><span class=s>bind 0.0.0.0
</span></span></span><span class=line><span class=cl><span class=s>cluster-enabled yes 
</span></span></span><span class=line><span class=cl><span class=s>cluster-config-file nodes.conf
</span></span></span><span class=line><span class=cl><span class=s>cluster-node-timeout 5000
</span></span></span><span class=line><span class=cl><span class=s>cluster-announce-ip 172.38.0.1${port}
</span></span></span><span class=line><span class=cl><span class=s>cluster-announce-port 6379
</span></span></span><span class=line><span class=cl><span class=s>cluster-announce-bus-port 16379
</span></span></span><span class=line><span class=cl><span class=s>appendonly yes
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 启动容器</span>
</span></span><span class=line><span class=cl><span class=k>for</span> port in <span class=k>$(</span>seq <span class=m>1</span> 6<span class=k>)</span><span class=p>;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=k>do</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>docker run -p 637<span class=si>${</span><span class=nv>port</span><span class=si>}</span>:6379 -p 1637<span class=si>${</span><span class=nv>port</span><span class=si>}</span>:16379 --name redis-<span class=si>${</span><span class=nv>port</span><span class=si>}</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-v /mydata/redis/node-<span class=si>${</span><span class=nv>port</span><span class=si>}</span>/data:/data <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-v /mydata/redis/node-<span class=si>${</span><span class=nv>port</span><span class=si>}</span>/conf/redis.conf:/etc/redis/redis.conf <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-d --net redis --ip 172.38.0.1<span class=si>${</span><span class=nv>port</span><span class=si>}</span> redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf<span class=p>;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=k>done</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#进入一个容器</span>
</span></span><span class=line><span class=cl>docker <span class=nb>exec</span> -it redis-1 /bin/sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建集群</span>
</span></span><span class=line><span class=cl>redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379 172.38.0.13:6379 172.38.0.14:6379 172.38.0.15:6379 172.38.0.16:6379 --cluster-replicas <span class=m>1</span>
</span></span><span class=line><span class=cl>&gt;&gt;&gt; Performing <span class=nb>hash</span> slots allocation on <span class=m>6</span> nodes...
</span></span><span class=line><span class=cl>Master<span class=o>[</span>0<span class=o>]</span> -&gt; Slots <span class=m>0</span> - <span class=m>5460</span>
</span></span><span class=line><span class=cl>Master<span class=o>[</span>1<span class=o>]</span> -&gt; Slots <span class=m>5461</span> - <span class=m>10922</span>
</span></span><span class=line><span class=cl>Master<span class=o>[</span>2<span class=o>]</span> -&gt; Slots <span class=m>10923</span> - <span class=m>16383</span>
</span></span><span class=line><span class=cl>Adding replica 172.38.0.15:6379 to 172.38.0.11:6379
</span></span><span class=line><span class=cl>Adding replica 172.38.0.16:6379 to 172.38.0.12:6379
</span></span><span class=line><span class=cl>Adding replica 172.38.0.14:6379 to 172.38.0.13:6379
</span></span><span class=line><span class=cl>M: 9d90cb6cfe72a617664d5cc5ed83f654c2e9865b 172.38.0.11:6379
</span></span><span class=line><span class=cl>   slots:<span class=o>[</span>0-5460<span class=o>]</span> <span class=o>(</span><span class=m>5461</span> slots<span class=o>)</span> master
</span></span><span class=line><span class=cl>M: ff448dc8dea2517b2c77b2558e04cbeda7fab184 172.38.0.12:6379
</span></span><span class=line><span class=cl>   slots:<span class=o>[</span>5461-10922<span class=o>]</span> <span class=o>(</span><span class=m>5462</span> slots<span class=o>)</span> master
</span></span><span class=line><span class=cl>M: fc808d7350a36679cdc645dbaa8ec18702ca9e99 172.38.0.13:6379
</span></span><span class=line><span class=cl>   slots:<span class=o>[</span>10923-16383<span class=o>]</span> <span class=o>(</span><span class=m>5461</span> slots<span class=o>)</span> master
</span></span><span class=line><span class=cl>S: a595255f05ffe1317a217143bc87ec97cc287432 172.38.0.14:6379
</span></span><span class=line><span class=cl>   replicates fc808d7350a36679cdc645dbaa8ec18702ca9e99
</span></span><span class=line><span class=cl>S: 88f5fca469eab471e64edebb7a75f4422c9ada08 172.38.0.15:6379
</span></span><span class=line><span class=cl>   replicates 9d90cb6cfe72a617664d5cc5ed83f654c2e9865b
</span></span><span class=line><span class=cl>S: 73f4b703c96d5c36e5480574bee473aef9914da8 172.38.0.16:6379
</span></span><span class=line><span class=cl>   replicates ff448dc8dea2517b2c77b2558e04cbeda7fab184
</span></span><span class=line><span class=cl>Can I <span class=nb>set</span> the above configuration? <span class=o>(</span><span class=nb>type</span> <span class=s1>&#39;yes&#39;</span> to accept<span class=o>)</span>: yes
</span></span><span class=line><span class=cl>&gt;&gt;&gt; Nodes configuration updated
</span></span><span class=line><span class=cl>&gt;&gt;&gt; Assign a different config epoch to each node
</span></span><span class=line><span class=cl>&gt;&gt;&gt; Sending CLUSTER MEET messages to join the cluster
</span></span><span class=line><span class=cl>Waiting <span class=k>for</span> the cluster to join
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>&gt;&gt;&gt; Performing Cluster Check <span class=o>(</span>using node 172.38.0.11:6379<span class=o>)</span>
</span></span><span class=line><span class=cl>M: 9d90cb6cfe72a617664d5cc5ed83f654c2e9865b 172.38.0.11:6379
</span></span><span class=line><span class=cl>   slots:<span class=o>[</span>0-5460<span class=o>]</span> <span class=o>(</span><span class=m>5461</span> slots<span class=o>)</span> master
</span></span><span class=line><span class=cl>   <span class=m>1</span> additional replica<span class=o>(</span>s<span class=o>)</span>
</span></span><span class=line><span class=cl>M: ff448dc8dea2517b2c77b2558e04cbeda7fab184 172.38.0.12:6379
</span></span><span class=line><span class=cl>   slots:<span class=o>[</span>5461-10922<span class=o>]</span> <span class=o>(</span><span class=m>5462</span> slots<span class=o>)</span> master
</span></span><span class=line><span class=cl>   <span class=m>1</span> additional replica<span class=o>(</span>s<span class=o>)</span>
</span></span><span class=line><span class=cl>S: a595255f05ffe1317a217143bc87ec97cc287432 172.38.0.14:6379
</span></span><span class=line><span class=cl>   slots: <span class=o>(</span><span class=m>0</span> slots<span class=o>)</span> slave
</span></span><span class=line><span class=cl>   replicates fc808d7350a36679cdc645dbaa8ec18702ca9e99
</span></span><span class=line><span class=cl>S: 73f4b703c96d5c36e5480574bee473aef9914da8 172.38.0.16:6379
</span></span><span class=line><span class=cl>   slots: <span class=o>(</span><span class=m>0</span> slots<span class=o>)</span> slave
</span></span><span class=line><span class=cl>   replicates ff448dc8dea2517b2c77b2558e04cbeda7fab184
</span></span><span class=line><span class=cl>S: 88f5fca469eab471e64edebb7a75f4422c9ada08 172.38.0.15:6379
</span></span><span class=line><span class=cl>   slots: <span class=o>(</span><span class=m>0</span> slots<span class=o>)</span> slave
</span></span><span class=line><span class=cl>   replicates 9d90cb6cfe72a617664d5cc5ed83f654c2e9865b
</span></span><span class=line><span class=cl>M: fc808d7350a36679cdc645dbaa8ec18702ca9e99 172.38.0.13:6379
</span></span><span class=line><span class=cl>   slots:<span class=o>[</span>10923-16383<span class=o>]</span> <span class=o>(</span><span class=m>5461</span> slots<span class=o>)</span> master
</span></span><span class=line><span class=cl>   <span class=m>1</span> additional replica<span class=o>(</span>s<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>OK<span class=o>]</span> All nodes agree about slots configuration.
</span></span><span class=line><span class=cl>&gt;&gt;&gt; Check <span class=k>for</span> open slots...
</span></span><span class=line><span class=cl>&gt;&gt;&gt; Check slots coverage...
</span></span></code></pre></td></tr></table></div></div><h3 id=springboot项目打包docker镜像>SpringBoot项目打包Docker镜像<a hidden class=anchor aria-hidden=true href=#springboot项目打包docker镜像>#</a></h3><p>1、构建springboot项目</p><p>2、打包应用</p><p>3、编写Dockerfile</p><p>4、构建镜像</p><p>5、发布运行</p><h2 id=docker-compose>Docker Compose<a hidden class=anchor aria-hidden=true href=#docker-compose>#</a></h2><h3 id=简介>简介：<a hidden class=anchor aria-hidden=true href=#简介>#</a></h3><p>Docker</p><p>DockerFile build run 手动操作，单个容器！</p><p>微服务，100个微服务！依赖关系</p><p>Docker Compose 来轻松高效的管理容器，定义运行多个容器。</p><p>Compose是docker官方的开源项目，需要安装，</p><p><code>Dockerfile</code>让程序可以在任何地方运行，web服务、redis、MySQL、nginx&mldr;多个容器</p><p>Compose</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>version: <span class=s2>&#34;3.9&#34;</span>  <span class=c1># optional since v1.27.0</span>
</span></span><span class=line><span class=cl>services:
</span></span><span class=line><span class=cl>  web:
</span></span><span class=line><span class=cl>    build: .
</span></span><span class=line><span class=cl>    ports:
</span></span><span class=line><span class=cl>      - <span class=s2>&#34;8000:5000&#34;</span>
</span></span><span class=line><span class=cl>    volumes:
</span></span><span class=line><span class=cl>      - .:/code
</span></span><span class=line><span class=cl>      - logvolume01:/var/log
</span></span><span class=line><span class=cl>    links:
</span></span><span class=line><span class=cl>      - redis
</span></span><span class=line><span class=cl>  redis:
</span></span><span class=line><span class=cl>    image: redis
</span></span><span class=line><span class=cl>volumes:
</span></span><span class=line><span class=cl>  logvolume01: <span class=o>{}</span>
</span></span></code></pre></td></tr></table></div></div><p>docker-compose -up 100个服务</p><p>Compose：重要的概念</p><ul><li>服务services，容器，应用。（web、redis、mysql）</li><li>项目project，一组关联的容器。博客，web,mysql</li></ul><h3 id=compose-安装>Compose 安装<a hidden class=anchor aria-hidden=true href=#compose-安装>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>curl -L https://get.daocloud.io/docker/compose/releases/download/v2.5.0/docker-compose-<span class=sb>`</span>uname -s<span class=sb>`</span>-<span class=sb>`</span>uname -m<span class=sb>`</span> &gt; /usr/local/bin/docker-compose
</span></span></code></pre></td></tr></table></div></div><p>授权</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>chmod +x docker-compose
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost bin<span class=o>]</span><span class=c1># docker-compose version</span>
</span></span><span class=line><span class=cl>Docker Compose version v2.5.0
</span></span></code></pre></td></tr></table></div></div><h3 id=体验>体验<a hidden class=anchor aria-hidden=true href=#体验>#</a></h3><p>python应用，计数器，redis。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl> mkdir composetest
</span></span><span class=line><span class=cl> <span class=nb>cd</span> composetest
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl> vim app.py
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl> <span class=c1># 文件内容</span>
</span></span><span class=line><span class=cl> import <span class=nb>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>import redis
</span></span><span class=line><span class=cl>from flask import Flask
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>app</span> <span class=o>=</span> Flask<span class=o>(</span>__name__<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nv>cache</span> <span class=o>=</span> redis.Redis<span class=o>(</span><span class=nv>host</span><span class=o>=</span><span class=s1>&#39;redis&#39;</span>, <span class=nv>port</span><span class=o>=</span>6379<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>def get_hit_count<span class=o>()</span>:
</span></span><span class=line><span class=cl>    <span class=nv>retries</span> <span class=o>=</span> <span class=m>5</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> True:
</span></span><span class=line><span class=cl>        try:
</span></span><span class=line><span class=cl>            <span class=k>return</span> cache.incr<span class=o>(</span><span class=s1>&#39;hits&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        except redis.exceptions.ConnectionError as exc:
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nv>retries</span> <span class=o>==</span> 0:
</span></span><span class=line><span class=cl>                raise exc
</span></span><span class=line><span class=cl>            retries -<span class=o>=</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>            time.sleep<span class=o>(</span>0.5<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>@app.route<span class=o>(</span><span class=s1>&#39;/&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>def hello<span class=o>()</span>:
</span></span><span class=line><span class=cl>    <span class=nv>count</span> <span class=o>=</span> get_hit_count<span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;Hello World! I have been seen {} times.\n&#39;</span>.format<span class=o>(</span>count<span class=o>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>vim requirements.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 文件内容</span>
</span></span><span class=line><span class=cl>flask
</span></span><span class=line><span class=cl>redis
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>vim Dockerfile
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 文件内容</span>
</span></span><span class=line><span class=cl><span class=c1># syntax=docker/dockerfile:1</span>
</span></span><span class=line><span class=cl>FROM python:3.7-alpine
</span></span><span class=line><span class=cl>RUN <span class=nb>echo</span> -e http://mirrors.ustc.edu.cn/alpine/v3.12/main/ &gt; /etc/apk/repositories
</span></span><span class=line><span class=cl>WORKDIR /code
</span></span><span class=line><span class=cl>ENV <span class=nv>FLASK_APP</span><span class=o>=</span>app.py
</span></span><span class=line><span class=cl>ENV <span class=nv>FLASK_RUN_HOST</span><span class=o>=</span>0.0.0.0
</span></span><span class=line><span class=cl>RUN apk add --no-cache gcc musl-dev linux-headers
</span></span><span class=line><span class=cl>COPY requirements.txt requirements.txt
</span></span><span class=line><span class=cl>RUN pip install -i https://pypi.tuna.tsinghua.edu.cn/simple --no-cache-dir -r requirements.txt
</span></span><span class=line><span class=cl>EXPOSE <span class=m>5000</span>
</span></span><span class=line><span class=cl>COPY . .
</span></span><span class=line><span class=cl>CMD <span class=o>[</span><span class=s2>&#34;flask&#34;</span>, <span class=s2>&#34;run&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>vim docker-compose.yml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 文件内容</span>
</span></span><span class=line><span class=cl>version: <span class=s2>&#34;3.9&#34;</span>
</span></span><span class=line><span class=cl>services:
</span></span><span class=line><span class=cl>  web:
</span></span><span class=line><span class=cl>    build: .
</span></span><span class=line><span class=cl>    ports:
</span></span><span class=line><span class=cl>      - <span class=s2>&#34;8000:5000&#34;</span>
</span></span><span class=line><span class=cl>  redis:
</span></span><span class=line><span class=cl>    image: <span class=s2>&#34;redis:alpine&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=c1># 运行</span>
</span></span><span class=line><span class=cl>docker-compose up
</span></span></code></pre></td></tr></table></div></div><h3 id=yaml-规则>yaml 规则<a hidden class=anchor aria-hidden=true href=#yaml-规则>#</a></h3><p>docker-compose.yaml核心</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 3层</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>version: <span class=s1>&#39;&#39;</span> <span class=c1>#版本</span>
</span></span><span class=line><span class=cl>services: <span class=c1>#服务</span>
</span></span><span class=line><span class=cl>	服务1： web
</span></span><span class=line><span class=cl>		<span class=c1># 服务配置</span>
</span></span><span class=line><span class=cl>		images
</span></span><span class=line><span class=cl>		build
</span></span><span class=line><span class=cl>		network
</span></span><span class=line><span class=cl>	服务2： redis
</span></span><span class=line><span class=cl>	服务3： redis
</span></span><span class=line><span class=cl><span class=c1># 其他配置 网络/卷、 全局规则</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=开源项目>开源项目<a hidden class=anchor aria-hidden=true href=#开源项目>#</a></h3><p>下载程序，安装数据库、配置……</p><p>compose应用。=》一键启动</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>mkdir my_wordpress
</span></span><span class=line><span class=cl><span class=nb>cd</span> my_wordpress
</span></span><span class=line><span class=cl>vim docker-compose.yml
</span></span><span class=line><span class=cl><span class=c1># 文件内容</span>
</span></span><span class=line><span class=cl>version: <span class=s2>&#34;3.9&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>services:
</span></span><span class=line><span class=cl>  db:
</span></span><span class=line><span class=cl>    image: mysql:5.7
</span></span><span class=line><span class=cl>    volumes:
</span></span><span class=line><span class=cl>      - db_data:/var/lib/mysql
</span></span><span class=line><span class=cl>    restart: always
</span></span><span class=line><span class=cl>    environment:
</span></span><span class=line><span class=cl>      MYSQL_ROOT_PASSWORD: somewordpress
</span></span><span class=line><span class=cl>      MYSQL_DATABASE: wordpress
</span></span><span class=line><span class=cl>      MYSQL_USER: wordpress
</span></span><span class=line><span class=cl>      MYSQL_PASSWORD: wordpress
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>  wordpress:
</span></span><span class=line><span class=cl>    depends_on:
</span></span><span class=line><span class=cl>      - db
</span></span><span class=line><span class=cl>    image: wordpress:latest
</span></span><span class=line><span class=cl>    volumes:
</span></span><span class=line><span class=cl>      - wordpress_data:/var/www/html
</span></span><span class=line><span class=cl>    ports:
</span></span><span class=line><span class=cl>      - <span class=s2>&#34;8000:80&#34;</span>
</span></span><span class=line><span class=cl>    restart: always
</span></span><span class=line><span class=cl>    environment:
</span></span><span class=line><span class=cl>      WORDPRESS_DB_HOST: db
</span></span><span class=line><span class=cl>      WORDPRESS_DB_USER: wordpress
</span></span><span class=line><span class=cl>      WORDPRESS_DB_PASSWORD: wordpress
</span></span><span class=line><span class=cl>      WORDPRESS_DB_NAME: wordpress
</span></span><span class=line><span class=cl>volumes:
</span></span><span class=line><span class=cl>  db_data: <span class=o>{}</span>
</span></span><span class=line><span class=cl>  wordpress_data: <span class=o>{}</span>
</span></span></code></pre></td></tr></table></div></div><p>前台启动</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>docker -d
</span></span><span class=line><span class=cl>docker-compose -d
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Running 2/2
</span></span><span class=line><span class=cl> ⠿ Container my_wordpress-db-1         Started                                                         0.5s
</span></span><span class=line><span class=cl> ⠿ Container my_wordpress-wordpress-1  Started                                                         1.2s
</span></span></code></pre></td></tr></table></div></div><h3 id=测试>测试：<a hidden class=anchor aria-hidden=true href=#测试>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@RestController</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>HelloController</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>StringRedisTemplate</span><span class=w> </span><span class=n>redisTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GetMapping</span><span class=p>(</span><span class=s>&#34;/hello&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>hello</span><span class=p>(){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Long</span><span class=w> </span><span class=n>views</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>redisTemplate</span><span class=p>.</span><span class=na>opsForValue</span><span class=p>().</span><span class=na>increment</span><span class=p>(</span><span class=s>&#34;views&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w>  </span><span class=s>&#34;hello lyj views:&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>views</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-properties data-lang=properties><span class=line><span class=cl><span class=c1># application.propertiees</span>
</span></span><span class=line><span class=cl><span class=na>server.port</span><span class=o>=</span><span class=s>8080</span>
</span></span><span class=line><span class=cl><span class=na>spring.redis.host</span><span class=o>=</span><span class=s>redis</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># Dockerfile</span>
</span></span><span class=line><span class=cl>FROM java:8
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>COPY *.jar /app.jar
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>CMD <span class=o>[</span><span class=s2>&#34;--server.port=8080&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>EXPOSE <span class=m>8080</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ENTRYPOINT <span class=o>[</span><span class=s2>&#34;java&#34;</span>,<span class=s2>&#34;-jar&#34;</span>,<span class=s2>&#34;/app.jar&#34;</span><span class=o>]</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># docker-compose.yml</span>
</span></span><span class=line><span class=cl>version: <span class=s2>&#34;3.9&#34;</span>
</span></span><span class=line><span class=cl>services:
</span></span><span class=line><span class=cl>  lyjapp:
</span></span><span class=line><span class=cl>    build: .
</span></span><span class=line><span class=cl>    image: lyj
</span></span><span class=line><span class=cl>    depends_on:
</span></span><span class=line><span class=cl>      - redis
</span></span><span class=line><span class=cl>    ports:
</span></span><span class=line><span class=cl>    - <span class=s2>&#34;8080:8080&#34;</span>
</span></span><span class=line><span class=cl>  redis:
</span></span><span class=line><span class=cl>    image: <span class=s2>&#34;library/redis:alpine&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>项目要重新打包</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>docker-compose up --build
</span></span></code></pre></td></tr></table></div></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://lyj.cloudns.ch/tags/docker/>Docker</a></li></ul><nav class=paginav><a class=prev href=https://lyj.cloudns.ch/post/java-juc-description/><span class=title>«</span><br><span>JUC</span>
</a><a class=next href=https://lyj.cloudns.ch/post/database-design-specifications/><span class=title>»</span><br><span>数据库设计规范</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://lyj.cloudns.ch/>LYJ's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>